\documentclass[]{interact}

\usepackage[caption=false]{subfig}% Support for small, `sub' figures and tables
%\usepackage[nolists,tablesfirst]{endfloat}% To `separate' figures and tables from text if required

%\usepackage[doublespacing]{setspace}% To produce a `double spaced' document if required
%\setlength\parindent{24pt}% To increase paragraph indentation when line spacing is doubled
%\setlength\bibindent{2em}% To increase hanging indent in bibliography when line spacing is doubled

\usepackage[numbers,sort&compress]{natbib}% Citation support using natbib.sty
\bibpunct[, ]{[}{]}{,}{n}{,}{,}% Citation support using natbib.sty
\renewcommand\bibfont{\fontsize{10}{12}\selectfont}% Bibliography support using natbib.sty

\usepackage{textcomp}
\usepackage{amssymb,amsmath}
\usepackage{tikz}

\begin{document}

\title{A novel algorithm for construction of the shortest path
between a finite set of nonintersecting contours on the plane}

\author{
\name{
  A.~A. Petunin\textsuperscript{a}\textsuperscript{b},
  E.~G. Polishchuk\textsuperscript{a}
  and
  S.~S. Ukolov\textsuperscript{a}\thanks{CONTACT S.~S. Ukolov. Email: s.s.ukolov@urfu.ru}}
\affil{
  \textsuperscript{a}Ural Federal University, Yekaterinburg, Russia
  \textsuperscript{b}Institute of Mathematics and Mechanics, UBr RAS, Yekaterinburg, Russia
}}

\maketitle

\begin{abstract}
The article discusses one of the optimization problems
that arise when modeling the tool path for CNC sheet metal
cutting machines for the case when the boundary contours
of the parts are defined by polygons and the pierce points
are located on the boundary contours.
Only closed-loop cutting is used,
i.e. Continuous Cutting Problem (CCP),
hence
the task of minimizing the length of the tool path
is reduced to the problem of finding the minimum air move length,
which is shown to be equivalent to the problem of finding
the shortest polyline with vertices on disjoint contours in the plane,
while these contours do not contain internal contours.
An algorithm for constructing minimal length broken line
for a fixed order of cutting contours is described
and is proved to provide local minimum.
Sufficient conditions for this minimum to be global are given.
Heuristic algorithm is suggested for finding the optimal order for cutting contours.
The results of a computational experiment
and a comparison of the results with an exact solution for the GTSP problem are presented.

\end{abstract}

\begin{keywords}
  Continuous optimization;
  Discrete optimization;
  Fermat principle;
  Variable Neighborhood Search
\end{keywords}

\section{Introduction}

A number of optimization problems arise
during development of control programs for CNC sheet cutting machines.
One of them is
the task of minimizing the tool air move,
which in some special cases can be reduced
to the problem of finding the shortest polyline
with vertices on flat contours.
Contours are interpreted as the boundaries of flat parts.
The location of the contours on the plane is determined
during the solution of the ``nesting'' problem.
Both tasks are generally NP-hard.

In its turn,
the task of minimizing tool air move
is a subtask of another optimization problem --
the task of optimizing the tool path when cutting flat parts.
Its exact solution cannot be obtained for problems
that actually arise in production
(for hundreds of parts / contours) in a reasonable time,
therefore,
various heuristics are typically applied
to get solutions of acceptable quality.
At the same time, the issues of developing algorithms
that provide optimal solutions for some problem cases,
as well as evaluating the quality of their solutions
in comparison with the optimal solution,
remain unresolved and are of significant scientific interest.

The general problem of optimizing the tool path
when cutting 2D objects on CNC machines,
which consists in minimizing cutting time and cost,
includes a whole range of different optimization tasks.
A classification of such problems
can be found
in \cite{bi01,bi02,bi03}.

\begin{itemize}
  \item
  Continuous Cutting Problem (CCP): each closed contour (that bounds a part)
  is cut out entirely by one movement of the torch,
  but cutting can start from any point (and finishes at the same point).

  \item
  Generalized Traveling Salesman Problem (GTSP):
  cutting can start only at one of the predefined points on the contour,
  the contour must be cut entirely.

  \item
  Endpoint Cutting Problem (ECP):
  cutting can start only at one of the predefined points on the contour,
  and the contour can be cut in several approaches, in parts.

  \item
  Segment Continuous Cutting Problem (SCCP):
  the notion of a cutting segment is introduced,
  which is a generalization of a contour;
  it can be either a part of a contour
  or a combination of several contours or their parts.
  Each segment is cut out entirely, thus
  $ CCP \subset SCCP$.

  \item
  Generalized Segment Continuous Cutting Problem (GSCCP):
  segment cutting (SCCP),
  but the selection of segments is not fixed in advance,
  but is subject to optimization

  \item
  Intermittent Cutting Problem (ICP):
  the most general cutting problem described in the literature,
  when contours can be cut in parts,
  in several approaches,
  and cutting can begin at any point in the contour.
\end{itemize}

Tool path optimization problems
in practice often reduce to discrete optimization problems
by discretizing the contours to be cut with a certain step
$\varepsilon$,
that is, they reduce to ECP
\cite{bi04,bi05,bi06}
or its special case, GTSP
\cite{bi07,bi08,bi09,bi10}.
CCP can also be reduced to GTSP.
In this case, however,
the total error in the air move length reaches
$N \cdot \varepsilon$,
where $N$ is the number of contours.
To guarantee the accuracy of the result of
$\delta$,
it is necessary to choose a small
$\varepsilon \approx \delta / N$,
so the total number of points on the contour grows
(as $O (N)$)
and the exhaustive search becomes exponential.
Nevertheless, such problems can be successfully solved,
for example, by the dynamic programming method,
for small
$N \approx 30$ even precisely (see, in particular ???).

Tool path routing without using discretization (CCP)
is further considered in this paper.
The publications on this subject
are rare.
\cite{bi11,bi12}
can be noted,
where
heuristic algorithms are proposed.

\subsection{Technological constraints}

The need to execute the tool path on a
CNC sheet cutting machine imposes
a number of technological limitations on it.

The so-called ``precedence constraint''
is by far most popular in the literature.
It is caused by the fact that after cutting a closed contour,
its interior is usually not held by anything
and can freely shift, rotate and even fall.
For this reason,
the internal contours of parts must be cut
before the external contours containing them,
and parts located in the holes of large parts even earlier.

Finally, most cutting technologies require
that the cutting not be carried out strictly along the contour,
but with some indentation.
This shift can be performed both during the solution of the routing problem,
and after -- at the stage of generating the control program for the CNC cutting machine
or even by the machine itself during the cutting process.
In addition, the pierce point (tool switch-on point)
should generally be located even further
from the contour to avoid part damage.
However, this work completely ignores this requirement.
Thus, it is further assumed that the tool moves exactly
along the contour of the part
and the pierce point is located directly on the contour
(as well as the switch-off point of the tool).

\section{Continuous Cutting Problem}

Consider the Euclidean plane
$\mathbb R ^ 2$
and its region $B$ bounded by a closed contour
(rectangle in most cases),
which is a model of the sheet material to be cut.
Let $N$ pairwise disjoint flat contours
$\{C_1, C_2, ... C_N\}$
be given inside $B$, bounding $n$ parts
$\{A_1, A_2 ... A_n\}$.
A part can be limited by either one contour or several
(external and internal holes),
so that in general
$n \le N$.

The contours
$C_i$
can have an arbitrary shape,
but we will only consider the case
when they consist of (a finite number)
segments of lines and arcs of circles,
which is determined by the existing technological equipment.
In case when the contours consist only of line segments,
the continuous cutting problem
is reduced to one of the variants of the
Touring Polygon Problem (TPP),
see \cite{bi13}.

Further, two points are set in region $B$ (usually at its boundary),
we denote them as
$M_0$, $M_{N + 1}$
(almost always $M_0 = M_{N + 1}$),
which represent the beginning and end of the cutting route.

Continuous Cutting Problem is to find:
\begin{enumerate}
\item $N$ pierce points $M_i \in C_i, i \in \overline{1, N}$
\item Contour $C_i$ traversal order, i.e. permutations of $N$ elements $I = (i_1, i_2, ... i_N)$
\end{enumerate}

The result of solving the problem will be the route
$\{M_0, M_{i_1}, M_{i_2}, \dots M_{i_N}, M_{N + 1}\}$.
The objective function in this case is greatly simplified
in comparison with the general cutting problem
and is reduced to minimizing the air move length.

\begin{equation}
  \mathcal{L} = \sum_{j=0}^N|M_{i_j}M_{i_{j+1}}|
  \label{air-move-length}
\end{equation}
$$
\mathcal{L} \to \min
$$

Where, for simplicity, we introduce the notation
$M_{i_0} = M_0$,
$M_{i_{N + 1}} = M_{N + 1}$.

In addition,
we will solve the optimization problem
with an additional constraint,
the so-called ``precedence constraint''.
Although the contours $C_i$
do not intersect,
they can be nested into each other, i.e.,
$\tilde{C_a} ̃\subset \tilde{C_b}$,
where
$\tilde{C_a}$
denotes a 2-dimensional figure bounded by the contour
$C_a$
(in the more familiar notation
$C_a = \partial \tilde{C_a}$).
In the general tool path routing problem,
this can be caused by two different circumstances
(holes in parts and
placement of smaller parts
in holes larger to save material),
but in this case
these options are processed the same way.

If one contour is located inside another,
then the nested contour must be cut out
(visited)
earlier than the outer one:
$\tilde{C_a} ̃\subset \tilde{C_b} ̃\Rightarrow i_a < i_b$
in the permutation
$I = (i_1, i_2, ... i_N)$.
Thus, not all permutation of the contours are feasible.

\section{Algorithm to solve Continuous Cutting Problem}

The proposed solution algorithm
consists of several stages,
naturally associated with the nature of the problem being solved.

\subsection{Removal of external contours}

To automatically comply with the precedence constraint,
the first step removes all contours containing nested ones,
that is, only contours remain that satisfy the condition:
$$
\{C_i | \forall j \ne i: C_j \cap \tilde{C_i} = \varnothing \}
$$
This generally leads to a reduction
(in some cases significant)
of the size of the problem,
and thus reduces the calculation time
in the second and especially the third stage.

\subsection{Continuous optimization}

At this stage,
we assume the bypass sequence
$I = (i_1, i_2, ... i_N)$
given and look for the coordinates of the pierce points
in each contour
$M_i \in C_i$,
minimizing the total air move length (\ref{air-move-length}).
To do this, the initial positions of the points are somehow selected
(randomly, for instance)
and the position of each pierce point $M_i$
changes under the assumption that others are fixed:
$\mathcal{L}(M_i) \to \min$.
Most terms in the objective function
(\ref{air-move-length})
are constant, therefore it simplifies to
$$
|M_{i-1}M_i|+|M_iM_{i+1}| \to \min_{M_i \in C_i}
$$

Moreover,
if the points
$M_{i-1}$,
$M_{i + 1}$
are located on opposite sides of the segment of the contour
$C_i$,
then the optimal position of the
pierce point $M_i$ is the intersection with the segment:
$M_i = M_{i-1} M_{i + 1} \cap C_i$
(if such an intersection exists;
otherwise,
the solution will be one of the ends of the segment).
If the points are located on one side of the segment,
then the solution can also be easily found using the
\textit{Fermat principle},
generating the famous rule
``the angle of incidence is angle of reflection''
(or again one of the ends of the segment),
see fig. \ref{fermat}.

\begin{figure}
  \begin{center}
  \tikz[rotate=27,scale=1.3]{
      \draw[thick]
          (0, 0) coordinate(zero) -- (5, 0) coordinate(future) node[right] {$C_i$};
      \fill[black]
          (1.5, 0) circle(0.1) coordinate(middle) node[below right]  {$M_i$}
          (1, 1) circle(0.1) coordinate(from) node[above left] {$M_{i-1}$} ++(-1.5,0) node[above] {$C_{i-1}$}
          (4.5, 2) circle(0.1) coordinate(to) node[above] {$M_{i+1}$} ++(1.5,0) node[below] {$C_{i+1}$};
      \begin{scope}
          \clip (from) circle(1);
          \draw[thick] (from) ++(0, 3) circle(3);
      \end{scope};
      \begin{scope}
          \clip (to) circle(1.5);
          \draw[thick] (to) ++(3, 4) circle(5);
      \end{scope};
      \draw[dashed] (from) -- (middle) -- (to);
      \draw[thin] (4.5, -2) circle(0.062) coordinate(mirror) node[right] {$\hat M_{i+1}$};
      \coordinate (opt) at (intersection of zero--future and mirror--from);
      \draw[thin] (opt) circle(0.1);
      \draw[dotted]
          (mirror) -- (opt)
          (mirror) -- (to);
      \draw[thin] (from) -- (opt) -- (to);

      \draw[->,>=latex,red,thick] (middle) to[bend right] (opt);

  }
  \caption{Applying \textit{Fermat principle} to find piercing point} \label{fermat}
  \end{center}
\end{figure}

The general optimization scheme at this stage looks like this:
\begin{enumerate}
  \item
  We choose arbitrary initial positions of the inset points
  $M_i \in C_i, \forall i$.
  \item
  $\forall i \in \overline{1,N}$
  we find the optimal position
  $M_i$ as described above in constant time $O(1)$.
  \item
  We repeat the previous step
  until the air move length
  (\ref{air-move-length})
  stabilizes (with some predetermined accuracy $\delta$).
\end{enumerate}

In practice,
the whole process converges well in
$O(N)$
time and therefore is repeatedly used
as a subroutine in the next step.

\subsection{Discrete optimization}

\subsection{Recovery of removed contours}

\section{Optimality of continuous optimization problem solution}

\section{Numerical experiments}

\section{Conclusion}

\section*{Acknowledgements}

The work was supported by
Act 211 Government of the Russian Federation,
contract \textnumero 02.A03.21.0006,
and by Ministry of Education and Science
of the Russian Federation,
project \textnumero 2.9563.2017/8.9

\bibliographystyle{tfs}
\bibliography{ccp}
\nocite{*}

\end{document}
