\documentclass[11pt,twoside,openany]{report}

\input{control/ru.tex}
\input{control/packages.tex}
\input{control/sizes.tex}
\input{control/gost.tex}
\input{control/biblio.tex}
\input{control/greek.tex}
\input{control/the.tex}
\input{control/theorem.tex}
\input{control/shorten.tex}
\input{control/headings.tex}

\graphicspath{{media/}}

%\nofiles
\begin{document}

\input{txt/title.tex}
\input{txt/-title.tex}

\newpage
\tableofcontents

\input{txt/intro.tex}
\input{txt/i.tex}
\input{txt/ii.tex}

\chapter{
  ЗАДАЧИ МАРШРУТИЗАЦИИ С~ОГРАНИЧЕНИЯМИ И~УСЛОЖНЕННЫМИ
  ФУНКЦИЯМИ СТОИМОСТИ
}
%\setcounter{section}{1}\setcounter{subsection}{1}
\setcounter{chapter}{4}
\setcounter{equation}{0}


\section{\protect\raggedright
  Введение
}
\label{sect:4.1}
\setcounter{equation}{0}

В предыдущих главах в достаточной степени были прояснены особенности задач
маршрутизации, связанных с ЧПУ; в какой-то мере обсуждались и некоторые
обстоятельства, касающиеся применения математических методов к решению других
прикладных задач (в частности, это касается задачи о демонтаже энергоблока
АЭС, выведенного из эксплуатации). Упомянутые особенности связаны, конечно,
с определенной спецификой соответствующих прикладных задач; они вполне
заслуживают специального теоретического исследования, что в достаточной
мере отражено в конструкциях предыдущей главы. Есть, однако, также
известные трудности вычислительного характера, которые, по-видимому,
являются общими для всех задач  маршрутизации, включая хорошо известную
ЗК. Данные переборные задачи являются труднорешаемыми в традиционном
понимании (упомянутая ЗК является одной из классических NP-полных задач).
Эта сторона дела конечно же в полной мере проявляется и в вышеупомянутых
прикладных задачах при соответствующей  их формализации. По этой причине
(и это вполне естественно) основные усилия специалистов направлены здесь
на построение эффективных приближенных алгоритмов. Конструкции на основе
ДП (даже с учетом применения экономии вычислений за счет <<неполного>>
построения массива значений функции Беллмана) не могут быть применены для
непосредственного решения маршрутных задач большой размерности, хотя и
доставляют полезные представления, связанные с глобальной оптимальностью.
Эти представления, в частности, могут помочь в некоторых вопросах,
связанных с локальным улучшением эвристических решений. Данные улучшения
имеет смысл реализовывать в итерационном режиме, то есть неоднократно,
что в ряде случаев приводит, как показывает вычислительный эксперимент,
уже к ощутимым результатам.

Для определенности будем рассматривать сейчас проблему, связанную с
листовой резкой на машинах с ЧПУ (см. раздел~3.3). При использовании
математической модели на основе построения мегаполисов приходится учитывать,
что последние связываются не столько с самими деталями, сколько с контурами,
подлежащими резке. Этих контуров у одной детали может быть несколько.
Общее же количество таких контуров может быть достаточно большим
(см. (\ref{3.3.6})). Таким образом, приходится обращаться к эвристическим
алгоритам; их изучение важно прежде всего с практической точки зрения.
Вместе с тем учет ограничений в классе таких алгоритмов представляется
затруднительным; в особенности это касается требований к жесткости листа
и деталей, выбора направления резки и т.п. На этапе применения ДП некоторые
из этих ограничений удается учитывать (см. задачу (\ref{3.3.31})).  Уже это
соображение делает полезным осуществление <<вмешательств>>, использующих ДП
с целью коррекции эвристических решений. Для последних могут быть при этом
выделены (после их построения) <<неудачные>> фрагменты; на замену этих
фрагментов можно направить соответствующие  усилия, задействуя, в частности,
аппарат ДП. Именно такая стратегия будет использоваться ниже. Отметим,
однако, что в рассматриваемом здесь весьма общем случае задачи с ограничениями
потребуется специальное теоретическое исследование ряда вопросов, касающихся
самой организации вставок.

Один из таких вопросов  связан с условиями предшествования: оптимизирующая
вставка должна иметь (локальные) условия предшествования, согласованные
определенным образом с глобальными (данный вопрос подробно рассматривался
в \cite{Cha14`}). Иными словами, возникает проблема локализации глобальных
условий предшествования.

Второй весьма важный вопрос касается проблемы согласования глобальных и
локальных зависимостей от списка заданий. Данные зависимости естественным
образом возникают в задаче о демонтаже оборудования энергоблока АЭС,
выведенного из эксплуатации (см. \cite{Cha2`}): исполнитель подвергается
радиационному воздействию источников излучения, которые еще не демонтированы
на текущий момент. В задаче, связанной с планированием процедуры листовой
резки на машинах с ЧПУ, таких зависимостей в непосредственном виде нет;
однако, их оказывается полезным ввести с целью учета технологических
ограничений, связанными с обеспечением жесткости листа. Опуская сейчас
обсуждение данного приема, подобного введению штрафов в задачах оптимизации,
отметим, что данная особенность также осложняет изучение конструкций,
связанных со вставками. Следуем здесь процедуре, предложенной и обоснованной
в \cite{Cha13`}. Достаточно подробное ее рассмотрение здесь целесообразно
еще и потому, что упомянутая процедура будет встраиваться в итерационные
алгоритмы с целью реализации более ощутимого влияния на результат,
достигаемый посредством эвристических методов.


\section{\protect\raggedright
  Постановка задачи
}
\label{sect:4.2}
\setcounter{equation}{0}

Мы будем использовать обозначения и определения, относящиеся к варианту
(\ref{3.6.1}); учитываем (\ref{3.6.7}), (\ref{3.6.10}). Однако сначала введем
новый кортеж функций стоимости: полагаем в дальнейшем, что вместо (\ref{3.3.29})
фиксированы функции
\bfn\label{4.2.1}
\mathbf{c}\in \car_+[\bbx\times \bbx\times \mathfrak{N}], c_1\in \car_+
[\bbx\times \bbx\times \mathfrak{N}],\ldots,c_N\in \car_+[\bbx\times
\bbx\times \mathfrak{N}], f\in \car_+[\bbx]
\efn
(функция $f$ сохранена). Как и в предыдущей главе, функции (\ref{4.2.1})
предполагаются <<максимально>> продолженными, что, впрочем, не представляет
каких-либо затруднений (см. замечание~\ref{z3.3.3}). Отметим только, что по
своему смыслу третий аргумент у функций $\mathbf{c}, c_1,\ldots,c_N$ будет
играть в дальнейшем роль списка заданий, которые  не выполнены на текущий
момент времени. Впрочем, возможна ситуация, когда реально функции стоимости,
подобные (\ref{4.2.1}), зависят  от списка уже выполненных заданий. Однако
этот последний список определяется посредством дополнения того списка, о
котором шла речь ранее, и мы можем использовать схему, излагаемую ниже для
варианта со списком невыполненных заданий.

Отметим сейчас, что значения $\mathbf{c}(x,y,K)$ функции $\mathbf{c}$ будут
существенны для нас при оценивании перемещений $x\rightarrow y,$ где $y$ ---
точка мегаполиса, в одном из следующих двух случаев: 1) $x= x^o$ и $K =
\ov{1,N};$ 2) $x\in M_j$ при $j\in \ov{1,N}\sm K,\, K\neq \emp,$ а индекс
мегаполиса, содержащего $y,$ включается в список $K$ (списки для нас ---
непустые п/м $\ov{1,N}).$

Если же $s\in \ov{1,N},$ то значения $c_s(x,y,K)$ функции $c_s$ будут
использоваться в случаях, когда $(x,y)\in \bbm_s,\, K$ --- непустое п/м
$\ov{1,N},$ для которого $s\in K.$ Таким образом, как и в разделе 3.3,
значения $c_s$ существенны в вопросах, связанных с оценкой (внутренних)
работ, отвечающих посещению мегаполиса $M_s.$

Полезно иметь в виду, что в целом ряде прикладных задач зависимость
величин $\mathbf{c}(x,y,K), c_1(x,y,K),\ldots,c_N(x,y,K)$ от списка $K$
может быть связана с реальными вредными воздействиями, отвечающими заданиям
с индексами из $K.$ Это, в частности, касается задач, связанных с выполнением
работ по демонтажу радиоактивного оборудования, изучаемых в \cite{Cha2`}:
речь идет о дозах радиации, создаваемых недемонтированными на данный момент
излучающими элементами упомянутого оборудования.

В других случаях (они для нас далее существенны) использование зависимости
от списка заданий в (\ref{4.2.1}) может отвечать естественному желанию учесть
ограничения некоторых типов. Здесь упомянутое использование подобно известному
(см., например, \cite[202--205]{Cha9`}) приему, связанному с введением
штрафных функций: посредством упомянутой зависимости мы стремимся сделать
крайне невыгодными  (по результату) перемещения, приводящие к нарушению
ограничений.

Обсудим последнее обстоятельство на примере ограничения, связанного с
жесткостью листа в задаче предыдущей главы в том ее варианте, который можно
связать с листовой резкой на машинах с ЧПУ (см. \cite{Cha10`}). Итак, пусть
(в данном рассуждении) мегаполисы $M_1,\ldots,M_N$ --- суть конечные
множества на плоскости, содержащиеся в прямоугольнике $[0,a] \times
[0,b],$ где $a > 0$ и $b> 0$ --- два достаточно больших числа. Учитываем
(см. раздел 3.3), что   каждый мегаполис $M_j$ связан с контуром
(внутренним или внешним) некоторой детали $\mathbf{D}_l,$ где $l\in
\ov{1,n}.$ Если уже произведена резка данного контура по соответствующей
ему эквидистанте, то в результате (данной резки) образовалась пустота.

Если теперь (так или иначе) уже проделана работа по резке контуров,
связанных с мегаполисами, имеющими индексы из непустого множества
$\widetilde{K},\, \widetilde{K}\su \ov{1,N},$ и на очереди находится
врезка в соответствующую точку мегаполиса $M_j,$ где $j\in \ov{1,N}\sm
\widetilde{K},$ то новую точку врезки надо выбрать  в отдалении от
<<суммы пустот>>, возникших в связи с уже произведенными операциями
резки, характеризуемыми индексами $k\in \widetilde{K}$ (упомянутые
операции были связаны с посещением мегаполисов $M_k, k\in \widetilde{K}).$

В рамках предлагаемого подхода мы, однако, отказываемся от того, чтобы
налагать жесткий запрет на выбор точки врезки вблизи пустот; такой выбор
допускается. Однако стоимость перемещения в соответствующую непригодную
(на самом деле) точку назначается очень большой, а потому такое перемещение
становится крайне невыгодным.  Аналогичные соглашения принимаются в отношении
стоимостей (внутренних) работ, связанных в данной конкретной задаче  с
перемещениями от точки врезки к эквидистанте и от эквидистанты к точке
выключения инструмента (имеются в виду перемещения в режиме рабочего хода).

Заметим, что по ряду причин, связанных с последующим применением ДП,
оказывается более  удобным определять на формальном уровне для функций
стоимости не зависимость от списка $\widetilde{K}$ уже выполненных на
данный момент заданий, а от списка $K$ еще не выполненных заданий (как
в случае вышеупомянутой задачи о демонтаже), что, однако, является
несущественной редакцией, поскольку
\bfn\label{4.2.2}
\widetilde{K} = \ov{1,N}\sm K.
\efn
Это соображение как раз и было учтено выше (см. (\ref{4.2.1})), где третий
аргумент функций $\mathbf{c},c_1,\ldots,c_N$ соответствовал $K$ в (\ref{4.2.2}).
Всюду в дальнейшем мы следуем данной интерпретации функций в (\ref{4.2.1}).
Если теперь (см. (\ref{3.3.15}))
у нас выбраны маршрут $\al\in \bbp$ и трасса $(z_i)_{i\in\ov{0,N}}\in
\mathbf{Z}_\al,$ то при $s\in \ov{1,N}$
в виде
\bfn\label{4.2.3}
\mathbf{c}\bigl(\mathrm{pr}_2(z_{s-1}),\mathrm{pr}_1(z_s),\{\al(t):\,t\in \ov{s,N}\}\bigl)
\in [0,\infty[, c_{\al(s)}\bigl(z_s, \{\al(t):\,t\in \ov{s,N}\}\bigl)\in [0,\infty[
\efn
реализуются конкретные  оценки затрат (потерь), связанных с перемещением
$$ \mathrm{pr}_2(z_{s-1}) \longrightarrow \mathrm{pr}_1(z_s)
$$
и работами, определяемыми упорядоченной парой
$$z_s = \bigl(\mathrm{pr}_1(z_s),\mathrm{pr}_2(z_s)\bigl)$$
и связанными с посещением мегаполиса $M_{\al(s)}.$ Величины (\ref{4.2.3})
суммируются  и, с добавлением
слагаемого
$$
f\bigl(\mathrm{pr}_2(z_N)\bigl)\in [0,\infty[,
$$
определяют стоимость решения $\bigl(\al,(z_i)_{i\in\ov{0,N}}\bigl).$
Напомним, что всюду в дальнейшем множество ДР отождествляется с
$\widetilde{\mathbf{D}}$ (\ref{3.3.27}), которое непусто и конечно.

Если $\al\in \bbp$ и $(z_i)_{i\in\ov{0,N}}\in \bbz,$ то полагаем, что
\begin{eqnarray}
&\mathfrak{B}_\al [(z_i)_{i\in\ov{0,N}}] \df \sum\limits_{s=1}^N
\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(z_{s-1}),\mathrm{pr}_1(z_s),\{\al(t):\,
t\in \ov{s,N}\}\bigl) +
&\nonumber\\
&+  c_{\al(s)}\bigl(z_s,\{\al(t):\,t\in \ov{s,N}\}\bigl)\bigl)\bigl] +
f\bigl(\mathrm{pr}_2(z_N)\bigl),
&\label{4.2.4}
\end{eqnarray}
получая неотрицательное число. Значение (\ref{4.2.4}) существенно в
последующих построениях при
$$
\al\in \mathbf{A},\, (z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al,
$$
то есть при $\bigl(\al,(z_i)_{i\in\ov{0,N}}\bigl)\in \widetilde{\mathbf{D}}.$
В качестве обобщенного аналога (\ref{3.3.34}) рассматриваем задачу
\bfn\label{4.2.5}
\mathfrak{B}_\al[(z_i)_{i\in\ov{0,N}}]\longrightarrow \min,\,\al\in \mathbf{A},\,
(z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al.
\efn
Ограничения задачи (\ref{4.2.5}) совместны, а потому определены значение
(экстремум)
\bfn\label{4.2.6}
\mathbb{V} \df \min\limits_{\al\in \mathbf{A}}\
\min\limits_{(z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al}
\mathfrak{B}_\al[(z_i)_{i\in\ov{0,N}}]\in [0,\infty[
\efn
и непустое множество оптимальных ДР; заметим, что ДР
\bfn\label{4.2.7}
\bigl(\al^o,(z_i^o)_{i\in\ov{0,N}}\bigl)\in \widetilde{\mathbf{D}}
\efn
оптимально тогда и только тогда, когда
\bfn\label{4.2.8}
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}]\leqslant \mathfrak{B}_\al
[(z_i)_{i\in\ov{0,N}}]\ \ \fa \al\in \mathbf{A}\ \ \fa
(z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al.
\efn
Мы ставим своей целью нахождение значения $\mathbb{V}$ и какого-либо
оптимального ДР. Разумеется, для каждого ДР (\ref{4.2.7}) со свойством
(\ref{4.2.8}) справедливо равенство
$$
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}]  = \mathbb{V}.
$$
Отметим, что в (\ref{4.2.5}) мы имеем очень сложную задачу, для
эффективного решения которой следует разрабатывать эвристические методы,
учитывая проблемы, связанные с размерностью. Тем не менее важно также
иметь представление о структуре оптимальных решений, в связи с чем в
следующем разделе будет рассмотрена схема широко понимаемого ДП (подробнее
см. в \cite{Cha3`,Cha11`,Cha12`}).

\section{\protect\raggedright
  Динамическое программирование при усложненных функциях стоимости
}
\label{sect:4.3}
\setcounter{equation}{0}

Мы без  дополнительных пояснений используем построения главы 3, касающиеся
маршрутов и трасс (траекторий). В частности, используем конструкции
раздела 3.4, связанные с редукцией системы ограничений (замена допустимости
по предшествованию допустимостью по вычеркиванию). В этой связи, действуя
в духе (\ref{3.4.20}),
полагаем при $x\in \bx,\,K\in \mathfrak{N},\,\al\in (\mathrm{bi})[K]$ и
$(z_i)_{i\in\ov{0,|K|}} \in \mathbf{Z}(x,K,\al),$ что
\begin{eqnarray}
&\widehat{\mathfrak{B}}_\al[(z_i)_{i\in\ov{0,|K|}}\,\bigl|\,K]  \df
\sum\limits_{t=1}^{|K|}\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(z_{t-1}),\mathrm{pr}_1(z_t),\{\al(j):\,
j\in \ov{t,|K|}\}\bigl) +
&\nonumber\\
&+ c_{\al(t)}\bigl(z_t, \{\al(j):\, j\in \ov{t,|K|}\}\bigl)\bigl] +
f\bigl(\mathrm{pr}_2(z_{|K|})\bigl).
&\label{4.3.1}
\end{eqnarray}
Разумеется, (\ref{4.3.1}) можно, в частности, рассматривать при
$x=x^o,\,K= \ov{1,N},\,\al\in \bbp$ и
$(z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al$ (учитываем (\ref{3.4.15})).
Легко видеть, что в этом случае
мы приходим к (\ref{4.2.4}):
\bfn\label{4.3.2}
\widehat{\mathfrak{B}}_\al[(z_i)_{i\in\ov{0,N}}|\,\ov{1,N}] = \mathfrak{B}_\al
[(z_i)_{i\in\ov{0,N}}]
\ \ \fa\al\in \bbp\ \ \fa (z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al.
\efn
Учитывая свойства, отмеченные в разделе 3.4   (см., в частности,
(\ref{3.4.6})), при $x\in \bx$ и $K\in \mathfrak{N}$ мы в виде
\bfn\label{4.3.3} \widehat{\mathfrak{B}}_\al[(z_i)_{i\in\ov{0,|K|}}|\,K]
\longrightarrow \min,\ \al\in (\mathbf{I}-\mathrm{bi})[K],\,
(z_i)_{i\in\ov{0,|K|}}\in \mathbf{Z}(x,K,\al)
\efn
имеем экстремальную задачу, у которой ограничения совместны, а
пространство решений составляет непустое конечное множество; поэтому
определено значение (экстремум)
\bfn\label{4.3.4}\mathbf{v}(x,K) \df \min\limits_{\al\in (\mathbf{I}-
\mathrm{bi})[K]}\ \min\limits_{(z_i)_{i\in\ov{0,|K|}}\in
\mathbf{Z}(x,K,\al)}\widehat{\mathfrak{B}}_\al[(z_i)_{i\in\ov{0,|K|}}|\,K]
\in [0,\infty[
\efn
и непустое (конечное) множество оптимальных решений данной задачи
(\ref{4.3.3}). В частности, задачу (\ref{4.3.3}) можно рассматривать
при $x=x^o$ и $K=\ov{1,N};$ соответственно, для этого случая определено
значение (\ref{4.3.4}), то есть величина $\mathbf{v}(x^o,\ov{1,N}).$ С
учетом (\ref{3.4.8}), (\ref{3.4.13}), (\ref{4.2.6}) и (\ref{4.3.4}) имеем
равенство
\bfn\label{4.3.5}
\mathbb{V} = \mathbf{v}(x^o,\ov{1,N}),
\efn
показывающее по сути дела, что задачи (\ref{4.3.3}) в своей совокупности
образуют расширение базовой задачи (\ref{4.2.5}). Полагаем, наконец, что
\bfn\label{4.3.6}\mathbf{v}(x,\emp) \df f(x)\ \ \fa x\in \mathbf{X},
\efn
определяя тем самым краевое условие в схеме  построения функции Беллмана
(с учетом (\ref{3.4.25}) и (\ref{4.3.6}) имеем, в частности, что $v(x,\emp) =
\mathbf{v}(x,\emp)$ при $x\in \mathbf{X}).$ Таким образом,  в новых (усложненных)
условиях определена функция
$$
\mathbf{v}:\ \bx \times \cp(\ov{1,N}) \longrightarrow [0,\infty[;
$$
иными словами, имеем в силу (\ref{4.3.4}) и (\ref{4.3.6}), что
$\mathbf{v}\in \car_+[\bx \times \cp(\ov{1,N})].$ Из
\cite[теорема~5.1]{Cha3`} вытекает, в частности, следующее
\begin{pred}\label{p4.3.1}{\TL} Если $x\in \bx$ и $K\in \mathfrak{N},$ то
$$
\mathbf{v}(x,K) = \min\limits_{j\in\mathbf{I}(K)}\ \min\limits_{z\in
\bbm_j}\bigl[\mathbf{c}\bigl(x,\mathrm{pr}_1(z),K\bigl) + c_j(z,K) +
\mathbf{v}\bigl(\mathrm{pr}_2(z),K\sm\{j\}\bigl)\bigl].
$$
\end{pred}

С учетом (\ref{4.3.5}) и предложения~\ref{p4.3.1} получаем (см.
\cite[следствие~5.1]{Cha3`}) очевидное

\begin{cor}\label{p4.3.1}{\TL} Справедливо равенство
$$\mathbb{V} = \min\limits_{j\in\mathbf{I}(\ov{1,N})}\ \min\limits_{z\in
\bbm_j}\bigl[\mathbf{c}\bigl(x^o,\mathrm{pr}_1(z),\ov{1,N}\bigl) +
c_j(z,\ov{1,N}) + \mathbf{v}\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{j\}\bigl)\bigl].
$$
\end{cor}

Теперь, как и в более простой идейно задаче раздела~3.5, мы рассмотрим
слои функции Беллмана, следуя в части определения слоев пространства
позиций обозначениям упомянутого  раздела. В этой связи полезно иметь
в виду также пояснения раздела~3.6.

Итак, учитывая (\ref{3.5.13}), мы полагаем, что, как и в \cite[(6.12)]{Cha3`}, при
$s\in \ov{0,N}$ функция
\bfn\label{4.3.6`}\mathbf{v}_s\in \car_+ [D_s]
\efn
определяется следующим условием:
\bfn\label{4.3.7}\mathbf{v}_s(x,K) \df \mathbf{v}(x,K)\ \ \fa (x,K)\in D_s.
\efn
Таким образом, определены (см. (\ref{4.3.6}), (\ref{4.3.7})) следующие функции
$$
\mathbf{v}_o\in \car_+[D_o],\,\mathbf{v}_1\in \car_+[D_1],\cdots,
\mathbf{v}_N\in \car_+[D_N],
$$
роль которых подобна той роли, которую играли функции (\ref{3.5.19}) в
построениях предыдущей главы. Отметим, что из (\ref{4.3.6}) и (\ref{4.3.7})
следует, в частности, что функция
\bfn\label{4.3.8}
\mathbf{v}_o\in \car_+[D_o],
\efn
однозначно определяется правилом
\bfn\label{4.3.9}\mathbf{v}_o(x,\emp) = f(x)\ \ \fa x\in
\bigcup\limits_{i\in\ov{1,N}\sm \mathbf{K}_1}\mathbf{M}_i
\efn
(мы используем здесь (\ref{3.5.9})). Из (\ref{3.5.20}) и (\ref{4.3.9})
имеем равенство $v_o = \mathbf{v}_o,$ что и следовало ожидать, поскольку
<<терминальная>> функция $f$ не изменялась
(см. (\ref{4.2.1})). Далее, из определений раздела 3.5 и (\ref{4.3.7})
следует, что
$$
\mathbf{v}_N(x^o,\ov{1,N}) = \mathbf{v}(x^o,\ov{1,N}).
$$
С учетом (\ref{4.3.5}) получаем важное равенство
\bfn\label{4.3.10}\mathbf{v}_N(x^o,\ov{1,N})= \mathbb{V}.
\efn
Посредством (\ref{4.3.9}) и (\ref{4.3.10}) определены крайние слои
функции Беллмана. При построении
промежуточных слоев следует учитывать (\ref{3.6.13}):  если $s\in\ov{1,N},\,
(x,K)\in D_s,\,j\in \mathbf{I}(K)$ и $z\in \bbm_j,$ то определено значение
$$
\mathbf{v}_{s-1}\bigl(\mathrm{pr}_2(z),K\sm\{j\}\bigl)\in [0,\infty[.
$$
Поэтому при $s\in\ov{1,N}$ и $(x,K)\in D_s$ у нас определены значения
$\mathbf{v}_s(x,K)\in [0,\infty[$ и
$$
\min\limits_{j\in \mathbf{I}(K)}\ \min\limits_{z\in\bbm_j}
\bigl[\mathbf{c}\bigl(x,\mathrm{pr}_1(z),K\bigl) +
c_j(z,K) + \mathbf{v}_{s-1}\bigl(\mathrm{pr}_2(z),K\sm\{j\}\bigl)
\bigl]\in [0,\infty[.
$$
С учетом предложения~\ref{p4.3.1}  получаем теперь частный
случай \cite[предложение~6.1]{Cha3`}:
если $s\in\ov{1,N},$ то преобразование
\bfn\label{4.3.11}
\mathbf{v}_{s-1}\longrightarrow \mathbf{v}_s
\efn
определяется правилом
\begin{eqnarray}
&\mathbf{v}_s(x,K) =  \min\limits_{j\in \mathbf{I}(K)}\
\min\limits_{z\in\bbm_j}\bigl[\mathbf{c}\bigl(x,\mathrm{pr}_1(z),K\bigl) +
 c_j(z,K) +
&\nonumber\\
&+\mathbf{v}_{s-1}\bigl(\mathrm{pr}_2(z),K\sm\{j\}\bigl)\bigl]\ \
\fa (x,K)\in  D_s.
\label{4.3.12}
\end{eqnarray}
Итак, мы получаем рекуррентную процедуру построения функций (\ref{4.3.8}):
\bfn\label{4.3.13}
\mathbf{v}_o\longrightarrow  \mathbf{v}_1\longrightarrow\cdots
\longrightarrow \mathbf{v}_{N-1}\longrightarrow \mathbf{v}_N;
\efn
при этом функция $\mathbf{v}_o$ в (\ref{4.3.13}) известна
(см. (\ref{4.3.9})), а каждый регулярный
шаг данной процедуры реализуется посредством  (\ref{4.3.12}).

В заключении раздела совсем кратко рассмотрим построение оптимального
решения в виде соответствующей пары маршрут-трасса. Однако сначала
отметим, что согласно (\ref{4.3.10}) и (\ref{4.3.12})
\bfn\label{4.3.14}
\mathbb{V} = \min\limits_{j\in \mathbf{I}(\ov{1,N})}\
\min\limits_{z\in\bbm_j}\bigl[\mathbf{c}\bigl(x^o,\mathrm{pr}_1(z),\ov{1,N}\bigl) +
 c_j(z,\ov{1,N}) + \mathbf{v}_{N-1}\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{j\}\bigl)\bigl]
\efn
(полезно напомнить, что согласно (\ref{3.6.13})
$$
\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{j\}\bigl)\in D_{N-1}
$$
при $j\in\mathbf{I}(\ov{1,N})$ и $z\in\bbm_j,$ что позволяет в силу
(\ref{4.3.6`}) определять и использовать
$$
\mathbf{v}_{N-1}\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{j\}\bigl)\in[0,\infty[;
$$
это и было сделано в (\ref{4.3.14})). Полагаем, как и в разделе~3.5,
$\mathbf{z}^{(o)}\df (x^o,x^o),$ получая, в частности, что
$\mathbf{z}^{(0)}\in \bbx\times \mathbf{X}.$

С учетом (\ref{4.3.14}) выбираем $\mathbf{j}_1\in \mathbf{I}(\ov{1,N})$ и
$\mathbf{z}^{(1)}\in \bbm_{\mathbf{j}_1}$ из условия
\bfn\label{4.3.15}
\mathbb{V}= \mathbf{c}\bigl(x^o,\mathrm{pr}_1(\mathbf{z}^{(1)}),\ov{1,N}\bigl) +
c_{\mathbf{j}_1}(\mathbf{z}^{(1)},\ov{1,N}) + \mathbf{v}_{N-1}
\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}),\ov{1,N}\sm\{\mathbf{j}_1\}\bigl)
\efn
(решаем локальную экстремальную задачу, связанную с (\ref{4.3.14})),
получая, кроме того, включение
\bfn\label{4.3.16}
\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}),\ov{1,N}\sm\{\mathbf{j}_1\}\bigl)\in D_{N-1}.
\efn
Из (\ref{3.6.13}) и (\ref{4.3.16}) имеем, конечно, свойство
\begin{eqnarray}
&\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{\mathbf{j}_1;j\}\bigl) =
\bigl(\mathrm{pr}_2(z),(\ov{1,N}\sm
\{\mathbf{j}_1\})\sm\{j\}\bigl)\in D_{N-2}\ \
&\nonumber\\
&\fa j\in
\mathbf{I}(\ov{1,N}\sm\{\mathbf{j}_1\})\
\ \fa z\in \bbm_j.
\end{eqnarray}
%\end{document}
Согласно (\ref{4.3.12}) и (\ref{4.3.16}) получаем теперь следующее равенство:
\begin{eqnarray}
&\mathbf{v}_{N-1}\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}),\ov{1,N}\sm\{\mathbf{j}_1\}
\bigl)=
&\nonumber\\
&=\min\limits_{j\in\mathbf{I}(\ov{1,N}\sm\{\mathbf{j}_1\})}\
\min\limits_{z\in\bbm_j}\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}),\mathrm{pr}_1(z),
\ov{1,N}\sm \{\mathbf{j}_1\}\bigl) +
&\nonumber\\
&+ c_j(z,\ov{1,N}\sm\{\mathbf{j}_1\}) +
\mathbf{v}_{N-2}\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{\mathbf{j}_1;j\}\bigl)\bigl].
&\label{4.3.17}
\end{eqnarray}
С учетом (\ref{4.3.17}) выбираем $\mathbf{j}_2\in \mathbf{I}(\ov{1,N}\sm
\{\mathbf{j}_1\})$ и $\mathbf{z}^{(2)}\in \bbm_{\mathbf{j}_2}$ из условия
\begin{eqnarray}
&\mathbf{v}_{N-1}\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}),\ov{1,N}\sm\{\mathbf{j}_1\}
\bigl) = \mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}, \mathrm{pr}_1(\mathbf{z}^{(2)},\ov{1,N}\sm
\{\mathbf{j}_1\}\bigl) +
&\nonumber\\
&+ c_{\mathbf{j}_2}(\mathbf{z}^{(2)}, \ov{1,N}\sm\{\mathbf{j}_1\}) +
\mathbf{v}_{N-2}\bigl(\mathrm{pr}_2(\mathbf{z}^{(2)}),\ov{1,N}\sm\{\mathbf{j}_1;\mathbf{j}_2\}\bigl);
&\label{4.3.18}
\end{eqnarray}
отметим в этой связи, что согласно (\ref{3.6.13})
$$\bigl(\mathrm{pr}_2(\mathbf{z}^{(2)}),\ov{1,N}\sm\{\mathbf{j}_1;\mathbf{j}_2\}\bigl)\in D_{N-2}.
$$
Данное построение следует продолжать вплоть до исчерпывания $\ov{1,N}.$ При этом должны
последовательно выбираться упорядоченные пары $(\mathbf{j}_t,\mathbf{z}^{(t)}), t\in \ov{1,N},$
в соответствии с требованиями, подобными (\ref{4.3.15}) и (\ref{4.3.18}). В результате будут
сформированы кортежи
$$\eta\df (\mathbf{j}_t)_{t\in\ov{1,N}}\in \mathbf{A},\ \ (\mathbf{z}^{(t)})_{t\in \ov{0,N}}\in \mathbf{Z}_\eta,
$$
образующие в совокупности ДР
$$\bigl(\eta, (\mathbf{z}^{(t)})_{t\in \ov{0,N}}\bigl)\in \widetilde{\mathbf{D}},
$$
для которого
\bfn\label{4.3.19} \mathbb{V}= \mathfrak{B}_\eta[(\mathbf{z}^{(t)})_{t\in \ov{0,N}}].
\efn
\begin{zam}\label{z4.3.1}{\TL}
 В связи с $(\ref{4.3.19})$ отметим, что из $(\ref{4.3.15})$ и $(\ref{4.3.18})$ вытекает, что
\begin{eqnarray}
& \mathbb{V}=\mathbf{c}\bigl(x^o,\mathrm{pr}_1(\mathbf{z}^{(1)}),\ov{1,N}\bigl) +
\mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{z}^{(1)}), \mathrm{pr}_1(\mathbf{z}^{(2)}),\ov{1,N}\sm
\{\mathbf{j}_1\}) +
&\nonumber\\
&+  c_{\mathbf{j}_1}(\mathbf{z}^{(1)},\ov{1,N}) +
c_{\mathbf{j}_2}(\mathbf{z}^{(2)},
\ov{1,N}\sm\{\mathbf{j}_1 \}) +
\mathbf{v}_{N-2}\bigl(\mathrm{pr}_2(\mathbf{z}^{(2)}),\ov{1,N}\sm\{\mathbf{j}_1;\mathbf{j}_2\}\bigl).
&\label{4.3.20}
\end{eqnarray}
 Из $(\ref{4.3.20})$ при $N=2$ равенство $(\ref{4.3.19})$ следует непосредственно (см.
определение $\mathbf{v}_o$ и $(\ref{4.3.9})).$
 \hfill $\Box$
 \end{zam}

Таким образом, оптимальное ДР задачи (\ref{4.2.5}) построено. Характерной его особенностью является
<<синхронное>> построение элементов маршрута и трассы (см. (\ref{4.3.15}), (\ref{4.3.18})) при
последовательном решении локальных задач на основе ДП.

\section{\protect\raggedright
  Локальное улучшение допустимых решений
}
\label{sect:4.4}
\setcounter{equation}{0}

В настоящем разделе рассматривается конструкция, связанная с применением вставок,
организованных на основе ДП (в принципе можно было бы задействовать при построении
вставок тот или иной вариант метода ветвей и границ; возникают, однако, затруднения,
связанные с учетом ограничений и использованием функций стоимости, включающих
зависимость от списка заданий). Упомянутая конструкция соответствует  \cite{Cha13`},
где рассматривается общий случай, соответствующий постановке задачи (\ref{4.2.5});
в этой связи отметим также работы   \cite{Cha14`,Cha15`}.

Итак, мы рассматриваем ниже случай, когда размерность исходной маршрутной задачи (\ref{4.2.5})
оказывается достаточно большой, что не позволяет организовать вычисления на основе ДП.
В то же время, располагая эффективными эвристическими алгоритмами, мы можем задействовать
схему на основе ДП для целей локального улучшения ДР; данное улучшение достигается
посредством  вставок. Следует, однако, иметь в виду условия предшествования и то,
что (см. (\ref{4.2.1})) функции стоимости, определяющие критерий задачи (\ref{4.2.5}),
допускают зависимость от списка заданий, не выполненных на момент перемещения.
Последние два обстоятельства требуют учета при соответствующем построении вставок
(в полной мере это и было сделано в \cite{Cha13`, 15`}). В настоящем разделе мы рассмотрим
вопрос об <<однократном>> построении соответствующей (беллмановской) вставки, опуская,
как правило, соответствующие доказательства, которые приведены в \cite{Cha13`, 15`}.
При этом нам потребуются новые обозначения (символику, используемую в разделах~4.2 и 4.3,
будем применять при построении вставки).

Мы продолжаем рассматривать в своих общих построениях непустое множество $X$
произвольной природы (впрочем, в конкретных построениях, связанных с задачей
управления инструментом при листовой резке на станках с ЧПУ,
в качестве $X$ естественно использовать прямоугольник на плоскости).

Фиксируем (в качестве базы процесса) точку $\mathbf{x}_o\in X$ и число
$\mathbf{n}\in \bbn, \mathbf{n}\geqslant 2,$
определяющее количество мегаполисов. По самому смыслу
предлагаемой ниже конструкции логично полагать $\mathbf{n}$ достаточно
большим; во всяком случае естественно ориентироваться на такой случай.
Фиксируем $\mathbf{n}$ непустых конечных множеств  $\mathbf{L}_1,\cdots,\mathbf{L}_\mathbf{n}:$
\bfn\label{4.4.1}\mathbf{L}_1\in \mathrm{Fin}(X),\cdots,\mathbf{L}_\mathbf{n}\in \mathrm{Fin}(X),
\efn
множества (\ref{4.4.1}) именуем далее мегаполисами, а, точнее,
мегаполисами <<большой>> задачи. Кроме того, фиксируем отношения
\bfn\label{4.4.2}\bbl_1\in \cp^\prime(\mathbf{L}_1 \times \mathbf{L}_1).\cdots,
\bbl_\mathbf{n}\in \cp^\prime(\mathbf{L}_\mathbf{n}\times \mathbf{L}_\mathbf{n}).
\efn
Если $j\in \ov{1,\mathbf{n}},$ то отношение $\bbl_j,$
$$ \bbl_j\subset \mathbf{L}_j \times \mathbf{L}_j,
$$
характеризует возможности исполнителя в части выполнения работ, связанных с
посещением $\mathbf{L}_j$ (в случае листовой резки $\bbl_j$ является множеством
всех упорядоченных пар, у каждой из которых первый элемент является точкой врезки,
а второй --- точкой выключения инструмента). По аналогии с (\ref{3.3.4}) полагаем, что
\bfn\label{4.4.3}
(\mathbf{x}_o\notin \mathbf{L}_j\ \fa j\in \ov{1,\mathbf{n}})\,\&\,(\mathbf{L}_p
\cap \mathbf{L}_q = \emp\ \ \fa p\in \ov{1,\mathbf{n}}\ \ \fa q\in \ov{1,\mathbf{n}}\sm \{p\}).
\efn

 Мы занимаемся далее организацией перемещений следующего вида:
\bfn\label{4.4.4}\mathbf{x}_o\longrightarrow (z_1\in \bbl_{\beta(1)}) \longrightarrow\ldots
\longrightarrow (z_\mathbf{n}\in \bbl_{\beta(\mathbf{n})});
\efn
здесь $\beta\in \mathbf{P},$ где (здесь и ниже) $\mathbf{P}\df (\mathrm{bi})[\ov{1,\mathbf{n}}].$
Выбор  $\beta,z_1,\ldots,z_\mathbf{n}$
находится в нашем распоряжении;    правда, на выбор $\beta$ могут накладываться
условия предшествования, подобные рассматриваемым в предыдущей главе. Итак,
$\mathbf{P}$ --- множество всех полных маршрутов исходной <<большой>> задачи.

Введем в рассмотрение множество $\mathfrak{K}\in \cp(\ov{1,\mathbf{n}}\times
\ov{1,\mathbf{n}}),$ элементами которого являются упорядоченные пары индексов, выбираемых из
$\ov{1,\mathbf{n}}$ (случай $\mathfrak{K}= \emp$ из рассмотрения не исключается и отвечает случаю
отсутствия условий предшествования).
Как и в предыдущей главе, именуем элементы $\mathfrak{K}$ адресными парами; при
$z\in \mathfrak{K}$ индекс $\mathrm{pr}_1(z)\in \ov{1,\mathbf{n}}$  играет роль отправителя
(сообщения, груза т. д.),  а индекс $\mathrm{pr}_2(z)\in \ov{1,\mathbf{n}}$ ---
роль соответствующего получателя. Разумеется, в задаче,
связанной с листовой резкой на машинах с ЧПУ, содержательный смысл
$\mathrm{pr}_1(z)$ и $\mathrm{pr}_2(z)$ будет иным, но мы иногда будем все же
использовать вышеупомянутую общую
интерпретацию, поскольку это позволяет в ряде случаев
сокращать рассуждения, сохраняя требуемый смысл. Мы постулируем, что
\bfn\label{4.4.5}
\fa  \mathfrak{K}_o
\in \cp^\prime(\mathfrak{K})\ \exists\,z_o\in \mathfrak{K}_o:\,\mathrm{pr}_1(z_o)
\neq \mathrm{pr}_2(z)\ \ \fa z\in \mathfrak{K}_o
\efn
((\ref{4.4.5}) --- аналог (\ref{3.3.21}) --- условие, исключающее
зацикливание маршрутов). Тогда (при условии (\ref{4.4.5})) имеем в виде
\bfn\label{4.4.6}\ca \df \{\al\in \mathbf{P}|\,\al^{-1}\bigl(\mathrm{pr}_1(z)\bigl) <
\al^{-1}\bigl(\mathrm{pr}_2(z)\bigl) \ \ \fa z\in \mathfrak{K}\}\in \cp^\prime(\mathbf{P})
\efn
множество всех $\mathfrak{K}$-допустимых (по предшествованию) маршрутов
формулируемой ниже <<большой>> задачи. В дальнейшем предполагаем, что в (\ref{4.4.4})
допустимо использовать только маршруты из $\ca$ (\ref{4.4.6}).

Мы <<сокращаем>> $X$  до естественного и достаточного для всех наших целей
конечного п/м, полагая
\bfn\label{4.4.7}
\mathfrak{X}\df \{\mathbf{x}_o\} \cup \Bigl(\bigcup\limits_{i=1}^\mathbf{n}
\mathbf{L}_i\Bigl) \in \mathrm{Fin}(X);
\efn
легко видеть, что $\mathbf{x}_o$ и элементы упорядоченных пар $z_1,
\ldots,z_\mathbf{n}$ в (\ref{4.4.4}) --- суть точки $\mathfrak{X}$ (\ref{4.4.7}).
Иными словами, (\ref{4.4.7}) можно рассматривать как фазовое
пространство процессов типа (\ref{4.4.4}), которые пока были введены нестрого.
Сейчас мы уточним соответствующие понятия.

Полагаем в дальнейшем, что $\widetilde{\mathfrak{Z}}$ есть def множество
всех кортежей
$$
(z_i)_{i\in\ov{0,\mathbf{n}}}:\,\ov{0,\mathbf{n}} \longrightarrow \mathfrak{X}\times \mathfrak{X}.
$$
Среди таких кортежей выделяем трассы (траектории),
согласованные с тем или иным маршрутом. Итак, если $\beta\in \mathbf{P},$ то полагаем, что
\bfn\label{4.4.8}
\mathfrak{Z}_\beta \df \{(z_i)_{i\in\ov{0,\mathbf{n}}}\in
\widetilde{\mathfrak{Z}}\bigl|\,\bigl(z_o = (\mathbf{x}_o,\mathbf{x}_o)\bigl)
\&\,(z_t\in \bbl_{\beta(t)}\ \ \fa t \in \ov{1,\mathbf{n}})\}\in \mathrm{Fin}
(\widetilde{\mathfrak{Z}}),
\efn
получая множество всех трасс, согласованных  с маршрутом $\beta;$ разумеется,
имеются в виду маршруты и трассы <<большой>> задачи. Каждую упорядоченную пару
$$
\bigl(\beta,(z_i)_{i\in\ov{0,\mathbf{n}}}\bigl),\beta\in \ca,
(z_i)_{i\in\ov{0,\mathbf{n}}}\in \mathfrak{Z}_\beta,
$$
рассматриваем как ДР <<большой>> задачи. Тогда
\bfn\label{4.4.9}\mathrm{SOL}\df \{(\beta,\mathbf{z})\in \ca \times
\widetilde{\mathfrak{Z}}|\,\mathbf{z}\in \mathfrak{Z}_\beta\}\in
\mathrm{Fin}(\ca \times \widetilde{\mathfrak{Z}})
\efn
есть (непустое конечное) множество всех ДР
<<большой>> задачи. Как и в $\S$~4.2, для формулировки последней потребуется
ввести соответствующие функции стоимости, роль которых вполне аналогична
функциям  (\ref{4.2.1}). Итак, полагаем далее, что
$$
\mathbf{N}\df \cp^\prime(\ov{1,\mathbf{n}})
$$
(семейство всех непустых
(и неупорядоченных) списков заданий), после чего введем
\bfn\label{4.4.10}
\mathbf{c}^\natural\in \car_+[\mathfrak{X}\times \mathfrak{X}\times \mathbf{N}],
c_1^\natural\in \car_+[\mathfrak{X}\times \mathfrak{X}\times \mathbf{N}],\ldots,c_\mathbf{n}
^\natural\in \car_+[\mathfrak{X}\times \mathfrak{X}\times \mathbf{N}],
f^\natural\in \car_+[\mathfrak{X}];
\efn
как и в (\ref{4.2.1}), мы полагаем функции стоимости <<максимально>> продолженными.
Отметим только, что значения $\mathbf{c}^\natural$ будут использоваться для оценивания
внешних перемещений;  итак, $\mathbf{c}^\natural$ играет ту же роль, что и $\mathbf{c}$
в $\S$~4.2. Аналогичным образом, при $j\in \ov{1,\mathbf{n}}$ значения $c_j^\natural$
будут использоваться при оценивании работ,
связанных с посещением мегаполиса $\mathbf{L}_j.$ Наконец, значения $f^\natural$
используются для оценивания терминального состояния (точка $\mathrm{pr}_2(z_\mathbf{n})$
в (\ref{4.4.4})). В связи с существенностью тех или иных значений функций (\ref{4.4.10})
можно практически полностью повторить рассуждения в связи с (\ref{4.2.1}) при
очевидных изменениях  обозначений.

\begin{zam}\label{z4.4.1} Поясним, каким именно образом функции $(\ref{4.4.10})$
будут участвовать в формировании аддитивного критерия. Пусть $\beta\in \mathbf{P},\,
(z_i)_{i\in\ov{0,\mathbf{n}}} \in \mathfrak{Z}_\beta$ и $t\in \ov{1,\mathbf{n}}.$ Тогда перемещение
$$
\mathrm{pr}_2(z_{t-1}) \longrightarrow \mathrm{pr}_1(z_t),
$$
где $\mathrm{pr}_2(z_{t-1}) = \mathbf{x}_o$ при $t=1$ и
$\mathrm{pr}_2(z_{t-1})\in \mathbf{L}_{\beta(t-1)}$
в случае $t> 1,$ оценивается следующим значением потерь (затрат)
$$
\mathbf{c}^\natural\bigl(\mathrm{pr}_2(z_{t-1}),\mathrm{pr}_1(z_t),
\{\beta(l):\,l\in \ov{t,\mathbf{n}} \}\bigl)\in [0,\infty[.
$$
Соответственно, проведение работ, связанных  с посещением мегаполиса $\mathbf{L}_{\beta(t)},$
оценивается значением потерь
$$
c_{\beta(t)}^\natural\bigl(z_t,\{\beta(l):\,l\in \ov{t,\mathbf{n}}\}\bigl)\in [0,\infty[.
$$
Наконец, при $t = \mathbf{n}$ определено значение $f^\natural\bigl(\mathrm{pr}_2(z_t)\bigl)\in
[0,\infty[,$ характеризующее  терминальное состояние с точки
зрения качества последнего. \hfill $\Box$
\end{zam}

С учетом замечания~4.4.1 естественным представляется следующее определение критерия:
если $\beta\in \mathbf{P}$ и $(z_i)_{i\in\ov{0,\mathbf{n}}}\in \mathfrak{Z}_\beta,$
то полагаем
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\beta[(z_i)_{i\in\ov{0,\mathbf{n}}}]\df
\sum\limits_{t=1}^\mathbf{n}
\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(z_{t-1}),\mathrm{pr}_1(z_t),\{\beta(l):\,l\in
\ov{t,\mathbf{n}}\}\bigl) +
&\nonumber\\
&+ c_{\beta(t)}^\natural\bigl(z_t, \{\beta(l):\,l\in
\ov{t,\mathbf{n}}\}\bigl)\bigl] + f^\natural\bigl(\mathrm{pr}_2(z_\mathbf{n})\bigl),
&\label{4.4.11}
\end{eqnarray}
получая неотрицательную величину. Разумеется, (\ref{4.4.11}) нас будет интересовать в случае
\bfn\label{4.4.11`}\bigl(\beta,(z_i)_{i\in\ov{0,\mathbf{n}}}\bigl)\in \mathrm{SOL},
\efn
то есть в ситуации, когда оценивается ДР <<большой>> задачи. Последняя с учетом
(\ref{4.4.11}) имеет следующий вид:
\bfn\label{4.4.12}
\widehat{\mathfrak{C}}_\beta [(z_i)_{i\in \ov{0,\mathbf{n}}}] \longrightarrow
\min,\ \beta \in \mathcal{A},\ (z_i)_{i\in \ov{0,\mathbf{n}}}\in \mathfrak{Z}_\beta.
\efn
Мы полагаем, однако, что по соображениям сложности вычислений (число $\mathbf{n}$
достаточно велико) решить задачу (\ref{4.4.12}) точно не удается: мы не можем указать
явно оптимальное (в смысле (\ref{4.4.12})) ДР, хотя структура его нам известна
(имеется в виду представление в терминах соответствующего варианта ДП; см. раздел~4.3).
Однако с использованием эвристических алгоритмов мы можем за приемлемое время определить
некоторое ДР (\ref{4.4.11`}) нашей <<большой>> задачи (\ref{4.4.12}). Будем в настоящем
разделе полагать некоторое такое ДР уже найденным; рассмотрим вариант его улучшения на
основе оптимизирующей вставки.

Итак, пусть $\bigl(\la, (\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}\bigl)\in \mathrm{SOL};$ тогда
\bfn\label{4.4.13}\la\in \ca
\efn
$(\la$ --- допустимый по предшествованию маршрут в <<большой>> задаче) и
\bfn\label{4.4.14}(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}\in \mathfrak{Z}_\la
\efn
$((\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}$ --- трасса, согласованная с маршрутом
$\la$ (\ref{4.4.13})). Отметим, что из (\ref{4.4.13}) следует, в частности, свойство
$$
\la \in \mathbf{P},
$$
означающее, что $\la:\,\ov{1,\mathbf{n}}{\stackrel{\mbox{\footnotesize{на}}}{\longrightarrow}}\,
\ov{1,\mathbf{n}}$ и при этом $\fa i_1\in \ov{1,\mathbf{n}}\ \ \fa i_2\in \ov{1,\mathbf{n}}$
$$
\bigl(\la(i_1) = \la(i_2)\bigl) \Longrightarrow (i_1 = i_2).
$$
Кроме того, из (\ref{4.4.13}) имеем (см. (\ref{4.4.6})), что
\bfn\label{4.4.15}
\la^{-1}\bigl(\mathrm{pr}_1(z)\bigl) < \la^{-1}\bigl(\mathrm{pr}_2(z)\bigl)\ \
\fa z\in \mathfrak{K}.
\efn
Здесь $\la^{-1}\in \mathbf{P}$ есть перестановка, обратная к $\la;$ в частности,
$$
\la^{-1}:\ \ov{1,\mathbf{n}} {\stackrel{\mbox{\footnotesize{на}}}{\longrightarrow}}\,
\ov{1,\mathbf{n}}
$$
и при этом $\fa k\in\ov{1,\mathbf{n}}$
\bfn\label{4.4.16} \la\bigl(\la^{-1}(k)\bigl) = \la^{-1}\bigl(\la(k)\bigl) = k
\efn
(свойство (\ref{4.4.16}) легко извлекается из (\ref{3.1.4})). Свойство (\ref{4.4.15})
характеризует соблюдение условий предшествования.

В отношении кортежа (\ref{4.4.14}) заметим, что
$$
\mathbf{h}_o\in \mathfrak{X}\times \mathfrak{X}, \mathbf{h}_1\in \mathfrak{X}\times
\mathfrak{X}, \ldots,\mathbf{h}_\mathbf{n}\in \mathfrak{X}\times \mathfrak{X}
$$
(в виде (\ref{4.4.14}) имеем кортеж упорядоченных пар). При этом (см. (\ref{4.4.8}))
\bfn\label{4.4.17} \mathbf{h}_o = (\mathbf{x}_o,\mathbf{x}_o)
\efn
и, кроме того, справедливо свойство
\bfn\label{4.4.18}\mathbf{h}_t \in \bbl_{\la(t)}\ \ \fa t\in \ov{1,\mathbf{n}}.
\efn
Свойства (\ref{4.4.17}), (\ref{4.4.18}) характеризуют (\ref{4.4.14}) в терминах (\ref{4.4.8})
исчерпывающим образом. При этом согласно (\ref{4.4.11}), (\ref{4.4.13}) и (\ref{4.4.14})
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in \ov{o,\mathbf{n}}}] =
\sum\limits_{t=1}^\mathbf{n} \bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\{\la(l):\,l\in\ov{t,\mathbf{n}}\}\bigl) +
&\nonumber\\
&+c_{\la(t)}^\natural\bigl(\mathbf{h}_t, \{\la(l):\,l\in\ov{t,\mathbf{n}}\}\bigl)\bigl] + f^\natural
\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl);
&\label{4.4.19}
\end{eqnarray}
разумеется, (\ref{4.4.19}) определяет стоимость ДР
$\bigl(\la,(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}\bigl)$ <<большой>> задачи  (\ref{4.4.12}).

В связи с (\ref{4.4.19}) условимся о следующем соглашении: если $X$ и $Y$ --- непустые множества,
$$g: X \longrightarrow Y$$
и $A\in \cp(X),$ то через $g^1(A)$ обозначаем образ множества $A$ при действии отображения $g:$
$$ g^1(A) \df \{g(a):\,a\in A\}\in \cp(Y);
$$
если $A \neq \emp,$ то и $g^1(A) \neq \emp.$ Среди прочих свойств операции
\bfn\label{4.4.20}A \longmapsto g^1(A):\,\cp(X) \longrightarrow\cp(Y)
\efn
(взятия образа) отметим следующее
\bfn\label{4.4.21}g^1(A_1 \cup A_2) = g^1(A_1) \cup g^1(A_2)\ \ \fa A_1\in \cp(X)\ \ \fa A_2\in \cp(X)
\efn
(полезно также напомнить, что
$$g^1(B_1 \cap B_2) \subset g^1(B_1) \cap g^1(B_2),
$$
где $B_1\in \cp(X)$  и $B_2\in \cp(X),$ причем возможен случай, когда
$$g^1(B_1 \cap B_2) \neq g^1(B_1) \cap g^1(B_2);
$$
в этой части операция (\ref{4.4.20}) отличается от операции взятия прообраза). Поскольку $\mathbf{P}$
содержится в множестве всех отображений, действующих в $\ov{1,\mathbf{n}},$ то (\ref{4.4.20}) можно
использовать при $g=\lambda\in \mathbf{P},\ X= Y = \ov{1,\mathbf{n}},$ а потому из
(\ref{4.4.19}) имеем, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in \ov{o,\mathbf{n}}}] =
\sum\limits_{t=1}^\mathbf{n} \bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
&\nonumber\\
&+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t, \la^1(\ov{t,\mathbf{n}})\bigl)\bigl] + f^\natural
\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl).
&\label{4.4.22}
\end{eqnarray}
В дальнейшем выражения типа (\ref{4.4.22}) будут, в частности, использоваться в связи со свойством
(\ref{4.4.21}).

Приступим к изложению конструкции оптимизирующей вставки, для чего вначале обсудим одну схему
\cite{Cha12`,Cha13`,Cha14`}, связанную с преобразованием условий предшествования. Фиксируем
\bfn\label{4.4.23}
N \in\ov{2,\mathbf{n}};
\efn
число $N$ определяет <<размер окна>> вставки; пусть, кроме того,
\bfn\label{4.4.24}
\nu\in \ov{0,\mathbf{n}-N}
\efn
есть <<момент>> начала вставки. Тогда
$$
\La \df \bigl(\la(\nu + s)\bigl)_{s\in\ov{1,N}}
$$
есть отображение из $\ov{1,N}$ в $\ov{1,\mathbf{n}},$ то есть
$$\La:\,\ov{1,N} \longrightarrow \ov{1,\mathbf{n}}.
$$
Полагая $\Gamma \df \La^1(\ov{1,N}),$ получаем непустое п/м $\ov{1,\mathbf{n}},$ то есть
$$
\Gamma\in \cp^\prime(\ov{1,\mathbf{n}}),
$$
для которого определена мощность $|\Gamma|\in \bbn$ (действительно, $\Gamma$ --- непустое конечное
множество). Более того, из определения $\Gamma$ следует, что
$$
|\Gamma| = N
$$
и, кроме того, $\La\in (\mathrm{bi})[\Gamma].$ Итак,
$$
\Gamma = \{\La(s):\,s\in\ov{1,N}\} = \{\la(\nu+ s):\,s\in \ov{1,N}\} = \la^1(\ov{\nu+1,\nu+N})
$$
играет далее роль <<окна>> в маршруте  $\la.$
В этой связи полагаем, что
\bfn\label{4.4.25}Q \df \{z\in \mathfrak{K}|\,\bigl(\mathrm{pr}_1(z)\in \Gamma\bigl)\,\&\,
\bigl(\mathrm{pr}_2(z)\in \Gamma\bigl)\},
\efn
получая соответствующее <<окно>> в множестве адресных пар.

Теперь мы конструируем нужный вариант множества $\mathbf{K}$ раздела~3.3.
Учитываем при этом тот очевидный факт, что при $z\in Q$ в виде $\mathrm{pr}_1(z)$
и $\mathrm{pr}_2(z)$ имеем  элементы $\Gamma,$ а потому для биекции $\La^{-1},$
обратной к $\La,$ получаем, что
$$
\Bigl(\La^{-1}\bigl(\mathrm{pr}_1(z)\bigl)\in \ov{1,N}\Bigl)\,\&\,
\Bigl(\La^{-1}\bigl(\mathrm{pr}_2(z)\bigl)\in \ov{1,N}\Bigl).
$$
С учетом этого полагаем далее, что
\bfn\label{4.4.26}
\mathbf{K}\df \Bigl\{\Bigl(\La^{-1}\bigl(\mathrm{pr}_1(z)\bigl),\La^{-1}
\bigl(\mathrm{pr}_2(z)\bigl)\Bigl):\,z\in Q\Bigl\},
\efn
получая множество, для которого
$$
\mathbf{K}\subset \ov{1,N} \times \ov{1,N},
$$
что соответствует разделу~3.3. Отметим, что для множества $\mathbf{K}$
(\ref{4.4.26}) выполняется условие (\ref{3.3.21}).

\begin{zam}\label{z4.4.1`}. Проверим условие $(\ref{3.3.21})$, фиксируя
$\mathbf{K}_o\in \cp^\prime(\mathbf{K}).$ Тогда $\mathbf{K}_o\neq \emp$ и
$\mathbf{K}_o\subset \mathbf{K}.$ При этом
\bfn\label{4.4.27}
Q_o \df \Bigl\{z\in Q \bigl|\,\Bigl(\La^{-1}\bigl(\mathrm{pr}_1(z)\bigl),
\La^{-1}\bigl(\mathrm{pr}_2(z)\bigl)\Bigl)\in \mathbf{K}_o\Bigl\}\in \cp^\prime(Q);
\efn
из $(\ref{4.4.25})$ и $(\ref{4.4.27})$ получаем, в частности, что $Q_o\in
\cp^\prime(\mathfrak{K});$ при этом $\fa z\in Q_o$
$$
\bigl(\mathrm{pr}_1(z) \in \Gamma\bigl)\,\&\,\bigl(\mathrm{pr}_2(z) \in \Gamma\bigl).
$$
С учетом $(\ref{4.4.5})$ можно указать $z_o\in Q_o$ со свойством
\bfn\label{4.4.28}\mathrm{pr}_1(z_o)\neq \mathrm{pr}_2(z)\ \ \fa z\in Q_o.
\efn
Тогда $z_o\in Q$ и при этом $\tilde{z}_o \df \Bigl(\La^{-1}\bigl(\mathrm{pr}_1(z_o)
\bigl),\La^{-1}\bigl(\mathrm{pr}_2(z_o)\bigl)\Bigl)\in \mathbf{K}_o$ согласно
$(\ref{4.4.27}).$ Выберем произвольно $z^o\in \mathbf{K}_o.$ Тогда, в
частности, $z^o\in \mathbf{K},$ а потому для некоторого $\tilde{z}^o\in Q$
$$
z^o = \Bigl(\La^{-1}\bigl(\mathrm{pr}_1(\tilde{z}^o)\bigl), \La^{-1}\bigl(\mathrm{pr}_2(\tilde{z}^o)
\bigl)\Bigl).
$$
Тогда $\Bigl(\La^{-1}\bigl(\mathrm{pr}_1(\tilde{z}^o)\bigl),\La^{-1}
\bigl(\mathrm{pr}_2(\tilde{z}^o)\bigl)
\Bigl)\in \mathbf{K}_o$ и, с учетом $(\ref{4.4.27}),$ $\tilde{z}^o\in Q_o,$ а потому согласно
$(\ref{4.4.28})$
$$
\mathrm{pr}_1(z_o) \neq \mathrm{pr}_2(\tilde{z}^o).
$$
В силу биективности $\La^{-1}$ получаем как следствие, что
$$
\mathrm{pr}_1(\tilde{z}_o) = \La^{-1}\bigl(\mathrm{pr}_1(z_o)\bigl)
\neq \La^{-1}\bigl(\mathrm{pr}_2(\tilde{z}^o)\bigl)= \mathrm{pr}_2(z^o).
$$
Поскольку выбор $z^o$ был произвольным, установлено, что $\tilde{z}_o\in \mathbf{K}_o$ таково, что
$\mathrm{pr}_1(\tilde{z}_o)  \neq \mathrm{pr}_2(z)\ \ \fa z\in \mathbf{K}_o.$ \hfill $\Box$
\end{zam}

Теперь (см. (\ref{3.3.24}), (\ref{3.3.25})) имеем, что
\begin{eqnarray}
&\mathbf{A}\df \{\al\in \bbp|\,\al^{-1}\bigl(\mathrm{pr}_1(z)\bigl) <
\al^{-1}\bigl(\mathrm{pr}_2(z)\bigl)\ \ \fa z\in \mathbf{K}\} =
&\nonumber\\
&=\{\al\in \bbp|\,
\fa z\in \mathbf{K}\ \ \fa t_1\in \ov{1,N}
\fa t_2\in \ov{1,N}\ \
&\nonumber\\
&\Bigl(\bigl(\al(t_1) =
\mathrm{pr}_1(z)\bigl)\,\&\,\bigl(\al(t_2) = \mathrm{pr}_2(z)\bigl)\Bigl) \Longrightarrow
(t_1 < t_2)\}\in \cp^\prime(\bbp) \hspace{1.0cm}
&\label{4.4.29}
\end{eqnarray}
(итак, $\mathbf{A}$ --- непустое п/м $\bbp).$ Легко видеть, что при $\al\in \bbp$
\bfn\label{4.4.30}
\La\circ \al = \Bigl(\la\bigl(\nu + \al(s)\bigl)\Bigl)_{s\in\ov{1,N}}\in (\mathrm{bi})[\Gamma]
\efn
и, в частности,
$$
\La \circ \al:\ov{1,N}{\stackrel{\mbox{\footnotesize{на}}}{\longrightarrow}} \Gamma;
$$
при этом $(\La\circ \al)(s)  = \La\bigl(\al(s)\bigl) = \la\bigl(\nu + \al(s)\bigl)
\ \ \fa s\in \ov{1,N}.$ Вместе с тем
$$
t-\nu\in \ov{1,N}\ \ \fa t\in \ov{\nu+1,\nu+ N}.
$$
Поэтому при $\tau\in \ov{\nu+1,\nu+ N}$ определен индекс
$$
(\La\circ \al)(\tau - \nu) = \la\bigl(\nu + \al(\tau - \nu)\bigl)\in \Gamma.
$$

С учетом этого введем естественное правило преобразования маршрута $\la$ (см. \cite{Cha13`}).

\begin{opred}\label{o4.4.1} Если $\al\in \bbp,$ то отображение
$$
(\al - \mathrm{sew})[\la;\nu]:\,\ov{1,\mathbf{n}}\longrightarrow \ov{1,\mathbf{n}}
$$
определяем следующими правилами
\begin{eqnarray}
&\bigl((\al - \mathrm{sew})[\la;\nu](t) \df \la(t)\ \ \fa t\in \ov{1,\mathbf{n}}
\setminus  \ov{\nu+1,\nu + N}\bigl)\,\&\,\Bigl((\al - \mathrm{sew})[\la;\nu](t) \df
&\nonumber\\
&\df (\La\circ \al)(t - \nu)\ \ \fa t \in \ov{\nu +1,\nu +N}\bigl).
&\label{4.4.31}
\end{eqnarray}
\end{opred}

\begin{pred}\label{p4.4.1}
{\TL} Если $\al\in \bbp,$ то $(\al - \mathrm{sew})[\la;\nu]\in \mathbf{P}.$
\end{pred}

Д о к а з а т е л ь с т в о. Покажем сначала, что (при $\al\in \bbp)$
$\mu \df (\al - \mathrm{sew})[\la;\nu]$ есть сюръективное отображение.
Пусть $\theta \in \ov{1,\mathbf{n}}.$ Тогда по выбору $\la$ имеем,
что $\theta = \la(\tau),$ где $\tau\in \ov{1,\mathbf{n}}.$ При этом согласно (\ref{4.4.31})
$$(\tau \notin \ov{\nu + 1,\nu+ N}) \Longrightarrow \bigl(\mu(\tau) = \la(\tau)\bigl).
$$
Как следствие получили импликацию
\bfn\label{4.4.32}
(\tau \notin \ov{\nu + 1,\nu+ N}) \Longrightarrow \bigl(\exists\,t\in
\ov{1,\mathbf{n}}:\,\theta = \mu(t)\bigl).
\efn
Допустим, что $\tau \in \ov{\nu + 1,\nu+ N}.$ В этом случае
$$
\la^{-1}(\theta) \in \ov{\nu+1,\nu+ N},
$$
так как по выбору $\tau$ имеем равенство $\tau = \la^{-1}(\theta).$ Заметим,
что по определению $\La$
$$
\theta = \la(\tau) = \la\bigl(\nu +(\tau - \nu)\bigl) = \La(\tau-\nu) \in \Gamma,
$$
где $\tau-\nu\in \ov{1,N}.$ С учетом (\ref{4.4.30}) имеем теперь, что для
некоторого $j\in \ov{1,N}$
\bfn\label{4.4.33}
\theta = (\La \circ \al)(j) = \la\bigl(\nu + \al(j)\bigl),
\efn
где $\nu+\alpha(j)\in \ov{\nu+1,\nu+N}.$ Легко видеть, что
$$ j=(\La \circ \al)^{-1}(\theta),
$$
а потому из (\ref{4.4.31}) вытекает, что
$$\mu(\nu +j) = (\La\circ \al)(j) = \theta.
$$
Поскольку, в частности, $\nu+j \in \ov{1,\mathbf{n}},$ то установлено,
что и в рассматриваемом случае $\tau\in \ov{\nu+1,\nu+N}\ \ \exists\, t\in
\ov{1,\mathbf{n}}:\,\theta = \mu(t).$ Итак,
\bfn\label{4.4.34}
(\tau\in \ov{\nu+1,\nu+N})\Longrightarrow \bigl(\exists\, t\in
\ov{1,\mathbf{n}}:\,\theta = \mu(t)\bigl).
\efn
Из (\ref{4.4.32}) и (\ref{4.4.34}) получаем, что $\theta\in \mu^1(\ov{1,\mathbf{n}}).$
Коль скоро выбор $\theta$ был произвольным, установлено, что $\ov{1,\mathbf{n}}\subset
\mu^1(\ov{1,\mathbf{n}})$ и, как следствие, $\mu^1(\ov{1,\mathbf{n}}) = \ov{1,\mathbf{n}},$ то есть
$$
\mu:\,\ov{1,\mathbf{n}}{\stackrel{\mbox{\footnotesize{на}}}{\longrightarrow}}{\ov{1,\mathbf{n}}}.
$$
Осталось проверить инъективность $\mu.$ Пусть $p\in \ov{1,\mathbf{n}}$ и $q\in \ov{1,\mathbf{n}}$
таковы, что
\bfn\label{4.4.34`}
\mu(p) = \mu(q).
\efn
Для краткости полагаем $u\df\mu(p),$ получая, конечно, в силу (\ref{4.4.34`}), что и $\mu(q) = u.$
Заметим, что
\bfn\label{4.4.35}
(p\in \ov{\nu+1,\nu+N}) \vee (p\in \ov{1,\mathbf{n}}\setminus  \ov{\nu+1,\nu+ N}).
\efn
Оба случая в (\ref{4.4.35}) рассмотрим отдельно.

а) Пусть сначала $p\in \ov{\nu+1,\nu+N}.$ Тогда
$$
p-\nu \in \ov{1,N}
$$
и согласно (\ref{4.4.31}) $u = (\La\circ \al)(p- \nu)\in \Gamma.$ В этом случае
\bfn\label{4.4.35`}
q\in \ov{\nu+1,\nu+N},
\efn
поскольку в противном случае, то есть при
\bfn\label{4.4.36}
q \notin \ov{\nu+1,\nu+N},
\efn
имеет место (см. (\ref{4.4.31})) $u\notin \Gamma$ (действительно, пусть истинно (\ref{4.4.36});
тогда $u=\mu(q) = \la(q),$ где в силу инъективности $\la$
$$
\la(q) \notin \Gamma,
$$
то есть $u\notin \Gamma).$ Получаем при условии (\ref{4.4.36}) очевидное противоречие, доказывающее
(\ref{4.4.35`}).  Итак,
$$
(p\in\ov{\nu+1,\nu+N})\,\&\,(q\in \ov{\nu+1,\nu+N}),
$$
а тогда в силу (\ref{4.4.31}) и (\ref{4.4.34`})
$$
(\La\circ \al)(p-\nu) = (\La\circ \al)(q - \nu);
$$
с учетом (\ref{4.4.30}) получаем равенство
$$
p-\nu =q -\nu,
$$
то есть $p = q.$ Итак, установлена импликация
\bfn\label{4.4.37}
(p\in \ov{\nu+1,\nu+N}) \Longrightarrow (p= q).
\efn

b) Пусть теперь $p\notin \ov{\nu+1,\nu+N}.$ Тогда в силу (\ref{4.4.31}) $\mu(p) = \la(p) \notin \Gamma,$
то есть $u\notin \Gamma$ (учитываем инъективность $\la).$ Поэтому $\mu(q) \notin \Gamma,$ что означает
$$
q\notin \ov{\nu+1,\nu+N}
$$
(в самом деле, при $q\in \ov{\nu+1,\nu+N}$ имеем в силу (\ref{4.4.31}), что $\mu(q) = (\La \circ \al)
(q - \nu)\in \Gamma,$ а это исключено). Тогда $\mu(q) =\la(q),$  а потому (см. (\ref{4.4.34`}))
$$
\la(p) = \la(q)
$$
и, как следствие, $p=q$ и при $p\notin \ov{\nu+1,\nu+N}.$ Итак,
$$
(p\notin \ov{\nu+1,\nu+N}) \Longrightarrow (p = q).
$$
С учетом  (\ref{4.4.35}) и (\ref{4.4.37}) получаем теперь во всех возможных (при
условии (\ref{4.4.34`})) случаях требуемое равенство $p =q,$ чем и завершается проверка импликации
$$
\bigl(\mu(p) = \mu(q)\bigl) \Longrightarrow (p= q).
$$
Поскольку выбор $p$ и $q$ был произвольным, установлено, что $\fa i_1\in \ov{1,\mathbf{n}}\ \
\fa i_2\in \ov{1,\mathbf{n}}$
$$
\hspace{5.5cm} \bigl(\mu(i_1) = \mu(i_2)\bigl) \Longrightarrow (i_1 = i_2). \hspace{5.5cm}\Box
$$

\begin{pred}\label{p4.4.2}
{\TL} Если $\al\in \mathbf{A},$ то  $(\al - \mathrm{sew}))[\la;\nu]\in \ca.$
\end{pred}

Д о к а з а т е л ь с т в о.  Пусть $\al\in \mathbf{A}.$ Тогда, в частности, $\al\in \bbp,$ то
есть $\al$ --- перестановка множества $\ov{1,N}.$ В силу предложения~\ref{p4.4.1}  имеем, что
\bfn\label{4.4.38}\mu \df (\al - \mathrm{sew}))[\la;\nu]\in \mathbf{P}.
\efn
Кроме того, по определению множества $\mathbf{A}$ имеем, что (см. (\ref{4.4.29}))
\bfn\label{4.4.39}\al^{-1}\bigl(\mathrm{pr}_1(z)\bigl) <  \al^{-1}\bigl(\mathrm{pr}_2(z)\bigl)\ \
\fa z\in \mathbf{K}.
\efn
Покажем, что свойством, подобным (\ref{4.4.39}), обладает и маршрут $\mu.$ Для проверки данного
свойства выберем и зафиксируем адресную пару
\bfn\label{4.4.40} \theta\in \mathfrak{K}
\efn
<<большой>> задачи. Тогда,  в частности, $\theta\in \ov{1,\mathbf{n}}\times \ov{1,\mathbf{n}},$
а потому
\bfn\label{4.4.41}\bigl(\mathrm{pr}_1(\theta)\in\ov{1,\mathbf{n}}\bigl)\,\&\,
\bigl(\mathrm{pr}_2(\theta)\in\ov{1,\mathbf{n}}\bigl).
\efn
По выбору $\la$ имеем из (\ref{4.4.15}), (\ref{4.4.40}) и (\ref{4.4.41}), что
\bfn\label{4.4.42}\la^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) < \la^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)
\efn
($\mathrm{pr}_1(\theta)$ --- <<отправитель>>, а $\mathrm{pr}_2(\theta)$ --- <<получатель>>
адресной пары $\theta).$ При этом
\bfn\label{4.4.43}(\theta \in Q) \vee (\theta\in \mathfrak{K}\setminus Q).
\efn
Оба случая, упомянутых в (\ref{4.4.43}), рассмотрим отдельно, имея в виду (\ref{4.4.25}),
(\ref{4.4.26}).

1) Пусть $\theta\in Q.$ Поэтому согласно (\ref{4.4.25})
\bfn\label{4.4.43`}\bigl(\mathrm{pr}_1(\theta)\in \Gamma\bigl)\,\&\,\bigl(\mathrm{pr}_2(\theta)\in \Gamma\bigl)
\efn
и, как следствие, реализуется включение
$$\Bigl(\La^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl),\La^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl)\in \mathbf{K};
$$
см. (\ref{4.4.26}). Как следствие имеем из (\ref{4.4.39}), что
$$\al^{-1}\Bigl(\La^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) <
\al^{-1}\Bigl(\La^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl).
$$
Иными словами, справедливо неравенство
\bfn\label{4.4.44}(\La \circ \al)^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) <
(\La \circ \al)^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl).
\efn
Мы учли в (\ref{4.4.44}) очевидное свойство
$$(\La \circ \al)^{-1}(t) = \al^{-1}\bigl(\La^{-1}(t)\bigl) \ \ \fa t\in \Gamma;
$$
в этой связи полезно иметь в виду (\ref{4.4.30}). Отметим, что (см. (\ref{4.4.38}), (\ref{4.4.41}))
$$\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) \in \ov{1,\mathbf{n}}\Bigl)\,\&\,
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl) \in \ov{1,\mathbf{n}}\Bigl).
$$
При этом справедливы очевидные равенства
$$\biggl(\mu\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) = \mathrm{pr}_1 (\theta)\biggl)\,\&\,
\biggl(\mu\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl) = \mathrm{pr}_2(\theta)\biggl).
$$
Отметим здесь же, что по определению $\mu$ имеем из (\ref{4.4.31}) следующие импликации
$$\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\notin \ov{\nu+1,\nu+N}\Bigl) \Longrightarrow
\biggl(\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) = \mathrm{pr}_1(\theta)\biggl),
$$
$$\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\notin \ov{\nu+1,\nu+N}\Bigl) \Longrightarrow
\biggl(\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl) = \mathrm{pr}_2(\theta)\biggl).$$
 Тогда с учетом (\ref{4.4.43`}) получаем, как следствие, что
\bfn\label{4.4.45}\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\notin \ov{\nu+1,\nu+N}\Bigl)
\Longrightarrow
\biggl(\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) \in \Gamma\biggl),
\efn
\bfn\label{4.4.46}\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\notin \ov{\nu+1,\nu+N}\Bigl)
\Longrightarrow
\biggl(\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl) \in \Gamma\biggl),
\efn
Вместе с тем по определению $\Gamma$ имеем с учетом инъективности  $\la$, что                                                                                    $$\biggl(\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) \in \Gamma\biggl)\Longrightarrow
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\in \ov{\nu+1,\nu+N}\Bigl),
$$
$$\biggl(\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl) \in \Gamma\biggl)\Longrightarrow
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\in \ov{\nu+1,\nu+N}\Bigl).
$$
Комбинируя две последние импликации с (\ref{4.4.45}) и (\ref{4.4.46}), получаем, что
$$\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\in \ov{\nu+1,\nu+N}\Bigl)\,\&\,
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\in \ov{\nu+1,\nu+N}\Bigl).
$$
Последнее означает в силу (\ref{4.4.31}) и определения $\mu,$ что
$$\mathrm{pr}_1(\theta) = \mu\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) =
(\La\circ \al)\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) - \nu\Bigl),
$$
$$\mathrm{pr}_2(\theta) = \mu\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl) =
(\La\circ \al)\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl) - \nu\Bigl),
$$
Теперь учтем (\ref{4.4.44}). Тогда получаем, используя свойства обратной биекции, что
$$
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) - \nu  = (\La\circ \al)^{-1}\biggl((\La\circ\,\al)\Bigl(
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) - \nu\Bigl)\biggl)= (\La\circ\,\al)^{-1}\bigl(\mathrm{pr}_1
(\theta)\bigl) <
$$
$$< (\La\circ\, \al)^{-1}\bigl(\mathrm{pr}_2 (\theta)\bigl)
= (\La\circ\, \al)^{-1}\biggl((\La\circ\, \al)\Bigl(\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl) -
\nu\Bigl)\biggl)= \mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl) - \nu.
$$
В итоге $\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) < \mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)$
в рассматриваемом  сейчас случае 1). Итак,
\bfn\label{4.4.47}(\theta \in Q) \Longrightarrow \Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)<
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl).
\efn

2) Пусть теперь $\theta\in \mathfrak{K}\setminus Q.$ В силу (\ref{4.4.25}) имеем, что
\bfn\label{4.4.48}\bigl(\mathrm{pr}_1(\theta)\notin \Gamma\bigl) \vee
\bigl(\mathrm{pr}_2(\theta)\notin \Gamma\bigl).
\efn
С учетом определения $\Gamma$ имеем следующие две импликации
\bfn\label{4.4.49}
\bigl(\mathrm{pr}_1(\theta)\notin \Gamma\bigl)\Longrightarrow \bigl(\la(k) \neq
\mathrm{pr}_1(\theta)\ \ \fa  k\in \ov{\nu+1,\nu+ N}\bigl),
\efn
\bfn\label{4.4.50}
\bigl(\mathrm{pr}_2(\theta)\notin \Gamma\bigl)\Longrightarrow \bigl(\la(k) \neq
\mathrm{pr}_2(\theta)\ \ \fa  k\in \ov{\nu+1,\nu+ N}\bigl).
\efn
Рассмотрим отдельно случаи, упомянутые в (\ref{4.4.48}).

2.1) Пусть $\mathrm{pr}_1(\theta) \notin \Gamma.$ Тогда в силу (\ref{4.4.49})
$$\la(k) \neq \mathrm{pr}_1(\theta)\ \ \fa k\in \ov{\nu+1,\nu+ N}.
$$
Если же $s\in \ov{1,N},$ то $\al(s) \in \ov{1,N}$ и $\nu +\al(s) \in
\ov{\nu +1,\nu+N},$ а потому
$$
\la\bigl(\nu +\al(s)\bigl) \neq \mathrm{pr}_1(\theta)
$$
и, как следствие, $(\La\circ \al)(s) \neq \mathrm{pr}_1(\theta).$
Коль скоро выбор $s$ был
произвольным, установлено, что
$$
(\La \circ \al)(k) \neq \mathrm{pr}_1(\theta)\ \ \fa k\in \ov{1,N}.
$$
С учетом (\ref{4.4.31}) и определения $\mu$ получаем теперь, что
$$
\mu(j) \neq \mathrm{pr}_1(\theta)\ \ \fa j\in \ov{\nu+1,\nu+N}.
$$
Используя инъективность $\mu^{-1}$ получаем, стало быть, что
$$
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\notin \ov{\nu+1,\nu+N}.
$$
Последнее означает, конечно, что
\bfn\label{4.4.51}
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\in \ov{1,\nu}\Bigl)  \vee
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\in \ov{\nu +  N+1,\mathbf{n}}\Bigl).
\efn
Вновь используя (\ref{4.4.31}), получаем следующее положение:
$$
\la\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl) = \mu\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl)= \mathrm{pr}_1(\theta).
$$
Как следствие реализуется цепочка равенств
\bfn\label{4.4.51`}
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)= \la^{-1}\biggl(\la\Bigl(\mu^{-1}
\bigl(\mathrm{pr}_1(\theta)\bigl)\Bigl)\biggl) =
\la^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl),
\efn
откуда с учетом (\ref{4.4.42}) получаем неравенство
\bfn\label{4.4.52}\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) < \la^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl).
\efn
Пусть (в случае 2.1), то есть при $\mathrm{pr}_1(\theta) \notin \Gamma)$
$\mathrm{pr}_2(\theta) \notin \Gamma;$ тогда подобно обоснованию (\ref{4.4.51`}) проверяется, что
$$
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl) = \la^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl),
$$
а из (\ref{4.4.52}) вытекает неравенство $\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) <
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl).$ Итак (в рассматриваемом случае 2.1), то есть при
$\mathrm{pr}_1(\theta) \notin \Gamma),$ истинна импликация
\bfn\label{4.4.53}
\bigl(\mathrm{pr}_2(\theta) \notin \Gamma) \Longrightarrow
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) <
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl).
\efn
Допустим теперь, что (при условии $\mathrm{pr}_1(\theta) \notin \Gamma)$
$\mathrm{pr}_2(\theta) \in \Gamma.$ Тогда определен индекс $s_\theta \df
\La^{-1}\bigl(\mathrm{pr}_2(\theta) \bigl)\in \ov{1,N},$ а потому
$$
\La(s_\theta) = \la(\nu +s_\theta) = \mathrm{pr}_2(\theta)
$$
и, как следствие, $\nu + s_\theta = \la^{-1}\bigl(\la(\nu+ s_\theta)\bigl) =
\la^{-1}\bigl(\mathrm{pr}_2(\theta) \bigl).$ С учетом (\ref{4.4.52}) имеем, что
$$
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) < \nu + s_\theta \leqslant \nu+ N,
$$
а потому в силу (\ref{4.4.51})
\bfn\label{4.4.54}
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl)\in \ov{1,\nu}.
\efn
С другой стороны, с учетом (\ref{4.4.31}) и определения $\mu$ имеем, что
$$
\al^{-1}(s_\theta) = \al^{-1}\Bigl(\La^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl) =
(\La\circ \al)^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\in \ov{1,N}
$$
и, следовательно, имеем цепочку равенств
$$
\mu\bigl(\nu + \al^{-1}(s_\theta)\bigl) = (\La\circ \al)\bigl(\al^{-1}(s_\theta)\bigl) =
\mathrm{pr}_2(\theta),
$$
из которой вытекает, что
$$
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl) = \nu + \al^{-1}(s_\theta).
$$
В итоге $\nu +1 \leqslant \mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl),$ а тогда с
учетом (\ref{4.4.54}) $\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) <
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl),$ чем и завершается (в случае
$\mathrm{pr}_1(\theta)\notin \Gamma)$ проверка импликации
$$
\bigl(\mathrm{pr}_2(\theta)\in \Gamma\bigl) \Longrightarrow
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) <
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl).
$$
С учетом (\ref{4.4.53}) получаем в рассматриваемом сейчас случае  2.1) неравенство
\bfn\label{4.4.54`}
\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) < \mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl).
\efn
Итак, установлена следующая импликация:
\bfn\label{4.4.55}\bigl(\mathrm{pr}_1(\theta)\notin \Gamma\bigl) \Longrightarrow
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) < \mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl).
\efn
Проверка импликации
$$
\bigl(\mathrm{pr}_2(\theta)\notin \Gamma\bigl) \Longrightarrow
\Bigl(\mu^{-1}\bigl(\mathrm{pr}_1(\theta)\bigl) <
\mu^{-1}\bigl(\mathrm{pr}_2(\theta)\bigl)\Bigl)
$$
осуществляется по аналогичной схеме (см. \cite[предложение~7.2]{Cha14`}).
С учетом (\ref{4.4.48}) и (\ref{4.4.55}) получаем требуемое неравенство
(\ref{4.4.54`}) во всех возможных случаях, если только $\theta \in \mathfrak{K}\setminus Q.$
Учитывая (\ref{4.4.43}) и (\ref{4.4.47}), имеем окончательно (\ref{4.4.54`}). Коль скоро
выбор $\theta$ был произвольным, установлено, что (см. (\ref{4.4.40}))
$$
\mu^{-1}\bigl(\mathrm{pr}_1(z)\bigl) < \mu^{-1}\bigl(\mathrm{pr}_2(z)\bigl)\ \ \fa z\in \mathfrak{K}.
$$
С учетом (\ref{4.4.38}) и (\ref{4.4.6}) получаем, что $\mu\in \ca.$ \hfill $\Box$  \smallskip

Введем в рассмотрение тождественную перестановку $\mathbf{e}\in \bbp:\ \mathbf{e}(s)
\df s\ \ \fa s\in \ov{1,N}.$
\begin{pred}\label{p4.4.3}
{\TL} Маршрут $\mathbf{e}$ допустим в смысле условий предшествования оптимизирующей
вставки: $\mathbf{e}\in \mathbf{A}.$
\end{pred}

Д о к а з а т е л ь с т в о. Выберем произвольно $\zeta \in \mathbf{K},$
получая в силу (\ref{4.4.26})  представление
$$\zeta = \Bigl(\La^{-1}\bigl(\mathrm{pr}_1(q)\bigl), \La^{-1}\bigl(\mathrm{pr}_2(q)\bigl)\Bigl)
$$
для некоторого $q\in Q.$ Ясно, что
\bfn\label{4.4.56}\Bigl(\mathrm{pr}_1(\zeta) = \La^{-1}\bigl(\mathrm{pr}_1(q)\bigl)\Bigl)\,\&\,
\Bigl(\mathrm{pr}_2(\zeta) = \La^{-1}\bigl(\mathrm{pr}_2(q)\bigl)\Bigl).
\efn
При этом $q\in \mathfrak{K}$ обладает свойствами
$$\bigl(\mathrm{pr}_1(q) \in \Gamma\bigl) \,\&\,\bigl(\mathrm{pr}_2(q) \in \Gamma\bigl).
$$
С учетом  $\mathfrak{K}$-допустимости маршрута $\la$ (см. (\ref{4.4.15})) имеем, что
\bfn\label{4.4.57}\la^{-1}\bigl(\mathrm{pr}_1(q)\bigl) < \la^{-1}\bigl(\mathrm{pr}_2(q)\bigl).
\efn
Из (\ref{4.4.56}) получаем очевидные равенства
$$\Bigl(\La\bigl(\mathrm{pr}_1(\zeta)\bigl) = \mathrm{pr}_1(q)\Bigl)\,\&\,
\Bigl(\La\bigl(\mathrm{pr}_2(\zeta)\bigl) = \mathrm{pr}_2(q)\Bigl).
$$
Иными словами,
$$\Bigl(\la\bigl(\nu + \mathrm{pr}_1(\zeta)\bigl) = \mathrm{pr}_1(q)\Bigl)\,\&\,
\Bigl(\la\bigl(\nu + \mathrm{pr}_2(\zeta)\bigl) = \mathrm{pr}_2(q)\Bigl),
$$
а потому получаем, что
$$\Bigl(\la^{-1}\bigl(\mathrm{pr}_1(q)\bigl) = \nu +\mathrm{pr}_1(\zeta)\Bigl)\,\&\,
\Bigl(\la^{-1}\bigl(\mathrm{pr}_2(q)\bigl) = \nu +\mathrm{pr}_2(\zeta)\Bigl).
$$
С учетом  (\ref{4.4.57}) имеем неравенство
$$\nu +\mathrm{pr}_1(\zeta) < \nu +\mathrm{pr}_2(\zeta),
$$
а тогда $\mathrm{pr}_1(\zeta) < \mathrm{pr}_2(\zeta),$ то есть $\mathbf{e}\bigl(\mathrm{pr}_1(\zeta)
\bigl) < \mathbf{e}\bigl(\mathrm{pr}_2(\zeta)\bigl).$ Поскольку выбор $\zeta$ был
произвольным, установлено, что $\mathbf{e}\in \mathbf{A}.$ \hfill $\Box$
\begin{pred}\label{p4.4.4}{\TL} Справедливо равенство $(\mathbf{e}- \mathrm{sew})[\la;\nu] = \la.$
\end{pred}

Д о к а з а т е л ь с т в о. Полагаем для краткости, что
$$\mu \df (\mathbf{e}- \mathrm{sew})[\la;\nu].
$$
Тогда из двух последних предложений следует, что $\mu \in \ca,$ причем
$$\mu(t) = (\La \circ \mathbf{e})(t -\nu) = \la\Bigl(\nu + \bigl(\mathbf{e}(t) - \nu\bigl)\Bigl) =
\la\bigl(\nu + (t-\nu)\bigl) = \la(t)\ \ \fa t\in \ov{\nu+1,\nu+N}.
$$
С учетом определения $\mu$ получаем теперь, что $\mu(t) = \la(t)\ \ \fa t\in \ov{1,\mathbf{n}}.$
Иными словами, $\mu = \la.$ \hfill $\Box$ \smallskip

{\bf Построение локальной задачи.} Полагаем до конца настоящего раздела, что
\bfn\label{4.4.58}x^o \df \mathrm{pr}_2(\mathbf{h}_\nu),
\efn
получая, конечно, включение $x^o\in \mathfrak{X}.$ Обозначение (\ref{4.4.58}) сохраняем и в
следующем разделе. Кроме  того, пусть в данном и последующих разделах главы $\fa s\in \ov{1,N}$
\bfn\label{4.4.59}(M_s \df \mathbf{L}_{\La(s)})\,\&\,(\bbm_s \df \bbl_{\La(s)}).
\efn
Ясно, что $\bbm_t\in \cp^\prime(M_t \times M_t)\ \ \fa t\in \ov{1,N}.$ Итак,
$$\bbm_1\subset M_1 \times M_1,\ldots,\bbm_N\subset M_N \times M_N.
$$
Напомним здесь же, что (см. (\ref{3.3.3}))
$$\mathbf{M}_1 = \{\mathrm{pr}_2(z):\,z\in \bbm_1\},\ldots,\mathbf{M}_N = \{\mathrm{pr}_2(z):\,z\in \bbm_N\}
$$
суть непустые конечные множества,
$$\mathbf{M}_1\subset M_1,\ldots,\mathbf{M}_N\subset M_N.
$$

Действуя в соответствии с символикой, принятой в разделах~4.2, 4.3, введем в рассмотрение
множества $\bbx$ и $\mathbf{X}$ (см. (\ref{3.3.5}), (\ref{3.3.28})).  Напомним, что $\bbx\in
\mathrm{Fin}(X),\ \mathbf{X}\in \mathrm{Fin}(\bbx)$ и $x^o\in \mathbf{X}.$ Кроме того, из
(\ref{4.4.59}) следует с очевидностью, что в нашем случае
$$\bbx = \{x^o\} \cup \Bigl(\bigcup\limits_{s=1}^N M_s\Bigl)\in \mathrm{Fin}(\mathfrak{X}),
$$
$$\mathbf{X}= \{x^o\} \cup \Bigl(\bigcup\limits_{s=1}^N \mathbf{M}_s\Bigl)\in \mathrm{Fin}(\mathfrak{X}),
$$
$\mathbf{X}\subset \bbx$ и, как следствие,
$$\bbx \times \mathbf{X}\subset \bbx \times \bbx \subset \mathfrak{X}\times \mathfrak{X}.
$$
Мы следуем теперь (\ref{3.3.15}) в части определения трасс, согласованных с тем или иным
маршрутом, используя, конечно, конкретизацию (\ref{4.4.59}). Таким образом, а частности,
каждому маршруту $\al\in \mathbf{A}$ сопоставляется непустое конечное множество
$\mathbf{Z}_\al$ (\ref{3.3.15}) всех трасс, согласованных с данным маршрутом. Поэтому в
виде $\widetilde{\mathbf{D}}$ (\ref{3.3.27}) получаем требуемое множество ДР, реализуемых
в рамках оптимизирующей вставки.

{\bf Функции стоимости локальной задачи.} Напомним, что $\mathfrak{N}$ есть семейство всех
непустых п/м $\ov{1,N}.$ Если $K\in \mathfrak{N},$ то определено множество
$$\La^1(K) = \{\la(\nu+s):\,s\in K\}\in \cp^\prime(\Gamma),
$$
для которого, в частности, имеем, что
$$\La^1(K) \subset \ov{1,\mathbf{n}}.
$$
Всюду в дальнейшем полагаем, если не оговорено противное, что
\bfn\label{4.4.60}\nu + N + 1 \leqslant \mathbf{n}
\efn
(мы несколько усилили требование к выбору $\nu).$ Тогда
$$\ov{\nu+N+1,\mathbf{n}}\in \mathbf{N},
$$
то есть $\ov{\nu+N+1,\mathbf{n}}$ есть непустое п/м $\ov{1,\mathbf{n}}.$ Как следствие,
имеем при    $K\in \mathfrak{N},$ что
$$\La^1(K) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\in \mathbf{N};
$$
если к тому же $z\in \bbx \times \bbx,$ то определены значения
\begin{eqnarray}
&\mathbf{c}^\natural\bigl(z,\La^1(K) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\bigl)\in
&\nonumber\\
&\in[0,\infty[,\,c_1^\natural\bigl(z,\La^1(K) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\bigl)\in [0,\infty[,\ldots,
&\nonumber\\
&c_N^\natural\bigl(z,\La^1(K) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\bigl)\in [0,\infty[
&\label{4.4.61}
\end{eqnarray}
(упорядоченная пара $z$ может конкретизироваться по-разному: при рассмотрении значения
функции $\mathbf{c}^\natural$ в качестве  $z$ используем, как правило, пару $(x,y),$ где
$x= x^o$ или $x\in \mathbf{M}_j$ для некоторого $j\in\ov{1,N}$ (а $y\in M_s$ при $s\in
\ov{1,N})$; если же рассматривается значение той или иной функции $c_s^\natural,$ где
$s\in \ov{1,N},$ то в качестве $z$ обычно используется элемент $\bbm_s,$ что в конкретной
задаче управления инструментом соответствует случаю, когда $\mathrm{pr}_1(z)$ --- точка
врезки, а $\mathrm{pr}_2(z)$ --- точка выключения инструмента). С учетом (\ref{4.4.61})
конкретизируем значения локальных функций стоимости (\ref{4.2.1}).

Итак, мы полагаем, что функция $\mathbf{c}\in \car_+[\bbx \times \bbx \times
\mathfrak{N}]$ определяется по следующему правилу:
\bfn\label{4.4.62}
\mathbf{c}(z,K) \df \mathbf{c}^\natural\bigl(z,\La^1(K) \cup \la^1(\ov{\nu+N+1,
\mathbf{n}})\bigl)\ \ \fa z\in \bbx \times \bbx\ \ \fa K\in \mathfrak{N}.
\efn

Если $j\in \ov{1,N},$ то определяем функцию $c_j\in \car_+[\bbx \times \bbx \times
\mathfrak{N}]$ условиями
\bfn\label{4.4.63}
c_j(z,K) \df c_{\La(j)}^\natural\bigl(z,\La^1(K) \cup \la^1(\ov{\nu+N+1,
\mathbf{n}})\bigl)\ \ \fa z\in \bbx \times \bbx\ \ \fa K\in \mathfrak{N}.
\efn
Наконец, терминальную функцию $f\in \car_+[\bbx]$ определяем в виде
\bfn\label{4.4.64}
f(x) \df \mathbf{c}^\natural\bigl(x,\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),
\la^1(\ov{\nu+N+1,\mathbf{n}})\bigl)\ \ \fa x\in \bbx.
\efn
Итак, все функции затрат для оптимизирующей  вставки построены и мы можем
ввести соответствующий аддитивный критерий, используя (\ref{4.2.4}): каждому ДР
$\bigl(\al,(z_i)_{i\in\ov{0,N}}\bigl)\in \widetilde{\mathbf{D}}$ (это означает,
что $\al\in \mathbf{A}$ и $(z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al)$ сопоставляем число
$$
\mathfrak{B}_\al [(z_i)_{i\in\ov{0,N}}]\in [0,\infty[.
$$
В итоге получаем нужный вариант задачи (\ref{4.2.5}), для решения которой можно
использовать схему раздела~4.2  на основе широко понимаемого ДП. Мы будем предполагать,
что значение $N$ <<умеренно>> в том смысле, что упомянутая схема позволяет провести все
необходимые вычисления и получить значение $\mathbb{V}$ (\ref{4.2.6}), а также определить
оптимальное ДР $\bigl(\al^o,(z_i^o)_{i\in\ov{0,N}}\bigl)$ (\ref{4.2.7}). Итак, полагаем,
что маршрут
\bfn\label{4.4.65}
\al^o\in \mathbf{A}
\efn
и трасса (траектория)
\bfn\label{4.4.66}(z_i^o)_{i\in\ov{0,N}}\in \mathbf{Z}_{\al^o}
\efn
таковы, что при этом
\bfn\label{4.4.67}\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] = \mathbb{V}.
\efn
Последнее означает, что справедливы неравенства
$$
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] \leqslant \mathfrak{B}_\al[(z_i)_{i\in\ov{0,N}}]\ \
\fa \al\in \mathbf{A}\ \ \fa (z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\al.
$$
Отметим простое следствие последнего положения: с учетом предложения~\ref{p4.4.3} получаем, что
\bfn\label{4.4.68}
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}]\leqslant
\mathfrak{B}_\mathbf{e}[(z_i)_{i\in\ov{0,N}}]\ \ \fa
(z_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\mathbf{e}.
\efn
С целью последующего использования (\ref{4.4.68}) введем в рассмотрение
кортеж $(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\in \bbz,$ для которого
$$
\bigl(\tilde{\mathbf{h}}_o \df (x^o,x^o)\bigl)\,\&\,(\tilde{\mathbf{h}}_t \df
\mathbf{h}_{\nu+t}\ \ \fa t\in \ov{1,N}).
$$

\begin{pred}\label{p4.4.5}{\TL} Кортеж $(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}$
является трассой, согласованной с маршрутом $\mathbf{e}:$
$$
(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\mathbf{e}.
$$
\end{pred}

Д о к а з а т е л ь с т в о. Если $t\in \ov{1,N},$ то $\tilde{\mathbf{h}}_t =
\mathbf{h}_{\nu +t}\in \bbl_{\La(t)},$ а потому
$$
\tilde{\mathbf{h}}_t \in \bbm_{\mathbf{e}(t)},
$$
так как $(\La \circ \mathbf{e})(t) = \La(t).$ Дальнейшее рассуждение очевидно
(см. (\ref{3.3.15})).\hfill $\Box$ \smallskip

Из (\ref{4.4.68}) и предложения~{\ref{p4.4.5} получаем неравенство
$$
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}]\leqslant
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}].
$$
Как следствие имеем с учетом (\ref{4.4.67}), что
\bfn\label{4.4.69}
\mathbb{V} \leqslant \mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}].
\efn
С учетом (\ref{4.4.69}) получаем, следовательно, что
\bfn\label{4.4.70}
\kappa \df \mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] -
\mathbb{V} = \mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]-
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}]\in [0,\infty[.
\efn
Заметим, что величина (\ref{4.4.70}) <<привязана>> к исходному ДР $\bigl(\la,(\mathbf{h}_i)_{i\in\ov{0,N}}\bigl)$ <<большой>> задачи. В этой связи полезно заметить, что (см. (\ref{4.4.58}))
$$
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]=
\sum\limits_{s=1}^N\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_{s-1}),\mathrm{pr}_1
(\tilde{\mathbf{h}}_s),\{\mathbf{e}(t):\,t\in\ov{s,N}\}\bigl) +
$$
$$
+ c_{\mathbf{e}(s)}\bigl(\tilde{\mathbf{h}}_s,\{\mathbf{e}(t):\,t\in\ov{s,N}\}\bigl)\bigl] +
f\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_N)\bigl) = \bigl[\mathbf{c}\bigl(\mathrm{pr}_2
(\tilde{\mathbf{h}}_o),\mathrm{pr}_1(\tilde{\mathbf{h}}_1),\ov{1,N}) +
$$
$$
+ c_1(\tilde{\mathbf{h}}_1,\ov{1,N})\bigl] +
\sum\limits_{s=2}^N\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_{s-1}),
\mathrm{pr}_1(\tilde{\mathbf{h}}_s),\ov{s,N}\bigl) +
c_s(\tilde{\mathbf{h}}_s,\ov{s,N})\bigl] +
f\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_N)\bigl) =
$$
$$
= \bigl[\mathbf{c}\bigl(x^o,\mathrm{pr}_1(\mathbf{h}_{\nu+1}),\ov{1,N}\bigl) +
c_1(\mathbf{h}_{\nu+1},\ov{1,N})\bigl] +
\sum\limits_{s=2}^N\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+s-1}),
$$
$$
\mathrm{pr}_1(\mathbf{h}_{\nu+s}),\ov{s,N}\bigl) + c_s(\mathbf{h}_{\nu+s},\ov{s,N})\bigl] +
f\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N})\bigl) =
$$
$$
=\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{h}_\nu),\mathrm{pr}_1(\mathbf{h}_{\nu+1}),
\ov{1,N}\bigl) + c_1(\mathbf{h}_{\nu+1},\ov{1,N})\bigl] +
$$
$$
+ \sum\limits_{s=2}^N\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+s-1}),\mathrm{pr}_1
(\mathbf{h}_{\nu+s}),\ov{s,N}\bigl) + c_s(\mathbf{h}_{\nu+s},\ov{s,N})\bigl] +
$$
$$
+f\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N})\bigl) =
\sum\limits_{s=1}^N\bigl[\mathbf{c}\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+s-1}),\mathrm{pr}_1
(\mathbf{h}_{\nu+s}),\ov{s,N}\bigl)+
$$
$$+ c_s(\mathbf{h}_{\nu+s},\ov{s,N})\bigl] + f\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N})\bigl).
$$
Учтем теперь (\ref{4.4.62}) -- (\ref{4.4.64}). Тогда последнее выражение сводится к следующему
\begin{eqnarray}
&\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]=
\sum\limits_{s=1}^N \bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+s-1}),
\mathrm{pr}_1(\mathbf{h}_{\nu+s}),
\La^1(\ov{s,N})\cup \la^1(\ov{\nu+N+1,\mathbf{n}})\bigl) +
&\nonumber\\
&+ c_{\La(s)}^\natural\bigl(\mathbf{h}_{\nu+s},\La^1(\ov{s,N}) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\bigl)\bigl]+
&\nonumber\\
&+ \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N}),\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),
\la^1(\ov{\nu+N+1,\mathbf{n}})\bigl).
&\label{4.4.71}
\end{eqnarray}
С учетом определения $\La$ имеем, однако, что при $s\in\ov{1,N}$
$$\La^1(\ov{s,N}) \cup \la^1(\ov{\nu+N+1,\mathbf{n}}) = \{\la(\nu+t):\,t\in \ov{s,N}\} \cup
\la^1(\ov{\nu+N+1,\mathbf{n}}) =
$$
$$
=\{\la(k):\,k\in\ov{\nu+s,\nu+N}\} \cup \la^1(\ov{\nu+N+1,\mathbf{n}})=
$$
$$
=\la^1(\ov{\nu+s,\nu+N}) \cup \la^1(\ov{\nu+N+1,\mathbf{n}}) =
$$
$$
= \la^1(\ov{\nu+s,\nu+N} \cup\, \ov{\nu+N+1,\mathbf{n}}) = \la^1(\ov{\nu+s,
\mathbf{n}})
$$
(используем следующее простое свойство: образ объединения двух множеств равен
объединению их образов). Тогда из (\ref{4.4.71}) получаем, что
\begin{eqnarray}
&\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]=
\sum\limits_{s=1}^N \bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+s-1}),
\mathrm{pr}_1(\mathbf{h}_{\nu+s}),
\la^1(\ov{\nu+s,\mathbf{n}})\bigl) +
&\nonumber\\
&+c_{\la(\nu+s)}^\natural(\mathbf{h}_{\nu+s},
\la^1(\ov{\nu+s,\mathbf{n}})\bigl)\bigl] +
\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N}),\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),
\la^1(\ov{\nu+N+1,\mathbf{n}})\bigl) =
&\nonumber\\
&=\sum\limits_{t=\nu+1}^{\nu+N}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl)+
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
&\nonumber\\
&+ \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N}),\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),
\la^1(\ov{\nu+N+1,\mathbf{n}})\bigl).
&\label{4.4.72}
\end{eqnarray}

Из (\ref{4.4.11}) и (\ref{4.4.72}) видно, что
$\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]$ является
<<частью>> $\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}],$ а,
точнее, слагаемым в сумме, определяющей последнее значение.

\section{\protect\raggedright
  Алгоритм на функциональном уровне, 1
}
\label{sect:4.5}
\setcounter{equation}{0}

Сейчас, располагая  значением (\ref{4.4.70}), отвечающим улучшению ДР в
локальной задаче, мы распространим данное улучшение на случай <<большой>>
задачи (используем конструкции \cite{Cha13`}). Для этой цели будем использовать
локальное ДР с компонентами (\ref{4.4.65}), (\ref{4.4.66}). Напомним, что данное ДР
$$\bigl(\al^o,(z_i^o)_{i\in\ov{0,N}}\bigl)\in \widetilde{\mathbf{D}}
$$
реализует равенство (\ref{4.4.67}), что, кстати, уже было учтено в (\ref{4.4.70}).

Отметим, что согласно предложению~\ref{p4.4.2}
\bfn\label{4.5.1}
\eta \df (\al^o - \mathrm{sew})[\la;\nu] \in\ca
\efn
есть $\mathfrak{K}$-допустимый маршрут <<большой>> задачи. Тогда, в частности,
\bfn\label{4.5.1`}
\eta: \ov{1,\mathbf{n}}{\stackrel{\mbox{\footnotesize{на}}}{\longrightarrow}}\,\ov{1,\mathbf{n}};
\efn
при этом (см. определение~\ref{p4.4.1})
\bfn\label{4.5.2}
\bigl(\eta(t) = \la(t)\ \ \fa t\in \ov{1,\mathbf{n}}\setminus
\ov{\nu+1,\nu+N}\bigl)\,\&\,\bigl(\eta(t) = (\La\circ \al^o)(t- \nu)\ \ \fa t\in \ov{\nu+1,\nu+N}\bigl).
\efn
Ясно, что в силу (\ref{4.5.2})
\bfn\label{4.5.3}
\bigl(\eta(t) = \la(t)\ \ \fa t\in \ov{1,\nu}\bigl)\,\&\,\bigl(\eta(t) =
\la(t)\ \ \fa t\in \ov{\nu+N+1,\mathbf{n}}\bigl).
\efn
Кроме того, из (\ref{4.5.2}) вытекает, что
\bfn\label{4.5.4}
\eta(t) = \la\bigl(\nu + \al^o(t-\nu)\bigl)\ \ \fa t\in \ov{\nu+1,\nu+N}.
\efn
Соотношения (\ref{4.5.2}) -- (\ref{4.5.4}) исчерпывающим образом характеризуют
допустимый маршрут $\eta$ (\ref{4.5.1}) (имеется в виду допустимость в <<большой>>
задаче). Мы называем маршрут (\ref{4.5.1}) склеенным, что вполне соответствует
(\ref{4.5.2}) -- (\ref{4.5.4}). Отметим некоторые свойства данного маршрута.

Из (\ref{4.5.2}) непосредственно следует, что
\bfn\label{4.5.5}
\eta^1(\ov{t,\mathbf{n}}) = \la^1(\ov{t,\mathbf{n}})\ \ \fa t\in \ov{\nu+N+1, \mathbf{n}}.
\efn
Свойство (\ref{4.5.5}) дополняется следующим положением.

\begin{pred}\label{p4.5.1}{\TL} Если $t\in \ov{1,\nu},$ то $\eta^1(\ov{t,\mathbf{n}}) =
\la^1(\ov{t,\mathbf{n}}).$
\end{pred}

Д о к а з а т е л ь с т в о. Фиксируем индекс $t\in \ov{1,\nu}.$ Тогда $t\leqslant \nu.$ При этом
\bfn\label{4.5.6}(t=1) \vee (t\in \ov{2,\nu}).
\efn
Заметим теперь, что $\la^1(\ov{1,\mathbf{n}}) = \ov{1,\mathbf{n}}$ по выбору $\la.$
С другой стороны, из (\ref{4.5.1`}) имеем, что $\eta^1(\ov{1,\mathbf{n}}) =\ov{1,\mathbf{n}}.$
Поэтому
\bfn\label{4.5.6`}
\la^1(\ov{1,\mathbf{n}})  =\ov{1,\mathbf{n}} =\eta^1(\ov{1,\mathbf{n}}).
\efn
Как следствие получаем импликацию
\bfn\label{4.5.7}
(t=1)\Longrightarrow \bigl(\la^1(\ov{t,\mathbf{n}}) = \eta^1(\ov{t,\mathbf{n}})\bigl).
\efn
Рассмотрим теперь (второй в (\ref{4.5.6})) случай $t\in \ov{2,\nu}.$ Тогда
$$
t-1 \in \ov{1,\nu-1}
$$
и, в частности, $t-1\in \ov{1,\mathbf{n}}.$ По свойствам операции взятия образа имеем
\bfn\label{4.5.8}
\la^1(\ov{1,\mathbf{n}}) = \la^1(\ov{1,t-1} \cup \ov{t,\mathbf{n}}) = \la^1(\ov{1,t-1})
\cup \la^1(\ov{t,\mathbf{n}}),
\efn
\bfn\label{4.5.9}
\eta^1(\ov{1,\mathbf{n}}) = \eta^1(\ov{1,t-1} \cup \ov{t,\mathbf{n}}) = \eta^1(\ov{1,t-1})
\cup \eta^1(\ov{t,\mathbf{n}}).
\efn
Далее в силу инъективности $\la$ и $\eta$ получаем, что
\bfn\label{4.5.10}
\la^1(\ov{1,t-1}) \cap  \la^1(\ov{t,\mathbf{n}}) = \emp,
\efn
\bfn\label{4.5.11}
\eta^1(\ov{1,t-1}) \cap  \eta^1(\ov{t,\mathbf{n}}) = \emp.
\efn
Из (\ref{4.5.8}), (\ref{4.5.10})  следует очевидное равенство
$$
\la^1(\ov{t,\mathbf{n}}) = \la^1(\ov{1,\mathbf{n}})\setminus \la^1(\ov{1,t-1}),
$$
а из (\ref{4.5.9}) и (\ref{4.5.11}) имеем, в свою очередь, что
$$
\eta^1(\ov{t,\mathbf{n}}) = \eta^1(\ov{1,\mathbf{n}})\setminus \eta^1(\ov{1,t-1}).
$$
Поскольку согласно (\ref{4.5.3}) $\eta^1(\ov{1,t-1}) = \la^1(\ov{1,t-1}),$ имеем теперь
(см. (\ref{4.5.6`})) требуемое равенство
\bfn\label{4.5.12}
\la^1(\ov{t,\mathbf{n}}) = \eta^1(\ov{t,\mathbf{n}})
\efn
и в случае $t\in \ov{2,\nu}.$ Итак, установлена импликация
$$
(t\in \ov{2,\nu}) \Longrightarrow \bigl(\la^1(\ov{t,\mathbf{n}}) = \eta^1(\ov{t,\mathbf{n}})\bigl).
$$
С учетом (\ref{4.5.6}) и (\ref{4.5.7}) получаем, что (\ref{4.5.12}) имеет место во всех
возможных случаях. \hfill $\Box$

\begin{cor}\label{c4.5.1}
Если $t\in \ov{1,\mathbf{n}}\setminus \ov{\nu+1,\nu+N},$ то $\eta^1(\ov{t,\mathbf{n}}) =
\la^1(\ov{t,\mathbf{n}}).$
\end{cor}

Действительно, имеем по выбору $\nu,$ что
$$
\ov{1,\mathbf{n}}\setminus \ov{\nu+1,\nu+N} = \ov{1,\nu} \cup \ov{\nu+N+1,\mathbf{n}},
$$
а потому, комбинируя (\ref{4.5.5}) и предложение~\ref{p4.5.1}, получаем нужное утверждение.
\begin{pred}\label{p4.5.2}
{\TL} Если $t\in \ov{\nu+1,\nu+N},$ то справедливо равенство
\bfn\label{4.5.12`}
\eta^1(\ov{t,\mathbf{n}}) = \la^1\bigl(\{\nu + \al^o(s):\,s\in \ov{t-\nu,N}\} \cup
\ov{\nu+N+1,\mathbf{n}}\bigl).
\efn
\end{pred}

Д о к а з а т е л ь с т в о. Введем в рассмотрение множество
\bfn\label{4.5.13}
A \df \{\nu +\al^o(s):\,s\in \ov{t-\nu,N}\}\in \cp^\prime(\ov{\nu+1,\nu+N}),
\efn
где $t\in \ov{\nu+1,\nu+N}$ фиксировано и $t-\nu\in \ov{1,N}.$ Из (\ref{4.5.13}) имеем,
что $A$ --- непустое множество и при этом
$$
A \subset \ov{\nu+1,\nu+N}.
$$
В связи с (\ref{4.5.12`}) отметим, что требуется установить равенство
\bfn\label{4.5.14}
\eta^1(\ov{t,\mathbf{n}}) = \la^1(A \cup \ov{\nu+N+1,\mathbf{n}}).
\efn
Выберем произвольный индекс
\bfn\label{4.5.15}
p\in \eta^1(\ov{t,\mathbf{n}}).
\efn
Тогда $p\in \ov{1,\mathbf{n}}$ и при этом $p=\eta(\tau),$ где
$\tau\in \ov{t,\mathbf{n}}$ таково, что
\bfn\label{4.5.16}
(\tau\in \ov{\nu+1,\nu+N}) \vee (\tau\in \ov{\nu+N+1,\mathbf{n}}).
\efn
Оба случая в (\ref{4.5.16}) рассмотрим отдельно.

1) Пусть $\tau\in \ov{\nu+1,\nu+N}.$ Получаем тогда, что $\tau- \nu\in \ov{1,N}$
и в силу (\ref{4.5.2})
$$
p = (\La \circ \al^o)(\tau-\nu) = \La\bigl(\al^o(\tau-\nu)\bigl),
$$
откуда по определению $\La$ следует, что
\bfn\label{4.5.17}
p = \la\bigl(\nu + \al^o(\tau-\nu)\bigl).
\efn
Из (\ref{4.5.13}) следует, что $\nu + \al^o(\tau-\nu) \in A,$ так как по выбору
$\tau$ имеем в рассматриваемом случае
$$
\tau-\nu \in \ov{t-\nu,N}.
$$
Поэтому $p\in \la^1(A),$ где по свойствам операции взятия образа
$$
\la^1(A) \subset \la^1(A \cup \ov{\nu+N+1,\mathbf{n}}).
$$
В итоге $p\in \la^1(A \cup \ov{\nu+N+1,\mathbf{n}})$ в случае 1), чем
завершается проверка импликации
\bfn\label{4.5.18}
(\tau\in \ov{\nu+1,\nu+N}) \Longrightarrow \bigl(p\in \la^1(A \cup
\ov{\nu+N+1,\mathbf{n}})\bigl).
\efn

2) Пусть $\tau \in \ov{\nu+N+1,\mathbf{n}}.$ Тогда в силу (\ref{4.5.2})
$$
p= \eta(\tau) \in \eta^1(\ov{\nu+N+1,\mathbf{n}}),
$$
где согласно (\ref{4.5.5}) $\eta^1(\ov{\nu+N+1,\mathbf{n}}) =
\la^1(\ov{\nu+N+1,\mathbf{n}}),$ а потому
\bfn\label{4.5.19}
p\in \la^1(\ov{\nu+N+1,\mathbf{n}}).
\efn
Вновь используя простейшие свойства  операции взятия образа, имеем, что
\bfn\label{4.5.20}p\in \la^1(A \cup \ov{\nu+N+1,\mathbf{n}})
\efn
и в случае 2). Получаем импликацию
$$
(\tau\in \ov{\nu+N+1,\mathbf{n}})\Longrightarrow \bigl(p\in \la^1(A \cup
\ov{\nu+N+1,\mathbf{n}})\bigl).
$$
С учетом (\ref{4.5.16}) и (\ref{4.5.18}) получаем, что (\ref{4.5.20})
справедливо во всех возможных случаях. Поскольку выбор (\ref{4.5.15}) был
произвольным, установлено, что
\bfn\label{4.5.21}
\eta^1(\ov{t,\mathbf{n}}) \subset \la^1(A \cup \ov{\nu+N+1,\mathbf{n}}).
\efn
Выберем теперь произвольный индекс
\bfn\label{4.5.22}q\in  \la^1(A \cup \ov{\nu+N+1,\mathbf{n}}).
\efn
 Из (\ref{4.5.22}) следует, что $q\in \ov{1,\mathbf{n}},$ причем для некоторого
 \bfn\label{4.5.23}r \in A \cup \ov{\nu+N+1,\mathbf{n}}
 \efn
 справедливо следующее равенство:
 \bfn\label{4.5.23`}q = \la(r).
 \efn
 Из (\ref{4.5.23})  вытекает с очевидностью, что
 \bfn\label{4.5.24}(r\in A) \vee (r\in  \ov{\nu+N+1,\mathbf{n}}).
 \efn
 Обе возможности в (\ref{4.5.24}) рассмотрим отдельно.

$1^\prime)$  Пусть $r\in A.$ Тогда (см. (\ref{4.5.13})) для некоторого
\bfn\label{4.5.25}\theta\in \ov{t-\nu,N}
\efn
справедливо равенство $r = \nu + \al^o(\theta),$ а потому (см. (\ref{4.5.23`}))
\bfn\label{4.5.26}q = \la\bigl(\nu + \al^o(\theta)\bigl).
\efn
Поскольку $\theta\in\ov{1,N},$ то для индекса
$$\widetilde{\theta} \df \nu +\theta \in \ov{t,\nu+N}
$$
имеем, в частности, $\widetilde{\theta}\in \ov{\nu+1,\nu +N},$ а тогда
согласно (\ref{4.5.2}) \bfn\label{4.5.27}\eta(\widetilde{\theta}) =
\La\bigl(\al^o(\widetilde{\theta}-\nu)\bigl) = \la\bigl(\nu+ \al^o(\theta)\bigl),
\efn
где $\eta(\widetilde{\theta}) \in \eta^1(\ov{t,\nu+N})$ и, в частности,
$\eta(\widetilde{\theta}) \in \eta^1(\ov{t,\mathbf{n}}),$ поскольку
$$\eta^1(\ov{t,\nu+N})\subset \eta^1(\ov{t,\mathbf{n}}).
$$
С учетом (\ref{4.5.26}) и (\ref{4.5.27}) получаем, что
$$q = \eta(\widetilde{\theta}) \in \eta^1(\ov{t,\mathbf{n}})
$$
в рассматриваемом случае $1^\prime).$  Итак,
\bfn\label{4.5.28}(r\in A) \Longrightarrow \bigl(q \in \eta^1(\ov{t,\mathbf{n}})\bigl).
\efn

$2^\prime)$  Пусть теперь $r\in \ov{\nu+N +1,\mathbf{n}}.$ Тогда с учетом
(\ref{4.5.5}) и (\ref{4.5.23`})
\bfn\label{4.5.29}q\in \eta^1(\ov{\nu+N+1,\mathbf{n}}),
\efn
поскольку $\la^1(\ov{\nu+N+1,\mathbf{n}})= \eta^1(\ov{\nu+N+1,\mathbf{n}})$ и
$q = \la(r)\in \la^1(\ov{\nu+N+1,\mathbf{n}}).$ Из (\ref{4.5.29}) вытекает, что
$q\in \eta^1(\ov{t,\mathbf{n}})$ и в случае $2^\prime).$  Итак,
$$(r\in \ov{\nu+N+1,\mathbf{n}})\Longrightarrow \bigl(q\in \eta^1(\ov{t,\mathbf{n}})\bigl).
$$
С учетом (\ref{4.5.24}) и (\ref{4.5.28}) имеем теперь, что
$q\in \eta^1(\ov{t,\mathbf{n}})$ во всех возможных случаях. Поскольку выбор
(\ref{4.5.22}) был произвольным, установлено, что
$$\la^1(A \cup \ov{\nu+N+1,\mathbf{n}})\subset \eta^1(\ov{t,\mathbf{n}}),
$$
откуда с учетом (\ref{4.5.21}) получаем требуемое равенство (\ref{4.5.14}). \hfill $\Box$

Из предложения~\ref{p4.5.2} вытекает (с использованием простейших свойств
операции взятия образа), что
\begin{eqnarray}
&\eta^1(\ov{t,\mathbf{n}}) = \la^1\bigl(\{\nu + \al^o(s):\,s\in \ov{t-\nu,N}\}\bigl)
\cup \la^1 (\ov{\nu+N+1,\mathbf{n}}) =
&\nonumber\\
&=\{\la\bigl(\nu+\al^o(s)\bigl):\,s\in \ov{t-\nu,N}\}) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})=
&\nonumber\\
&= \{(\La \circ \al^o)(s):\,s\in\ov{t-\nu,N}\} \cup \la^1(\ov{\nu+N+1,\mathbf{n}}) =
&\nonumber\\
&= (\La\circ \al^o)^1(\ov{t-\nu,N}) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\ \ \fa t\in \ov{\nu+1,\nu+N}.
&\label{4.5.30}
\end{eqnarray}
Из (\ref{4.5.5}), следствия~\ref{c4.5.1}  и (\ref{4.5.30}) получаем теперь, что
\begin{eqnarray}
&\bigl(\eta^1(\ov{t,\mathbf{n}}) = \la^1(\ov{t,\mathbf{n}})\ \ \fa t\in
\ov{1,\mathbf{n}}\setminus \ov{\nu+1,\nu+N}\bigl)\,\&\,\bigl(\eta^1(\ov{t,\mathbf{n}}) =
&\nonumber\\
&=(\La\circ \al^o)^1(\ov{t-\nu,N}) \cup \la^1(\ov{\nu+N+1,\mathbf{n}})\ \ \fa t\in \ov{\nu+1,\nu+N}\bigl).
&\label{4.5.31}
\end{eqnarray}
В (\ref{4.5.31}) явным образом указаны списки заданий, складывающиеся вдоль
склеенного маршрута. Введем теперь в рассмотрение склеенную трассу. Точнее,
речь идет о вклеивании в $(\mathbf{h}_t)_{t\in \ov{0,\mathbf{n}}}$  фрагмента,
определяемого посредством (\ref{4.4.66}).

Итак, введем в рассмотрение кортеж
\bfn\label{4.5.31`}(\hat{\mathbf{h}}_t)_{t\in \ov{0,\mathbf{n}}}\in \widetilde{\mathfrak{Z}},
\efn
определяемый с помощью следующих условий:
\bfn\label{4.5.32}(\hat{\mathbf{h}}_t \df z_{t-\nu}^o\ \ \fa t\in \ov{\nu+1,\nu+N})\,
\&\,(\hat{\mathbf{h}}_t \df \mathbf{h}_t\ \ \fa t\in \ov{0,\mathbf{n}}\setminus \ov{\nu+1,\nu+N}).
\efn

\begin{pred}\label{p4.5.3}{\TL} Кортеж $(\ref{4.5.31`})$ является трассой,
согласованной с маршрутом $\eta:$
\bfn\label{4.5.33}(\hat{\mathbf{h}}_t)_{t\in \ov{0,\mathbf{n}}}\in \mathfrak{Z}_\eta.
\efn
\end{pred}

Д о к а з а т е л ь с т в о.  Из (\ref{4.5.32}) вытекает, что
\bfn\label{4.5.34}\hat{\mathbf{h}}_o = \mathbf{h}_o = (\mathbf{x}_o,\mathbf{x}_o).
\efn
Если $t\in \ov{\nu+1,\nu+N},$ то $t-\nu \in \ov{1,N}$ и в силу (\ref{4.5.32}) имеем включение
$$\hat{\mathbf{h}}_t = z_{t-\nu}^o \in \mathbb{M}_{\al^o(t-\nu)},
$$
а потому с учетом (\ref{4.4.59}) $\hat{\mathbf{h}}_t \in  \mathbb{L}_{(\La\circ \al^o)(t-\nu)};$
как следствие получаем (см. (\ref{4.5.2})), что
$$\hat{\mathbf{h}}_t \in  \mathbb{L}_{\eta(t)}.
$$
Наконец, при $t\in \ov{1,\mathbf{n}}\setminus \ov{\nu+1,\nu+N}$ имеем согласно (\ref{4.5.2}),
что $\eta(t) = \la(t),$ а потому (см. (\ref{4.4.18}), (\ref{4.5.32}))
$$\hat{\mathbf{h}}_t = \mathbf{h}_t\in \mathbb{L}_{\eta(t)}.
$$
Таким образом (см. (\ref{4.5.34})), установлено, что кортеж (\ref{4.5.31`}) обладает свойствами
$$\bigl(\hat{\mathbf{h}}_o = (\mathbf{x}_o,\mathbf{x}_o)\bigl)\,\&\,(\hat{\mathbf{h}}_t  \in
\mathbb{L}_{\eta(t)}\ \ \fa t\in \ov{1,\mathbf{n}});
$$
это означает справедливость требуемого включения (\ref{4.5.33}). \hfill $\Box$

Из (\ref{4.5.1}) и предложения~\ref{p4.5.3} вытекает, что
$\bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}\bigl)$ есть ДР <<большой>> задачи,
а потому определено
$$\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}]\in [0,\infty[;
$$
при этом $\bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}\bigl)\in \mathrm{SOL}.$
%%%

Обсудим некоторые свойства данного ДР, выделяя для отдельного рассмотрения следующие два случая:
$\nu = 0,\ \nu \neq 0.$ В настоящем разделе обсудим более простой первый случай. Рассмотрение
второго будет проведено в следующем разделе.

Итак, пусть до конца  настоящего раздела
\bfn\label{4.5.35}\nu = 0.
\efn
В этом случае имеем, конечно, следующие два равенства
\bfn\label{4.5.36}(\ov{\nu+1,\nu+N} = \ov{1,N})\,\&\,(\ov{1,\mathbf{n}}\setminus
\ov{\nu+1,\nu+N}= \ov{N+1,\mathbf{n}}).
\efn
Итак, мы рассматриваем сейчас коррекцию начальной <<части>> исходного ДР <<большой>>
задачи. В этом случае согласно (\ref{4.5.2}), (\ref{4.5.3}) и (\ref{4.5.36})
\bfn\label{4.5.37}
\bigl(\eta(t) = (\La \circ \al^o)(t) \ \ \fa t\in \ov{1,N}\bigl)\,\&\,\bigl(\eta(t) =\la(t) \ \
\fa t\in \ov{N+1,\mathbf{n}}\bigl).
\efn
При этом $\La(s) = \la(s)\ \ \fa s\in \ov{1,N}.$ Как следствие
$$
\Gamma = \la^1(\ov{1,N}).
$$
С учетом первого выражения в (\ref{4.5.37}) имеем, что
\bfn\label{4.5.38}
\eta(t) = \La\bigl(\al^o(t)\bigl) = \la\bigl(\al^o(t)\bigl) \ \ \fa t\in \ov{1,N}.
\efn
Кроме того, отметим, что (в случае (\ref{4.5.35}))
\bfn\label{4.5.39}
x^o = \mathrm{pr}_2(\mathbf{h}_\nu) = \mathrm{pr}_2(\mathbf{h}_o)= \mathbf{x}_o.
\efn
Из общих построений вытекает с учетом (\ref{4.5.35}), что $\fa s\in \ov{1,N}$
\bfn\label{4.5.40}
(M_s = \mathbf{L}_{\la(s)})\,\&\,(\mathbb{M}_s = \mathbb{L}_{\la(s)}).
\efn
Ясно, что в рассматриваемом сейчас случае
$$
\mathbf{M}_s = \{\mathrm{pr}_2(z):\,z\in \bbl_{\la(s)}\}\in \cp^\prime(\mathbf{L}_{\la(s)}).
$$
Кроме того, имеем очевидное равенство
$$
\bbx = \{\mathbf{x}_o\} \cup \Bigl(\bigcup\limits_{s=1}^N\mathbf{L}_{\la(s)}\Bigl).
$$
Если $K\in \mathfrak{N},$ то $\La^1(K) \cup \la^1(\ov{\nu+N+1,\mathbf{n}}) = \la^1(K \cup
\ov{N+1,\mathbf{n}});$ поэтому
$$\mathbf{c}(z,K) = \mathbf{c}^\natural\bigl(z,\la^1(K \cup \ov{N+1,\mathbf{n}})\bigl)\ \
\fa z\in \bbx \times \bbx\ \ \fa K\in \mathfrak{N}.
$$
Кроме того, из общих определений легко следует, что
$$
c_j(z,K) = c_{\la(j)}^\natural\bigl(z,\la^1(K \cup \ov{N+1,\mathbf{n}})\bigl)\ \ \fa j\in
\ov{1,N}\ \ \fa z\in \bbx \times \bbx\ \ \fa K\in \mathfrak{N}.
$$
Наконец, имеем (в рассматриваемом случае (\ref{4.5.35})), что
$$
f(x) = \mathbf{c}^\natural\bigl(x,\mathrm{pr}_1(\mathbf{h}_{N+1}),\la^1(\ov{N+1,
\mathbf{n}})\bigl)\ \ \fa x\in \bbx.
$$
С учетом упомянутых конкретизаций рассмотрим нужный вариант представления значения
$$
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] \in [0,\infty[.
$$
В самом деле, из (\ref{4.2.4}) имеем теперь следующее равенство
\begin{eqnarray}
&\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] =
\sum\limits_{t=1}^N\bigl[\mathbf{c}^\natural\Bigl(\mathrm{pr}_2(z_{t-1}^o),\mathrm{pr}_1(z_t^o),\la^1\bigl(
\{\al^o(s):\,s\in\ov{t,N}\} \cup \ov{N+1,\mathbf{n}})\bigl)+&\nonumber\\
&+ c_{\la(\al^o(t))}^\natural\Bigl(z_t^o,\la^1\bigl(\{\al^o(s):\,s\in \ov{t,N}\}\cup\ov{N+1,\mathbf{n}})\bigl)\bigl]+
&\nonumber\\
&+\mathbf{c}^\natural\bigl(\mathrm{pr}_2(z_N^o),\mathrm{pr}_1(\mathbf{h}_{N+1}),\la^1(\ov{N+1,\mathbf{n}})\bigl).
&\label{4.5.41}
\end{eqnarray}
Напомним, что в рассматриваемом сейчас случае согласно (\ref{4.5.32}) и (\ref{4.5.39})
\bfn\label{4.5.42}
(\hat{\mathbf{h}}_t = z_t^o\ \ \fa t\in \ov{1,N})\,\&\,\bigl(\hat{\mathbf{h}}_o = \mathbf{h}_o =
(\mathbf{x}_o,\mathbf{x}_o)\bigl)\,\&\,(\hat{\mathbf{h}}_t = \mathbf{h}_t\ \ \fa t\in \ov{N+1,\mathbf{n}}).
\efn
Из (\ref{4.5.32}) и (\ref{4.5.42}), в частности, следует, что
\bfn\label{4.5.43}
\mathbf{c}^\natural\bigl(\mathrm{pr}_2(z_N^o),\mathrm{pr}_1(\mathbf{h}_{N+1}),
\la^1(\ov{N+1,\mathbf{n}})\bigl) = \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_N),
\mathrm{pr}_1(\hat{\mathbf{h}}_{N+1}),
\eta^1(\ov{N+1,\mathbf{n}})\bigl).
\efn
В связи с конкретизацией слагаемых в первой сумме в (\ref{4.5.41}) заметим, что
$$
\mathbf{c}^\natural\Bigl(\mathrm{pr}_2(z_o^o),\mathrm{pr}_1(z_1^o), \la^1\bigl(\{\al^o(s):\,s\in
\ov{1,N}\}\cup \ov{N+1,\mathbf{n}}\bigl)\Bigl) =
\mathbf{c}^\natural\bigl(x^o,\mathrm{pr}_1(\hat{\mathbf{h}}_1),\ov{1,\mathbf{n}}\bigl),
$$
откуда с учетом (\ref{4.5.32}) и (\ref{4.5.39}) следует равенство
\begin{eqnarray}
&\mathbf{c}^\natural\Bigl(\mathrm{pr}_2(z_o^o),\mathrm{pr}_1(z_1^o),
\la^1\bigl(\{\al^o(s):\,s\in \ov{1,N}\}\cup \ov{N+1,\mathbf{n}}\bigl)\Bigl) =
&\nonumber\\
&= \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_o),\mathrm{pr}_1(\hat{\mathbf{h}}_1),
 \eta^1(\ov{1,\mathbf{n}})\bigl).
&\label{4.5.43`}
\end{eqnarray}

 Если же $t\in \ov{2,N},$ то $t-1\in \ov{1,N-1}$ и $\mathrm{pr}_2(z_{t-1}^o) =
\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1});$ кроме того, $\mathrm{pr}_1(z_t^o) =
\mathrm{pr}_1(\hat{\mathbf{h}}_t)$ и
$$\mathbf{c}^\natural\Bigl(\mathrm{pr}_2(z_{t-1}^o),\mathrm{pr}_1(z_t^o),
\la^1\bigl(\{\al^o(s):\,s\in \ov{t,N}\}\cup \ov{N+1,\mathbf{n}}\bigl)\Bigl) =
$$
$$
= \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\la^1\bigl(\{\al^o(s):\,s\in\ov{t,N}\}\bigl)\cup \la^1(\ov{N+1,\mathbf{n}})\bigl)=
$$
$$
= \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\{\la\bigl(\al^o(s)\bigl):\,s\in\ov{t,N}\}\cup\la^1(\ov{N+1,\mathbf{n}})\bigl)=
$$
$$
=\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\{\eta(s):\,s\in\ov{t,N}\}\cup \eta^1(\ov{N+1,\mathbf{n}})\bigl)=
$$
$$= \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,N})\cup \eta^1(\ov{N+1,\mathbf{n}})\bigl)=
$$
$$
=\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\mathbf{n}})\bigl).
$$
С учетом (\ref{4.5.43`}) получаем, что
\begin{eqnarray}
&\mathbf{c}^\natural\Bigl(\mathrm{pr}_2(z_{t-1}^o),\mathrm{pr}_1(z_t^o),
\la^1\bigl(\{\al^o(s):\,s\in \ov{t,N}\}
\cup \ov{N+1,\mathbf{n}}\bigl)\Bigl)=
&\nonumber\\
&= \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\mathbf{n}})\bigl)\ \ \fa t\in \ov{1,N}.
&\label{4.5.44}
\end{eqnarray}
Аналогичным образом устанавливается, что
$$c_{\la(\al^o(t))}^\natural\Bigl(z_t^o,\la^1\bigl(\{\al^o(s):\,s\in
\ov{t,N}\} \cup \ov{N+1,\mathbf{n}}\bigl)\Bigl) =
c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\mathbf{n}})\bigl) \ \
\fa t\in\ov{1,N}.
$$
С учетом (\ref{4.5.41}), (\ref{4.5.43}) и (\ref{4.5.44}) имеем теперь следующее равенство:
\begin{eqnarray}
&\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] =
\sum\limits_{t=1}^N\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\mathbf{n}})\bigl) +
&\nonumber\\
&+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\mathbf{n}})\bigl)
\bigl] + \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_N),
\mathrm{pr}_1(\hat{\mathbf{h}}_{N+1}),
\eta^1(\ov{N+1,\mathbf{n}})\bigl).
&\label{4.5.45}
\end{eqnarray}
С другой стороны, $\bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,
\mathbf{n}}}\bigl)$ есть ДР <<большой>> задачи, а потому
$$
\begin{array}{c}
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\sum\limits_{t=1}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\mathbf{n}})\bigl) +
\\
+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\mathbf{n}})\bigl)\bigl]+
f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\mathbf{n})\bigl).
\end{array}
$$
Теперь с учетом (\ref{4.5.45}) получаем из последнего выражения, что
\bfn\label{4.5.46}\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] + c_{\eta(N+1)}^\natural\bigl(\hat{\mathbf{h}}_{N+1},
\eta^1(\ov{N+1,\mathbf{n}})\bigl)  + \xi,
\efn
где $\xi$ есть некоторое неотрицательное число, описываемое разными выражениями в зависимости
от того, что $N+1 <\mathbf{n}$  или $N+1 = \mathbf{n}.$ Первый случай, конечно, более
интересен, но мы все же рассмотрим обе возможности. Итак, у нас
\bfn\label{4.5.47}(N+1 <\mathbf{n}) \vee (N+1 = \mathbf{n}).
\efn
Рассмотрим отдельно обе возможности в (\ref{4.5.47}).

а) Пусть $N+1 <\mathbf{n}.$ Иными словами, $N+2\leqslant \mathbf{n}$ и, как следствие,
$$
\ov{N+2,\mathbf{n}}\neq \emp.
$$
Тогда значение $\xi$ определяется выражением
$$
\xi = \sum\limits_{t=N+2}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\mathbf{n}})\bigl) +
c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\mathbf{n})\bigl).
$$
С учетом (\ref{4.5.42}) и следствия~\ref{c4.5.1} имеем в данном случае, что
$$
\xi = \sum\limits_{t=N+2}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl).
$$
Тогда из (\ref{4.5.46}) получаем (при $N+1 < \mathbf{n}),$ что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] +
c_{\la(N+1)}^\natural\bigl(\mathbf{h}_{N+1},\la^1(\ov{N+1,\mathbf{n}})\bigl)  +
&\nonumber\\
&+ \sum\limits_{t=N+2}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
&\nonumber\\
&+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl)
&\label{4.5.48}
\end{eqnarray}
(учли (\ref{4.5.42}) и следствие~\ref{c4.5.1}).  Используя (\ref{4.4.70}),
получаем из (\ref{4.5.48}), что
$$
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] -\kappa +
c_{\la(N+1)}^\natural\bigl(\mathbf{h}_{N+1},\la^1(\ov{N+1,\mathbf{n}})\bigl) +
$$
$$
+ \sum\limits_{t=N+2}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl).
$$
Теперь воспользуемся  представлением (\ref{4.4.72}). Тогда
$$
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\sum\limits_{t=1}^N\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
$$
$$
+ c^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_N),\mathrm{pr}_1\bigl(\mathbf{h}_{N+1}),
\la^1(\ov{N+1,\mathbf{n}})\bigl) - \kappa +
c_{\la(N+1)}^\natural\bigl(\mathbf{h}_{N+1},\la^1(\ov{N+1,\nn})\bigl)+ $$
$$
+ \sum\limits_{t=N+2}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) + c_{\la(t)}^\natural\bigl(\mathbf{h}_t,
\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] + f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl) =
$$
$$
= \sum\limits_{t=1}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl) -\kappa =
$$
$$
= \widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}] - \kappa.
$$
Итак, установлена (при $\nu =0)$ следующая импликация
\bfn\label{4.5.49}
(N+1 < \mathbf{n}) \Longrightarrow \bigl(\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in \ov{0,\mathbf{n}}}] =
\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in \ov{0,\mathbf{n}}}] - \kappa\bigl).
\efn

в) Пусть теперь $N+1 = \mathbf{n}$ (при  условии (\ref{4.5.35})). Тогда имеем цепочку равенств
\bfn\label{4.5.50}
\xi = f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\mathbf{n})\bigl) =
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl)
\efn
(см. (\ref{4.5.42})). Из (\ref{4.5.46}) следует в рассматриваемом случае равенство
$$\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] +
c_{\eta(\mathbf{n})}^\natural\bigl(\mathbf{h}_\mathbf{n},\la^1(\{\mathbf{n}\})\bigl) +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl).
$$
Тогда, учитывая определение $\kappa,$ получаем, что (см. (\ref{4.4.72}))
$$
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] - \kappa +
c_{\la(\mathbf{n})}^\natural\bigl(\mathbf{h}_\mathbf{n},\la^1(\{\mathbf{n}\})\bigl) +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl) =
$$
$$
= \sum\limits_{t=1}^N\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t), \la^1(\ov{t,\mathbf{n}})\bigl) + c_{\la(t)}^\natural\bigl(\mathbf{h}_t,
\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
$$
$$
+ \mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_N),
\mathrm{pr}_1(\mathbf{h}_{N+1}),
\la^1(\ov{N+1,\mathbf{n}})\bigl) +
c_{\la(\mathbf{n})}^\natural\bigl(\mathbf{h}_\mathbf{n},\la^1 (\{\mathbf{n}\})\bigl) +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl) -\kappa =
$$
$$
=\sum\limits_{t=1}^{\mathbf{n}-1}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t), \la^1(\ov{t,\mathbf{n}})\bigl) +
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl] +
$$
$$
+\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\mathbf{n}-1}),\mathrm{pr}_1
(\mathbf{h}_\mathbf{n}),\la^1(\ov{\mathbf{n},\mathbf{n}})\bigl) +
c_{\la(\mathbf{n})}^\natural\bigl(\mathbf{h}_\mathbf{n},\la^1(\ov{\mathbf{n},\mathbf{n}})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl) - \kappa =
$$
%%%
$$
= \sum\limits_{t=1}^\mathbf{n}\bigl[\mathbf{c}^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),\la^1(\ov{t,\mathbf{n}})\bigl) +
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\mathbf{n}})\bigl)\bigl]
+f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\mathbf{n})\bigl) - \kappa.
$$
С учетом (\ref{4.4.11}) получаем нужное равенство
$$
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}] - \kappa
$$
и при $N+1 = \mathbf{n}.$ Итак, имеем (при $\nu = 0)$ следующую импликацию
$$
(N+1 = \mathbf{n}) \Longrightarrow \bigl(\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in
\ov{0,\mathbf{n}}}] = \widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}] - \kappa\bigl).
$$
С учетом (\ref{4.5.47}), (\ref{4.5.49}) и (\ref{4.5.50}) получаем, что во всех возможных при $\nu=0$ случаях
\bfn\label{4.5.51}
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\mathbf{n}}}] =
\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}] - \kappa.
\efn
Итак (см. (\ref{4.5.35}), (\ref{4.5.51})), имеем окончательно, что
\bfn\label{4.5.52}(\nu=0) \Longrightarrow \bigl(\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in
\ov{0,\mathbf{n}}}] = \widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\mathbf{n}}}] - \kappa\bigl).
\efn
Таким образом, в случае применения <<начальной>> оптимизирующей вставки реализуется улучшение
качества на величину $\kappa$ (если, конечно, $\kappa >0).$

\section{\protect\raggedright
  Алгоритм на функциональном уровне, 2
}
\label{sect:4.6}
\setcounter{equation}{0}

В настоящем разделе обсуждается случай построения оптимизирующей вставки при  $\nu \neq 0.$
Итак, ниже предполагается, что
\bfn\label{4.6.1}\nu\in \ov{1,\mathbf{n}-(N+1)}.
\efn
Из (\ref{4.6.1}) вытекают очевидные свойства
\bfn\label{4.6.2}(\ov{1,\nu}\neq \emp)\,\&\,(\ov{\nu+N+1,\mathbf{n}}\neq \emp).
\efn
Итак, по построению вставка, рассматриваемая в настоящем разделе, является <<средней>>.
Напомним, что $\eta\in \ca$ имеет следующий вид:
\begin{eqnarray}
&\bigl(\eta(t) = \la(t)\ \ \fa t\in \ov{1,\nu}\bigl)\,\&\,\bigl(\eta(t) =
\la(\nu+ \al^o(t-\nu)\bigl)\ \ \fa t\in \ov{\nu+1,\nu+N}\bigl)\,\&
&\nonumber\\
&\&\,\bigl(\eta(t)= \la(t)\ \ \fa t\in \ov{\nu+N+1,\mathbf{n}}\bigl).
&\label{4.6.3}
\end{eqnarray}
Из (\ref{4.6.2}) и (\ref{4.6.3}) видно, что склеенный маршрут $\eta$ имеет три
характерных невырожденных фрагмента.

Напомним предложения~\ref{p4.5.1}, \ref{p4.5.2} и следствие~\ref{c4.5.1}. В частности,
из предложения~\ref{p4.5.2}  по свойствам операции взятия образа следует, что
\begin{eqnarray}
&\eta^1(\ov{t,\mathbf{n}}) = \la^1\bigl(\{\nu+\al^o(s):\,s\in \ov{t-\nu,N}\}\,\cup\,
\ov{\nu+N+1,\nn}\bigl) =
&\nonumber\\
&= (\La \circ\al^o)^1(\ov{t-\nu,N})\,\cup\, \la^1(\ov{\nu+N+1,\nn})\ \ \fa t\in \ov{\nu+1,\nu+N}.
&\label{4.6.3`}
\end{eqnarray}
Кроме того, полезно иметь в виду, что при $s\in \ov{1,N}$
$$\bigl(M_{\al^o(s)} = \mathbf{L}_{(\La\circ \al^o)(s)}\bigl)\,\&\,\bigl(\bbm_{\al^o(s)} =
\bbl_{(\La\circ \al^o)(s)}\bigl).
$$
Полагаем теперь, что \cite[(5.10), (5.11)]{Cha13`}
\begin{eqnarray}
&\mathbf{\Gamma}\df \sum\limits_{t=\nu+1}^{\nu+N}
\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl) + c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\nu+N}),\mathrm{pr}_1
(\hat{\mathbf{h}}_{\nu+N+1}),\eta^1(\ov{\nu+N+1,\nn})\bigl),
&\label{4.6.4}
\end{eqnarray}
%%
\begin{eqnarray}
&\Omega\df \sum\limits_{t=\nu+N+1}^\nn \bigl[\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl) + c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] -
&\nonumber\\
&- \zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\nu+N}),\mathrm{pr}_1
(\hat{\mathbf{h}}_{\nu+N+1}),\eta^1(\ov{\nu+N+1,\nn})\bigl).
&\label{4.6.5`}
\end{eqnarray}
Тогда, как легко видеть (см. (\ref{4.4.11})), справедливо равенство
$$
\begin{array}{c}
\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\sum\limits_{t=1}^\nu \bigl[\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl) +
\\
+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl]
+\mathbf{\Gamma} + \Omega +f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nn)\bigl)
\end{array}
$$
(учли (\ref{4.6.4}), (\ref{4.6.5`})). Ясно, что в силу (\ref{4.5.32}), (\ref{4.6.3}) и (\ref{4.6.3`}))
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\sum\limits_{t=1}^\nu \bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +\mathbf{\Gamma} +
\Omega + f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl).
&\label{4.6.5``}
\end{eqnarray}
Отметим, что согласно (\ref{4.5.32}) справедливо равенство
$$
\hat{\mathbf{h}}_\nu = \mathbf{h}_\nu.
$$
Как следствие, $\mathrm{pr}_2(\hat{\mathbf{h}}_\nu) = \mathrm{pr}_2(\mathbf{h}_\nu) = x^o = \mathrm{pr}_2(z_o^o).$ Кроме того,
$$
\hat{\mathbf{h}}_{\nu+1} = z_1^o.
$$
Поэтому имеем следующее очевидное равенство
\begin{eqnarray}
&\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nu),\mathrm{pr}_1
(\hat{\mathbf{h}}_{\nu+1}),\eta^1(\ov{\nu+1,\nn})\bigl)= \zc^\natural\bigl(\mathrm{pr}_2(z_o^o),
&\nonumber\\
&\mathrm{pr}_1 (z_1^o),\eta^1(\ov{\nu+1,\nn})\bigl)= \zc^\natural\bigl(x^o,\mathrm{pr}_1(z_1^o),
\eta^1(\ov{\nu+1,\nn})\bigl).
&\label{4.6.5}
\end{eqnarray}
С другой стороны, из (\ref{4.5.32}) получаем  при $t\in\ov{\nu+2,\nu+N},$ что $t-1 \in \ov{\nu+1,(\nu+N)- 1}$ и
$$
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl) = \zc^\natural\bigl(\mathrm{pr}_2(z_{(t-1)-\nu}^o),\mathrm{pr}_1(z_{t-\nu}^o),
\eta^1(\ov{t,\nn})\bigl).
$$
Комбинируя последнее свойство с (\ref{4.6.5}), имеем, что
\begin{eqnarray}
&\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{s-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_s), \eta^1(\ov{s,\nn})\bigl)=
&\nonumber\\
&=\zc^\natural\bigl(\mathrm{pr}_2(z_{(s-1)-\nu}^o),\mathrm{pr}_1(z_{s-\nu}^o),
\eta^1(\ov{s,\nn})\bigl)\ \ \fa s\in \ov{\nu+1,\nu+N}.
\label{4.6.6}
\end{eqnarray}
В свою очередь, из (\ref{4.6.3`}) и (\ref{4.6.6}) вытекает, что при $t\in\ov{\nu+1,\nu+N}$
\begin{eqnarray}
&\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_t), \eta^1(\ov{t,\nn})\bigl)=
\zc^\natural\bigl(\mathrm{pr}_2(z_{(t-1)-\nu}^o),\mathrm{pr}_1(z_{t-\nu}^o),
&\nonumber\\
&(\La \circ \al^o)^1(\ov{t-\nu,N})\,\cup
\la^1(\ov{\nu+N+1,\nn})\bigl)=
\zc^\natural\bigl(\mathrm{pr}_2(z_{(t-1)-\nu}^o),\mathrm{pr}_1(z_{t-\nu}^o),
&\nonumber\\
&\La^1\bigl(\{\al^o(j):\,j\in\ov{t-\nu,N}\})\,\cup
\la^1(\ov{\nu+N+1,\nn})\bigl)=
&\nonumber\\
&=\zc\bigl(\mathrm{pr}_2(z_{(t-1)-\nu}^o),\mathrm{pr}_1(z_{t-\nu}^o),
\{\al^o(j):\,j\in\ov{t-\nu,N}\}\bigl).
&\label{4.6.7}
\end{eqnarray}
Аналогичным образом получаем, что при $t\in \ov{\nu+1,\nu+N}$
\begin{eqnarray}
&c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl) =
c_{(\La\circ \al^o)(t-\nu)}^\natural\bigl(z_{t-\nu}^o,(\La\circ
\al^o)^1(\ov{t-\nu,N})\,\cup\,\la^1(\ov{\nu+N+1,\nn})\bigl) =
&\nonumber\\
&= c_{\La(\al^o(t-\nu))}^\natural\Bigl(
z_{t-\nu}^o,\La^1\bigl(\{\al^o(j):\,j\in\ov{t-\nu,N}\}\bigl)
\cup\,\la^1(\ov{\nu+N+1,\nn})\Bigl) =
&\nonumber\\
&= c_{\al^o(t-\nu)}\bigl(z_{t-\nu}^o,\{\al^o(j):\,j\in\ov{t-\nu,N}\}\bigl),
&\label{4.6.8}
\end{eqnarray}
где $t -\nu\in\ov{1,N}.$ Рассмотрим теперь первую сумму в (\ref{4.6.4}).
Тогда с учетом   (\ref{4.6.7}), (\ref{4.6.8})  получаем, что
\begin{eqnarray}
&\sum\limits_{t=\nu+1}^{\nu+N}\bigl[\zc^\natural\bigl(\mathrm{pr}_2
(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\nn})\bigl) +
c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] =
&\nonumber\\
&=\sum\limits_{t=\nu+1}^{\nu+N}\bigl[\zc\bigl(\mathrm{pr}_2
(z_{(t-1)-\nu}^o),\mathrm{pr}_1(z_{t-\nu}^o),\{\al^o(j):\,j\in\ov{t-\nu,N}\}\bigl) +
&\nonumber\\
&+ c_{\al^o(t-\nu)}\bigl(z_{t-\nu}^o,\{\al^o(j):\,j\in\ov{t-\nu,N}\}\bigl)\bigl] =
&\nonumber\\
&\hspace{-0.3cm}=\sum\limits_{s=1}^N\bigl[\zc\bigl(\mathrm{pr}_2
(z_{s-1}^o),\mathrm{pr}_1(z_s^o),\{\al^o(j):j\in\ov{s,N}\}\bigl) +
&\nonumber\\
&+c_{\al^o(s)}\bigl(z_s^o,\{\al^o(j):j\in\ov{s,N}\}\bigl)\bigl].
&\label{4.6.9}
\end{eqnarray}
Заметим, наконец, что с учетом (\ref{4.5.32})
\begin{eqnarray}
&\zc^\natural\bigl(\mathrm{pr}_2
(\hat{\mathbf{h}}_{\nu+N}),\mathrm{pr}_1(\hat{\mathbf{h}}_{\nu+N+1}),\eta^1(\ov{\nu+N+1,\nn})\bigl)=
&\nonumber\\
&=\zc^\natural\bigl(\mathrm{pr}_2(z_N^o),\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),\la^1(\ov{\nu+N+1,\nn})
\bigl) = f\bigl(\mathrm{pr}_2(z_N^o)\bigl).
&\label{4.6.10}
\end{eqnarray}
В итоге из (\ref{4.6.4}), (\ref{4.6.9}) и  (\ref{4.6.10}) получаем равенство
$$
\begin{array}{c}
\mathbf{\Gamma} = \sum\limits_{s=1}^N\bigl[\zc\bigl(\mathrm{pr}_2(z_{s-1}^o),
\mathrm{pr}_1(z_s^o),\{\al^o(j):
\,j\in\ov{s,N}\}\bigl)+
\\
+c_{\al^o(s)}\bigl(z_s^o,\{\al^o(j):\,j\in\ov{s,N}\}\bigl)\bigl]
+f\bigl(\mathrm{pr}_2(z_N^o)\bigl).
\end{array}
$$
С учетом (\ref{4.2.4}) получаем следующее представление
\bfn\label{4.6.11}
\mathbf{\Gamma}= \mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] =\mathbb{V}=
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] - \kappa.
\efn
Из (\ref{4.6.5``}) и (\ref{4.6.11}) вытекает, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\sum\limits_{t=1}^\nu\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl) + c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+ \mathfrak{B}_\mathbf{e}
[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] + \Om +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) -\kappa.
&\label{4.6.12}
\end{eqnarray}
Учтем теперь (\ref{4.4.72}). Тогда из (\ref{4.6.12}) следует, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\sum\limits_{t=1}^\nu\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
 \la^1(\ov{t,\nn})\bigl) + c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+\sum\limits_{t=\nu+1}^{\nu+N}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+ \zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N}),\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),
\la^1(\ov{\nu+N+1,\nn})\bigl)+ \Om + f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) -\kappa =
&\nonumber\\
&= \sum\limits_{t=1}^{\nu+N}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N}),\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}),
\la^1(\ov{\nu+N+1,\nn})\bigl)+
&\nonumber\\
&+\Om + f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) -\kappa.
&\label{4.6.13}
\end{eqnarray}
 Рассмотрим теперь два возможных варианта представления $\Om$ (\ref{4.6.5`}), имея в виду случаи
 \bfn\label{4.6.14}(\nu+N+1 = \nn)\,\vee\,(\nu+N+ 1< \nn).
 \efn
 По выбору $\nu$ имеем, что один из случаев (\ref{4.6.14}) непременно имеет место.

 $1^o.$ Пусть $\nu+N+1 = \nn.$ Тогда из (\ref{4.6.5`}) вытекает, что
 \begin{eqnarray}
&\Om = \zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\nn-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_\nn),
 \eta^1(\{\nn\})\bigl) + c_{\eta(\nn)}^\natural\bigl(\hat{\mathbf{h}}_\nn,\eta^1(\{\nn\})\bigl)
&\nonumber\\
&- \zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\nn-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_\nn),
 \eta^1(\{\nn\})\bigl)=
 c_{\eta(\nn)}^\natural\bigl(\hat{\mathbf{h}}_\nn,\eta^1(\{\nn\})\bigl).
&\label{4.6.15}
\end{eqnarray}
При этом $\nn\in \ov{0,\nn}\setminus \ov{\nu+1,\nu+N},$ так как $\nu+N < \nn.$ Поэтому
согласно (\ref{4.5.32}) $\hat{\mathbf{h}}_\nn =\mathbf{h}_\nn$ и в силу (\ref{4.6.3})
$\eta(\nn) = \la(\nn).$ Из (\ref{4.6.15}) имеем поэтому, что (при $\nu+N+1 = \nn)$
$$\Om = c_{\la(\nn)}^\natural\bigl(\mathbf{h}_\nn,\la^1(\{\nn\})\bigl),
$$
где учтено, что $\eta^1(\{\nn\}) = \{\eta(\nn)\} = \{\la(\nn)\} = \la^1(\{\nn\}).$ Теперь из
(\ref{4.6.13}) имеем в рассматриваемом сейчас случае, что (см.(\ref{4.4.22}))
$$\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\sum\limits_{t=1}^{\nn-1}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
$$
$$+ \zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nn-1}),\mathrm{pr}_1
(\mathbf{h}_\nn),\la^1(\{\nn\})\bigl)+ c_{\la(\nn)}^\natural\bigl(\mathbf{h}_\nn,\la^1(\{\nn\})\bigl) +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) -\kappa = $$
$$= \sum\limits_{t=1}^{\nn-1}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
$$
$$
+\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nn-1}),\mathrm{pr}_1(\mathbf{h}_\nn),\la^1(\ov{\nn,\nn})
\bigl)+c_{\la(\nn)}^\natural\bigl(\mathbf{h}_\nn,\la^1(\ov{\nn,\nn})\bigl)\bigl] +
$$
$$
+f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) -\kappa =
\sum\limits_{t=1}^\nn\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl)+
$$
$$+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) -\kappa =
\widehat{\mathfrak{C}}_\lambda^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]-\kappa.
$$
Итак, установлена следующая импликация:
\bfn\label{4.6.16}
(\nu+N+1 =\nn)\Longrightarrow \bigl(\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\widehat{\mathfrak{C}}_\la^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]-\kappa\bigl).
\efn

$2^o.$ Пусть теперь выполнено неравенство
\bfn\label{4.6.17}\nu+N+1 < \nn.
\efn
Из (\ref{4.6.17}) вытекает, в частности, что $\nu+N+2 \leqslant \nn.$ Возвращаясь к (\ref{4.6.5`}), отметим, что
\begin{eqnarray}
&\Om = \bigl[\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\nu+N}),\mathrm{pr}_1(\hat{\mathbf{h}}_{\nu+N+1}),
 \eta^1(\ov{\nu+N+1,\nn})\bigl) + c_{\eta(\nu+N+1)}^\natural\bigl(\hat{\mathbf{h}}_{\nu+N+1},
&\nonumber\\
&\eta^1(\ov{\nu+N+1,\nn})\bigl)\bigl] + \sum\limits_{t=\nu+N+2}^\nn\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
 \eta^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+ c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl]-
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\nu+N}),\mathrm{pr}_1(\hat{\mathbf{h}}_{\nu+N+1}),
\eta^1(\ov{\nu+N+1,\nn})\bigl) =
&\nonumber\\
&= \sum\limits_{t=\nu+N+2}^\nn    \zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl) + \sum\limits_{t=\nu+N+1}^\nn c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,
\eta^1(\ov{t,\nn})\bigl) =
&\nonumber\\
%%
&=  \sum\limits_{t=\nu+N+2}^\nn    \zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
 \la^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+\sum\limits_{t=\nu+N+1}^\nn c_{\la(t)}^\natural\bigl(\mathbf{h}_t, \la^1(\ov{t,\nn})\bigl).
&\label{4.6.18}
\end{eqnarray}

Рассмотрим теперь естественную комбинацию (\ref{4.6.13}) и (\ref{4.6.18}):
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
 \sum\limits_{t=1}^{\nu+N}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
 (\mathbf{h}_t), \la^1(\ov{t,\nn})\bigl) + c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{\nu+N}),
\mathrm{pr}_1(\mathbf{h}_{\nu+N+1}), \la^1(\ov{\nu+N+1,\nn})\bigl)+
\sum\limits_{t=\nu+N+2}^\nn\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),
&\nonumber\\
&\mathrm{pr}_1
(\mathbf{h}_t), \la^1(\ov{t,\nn})\bigl) + \sum\limits_{t=\nu+N+1}^\nn
c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)
+f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) - \kappa =
&\nonumber\\
&=\sum\limits_{t=1}^{\nu+N}\bigl[\zc^\natural
(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t), \la^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+c_{\la(t)}^{\natural}\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl]
+\sum\limits_{t=\nu+N+1}^\nn\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+\sum\limits_{t=\nu+N+1}^\nn c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)
+f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) - \kappa  =
&\nonumber\\
&=\sum\limits_{t=1}^\nn \bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl) + c_{\la(t)}^\natural(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl) - \kappa=
&\nonumber\\
&= \widehat{\mathfrak{C}}_\la^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]
 - \kappa.
&\label{4.6.19}
\end{eqnarray}
Итак (см. (\ref{4.6.18}), (\ref{4.6.19})), установлена импликация
\bfn\label{4.6.20}
(\nu+N+1 < \nn)\Longrightarrow \bigl(\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\widehat{\mathfrak{C}}_\la^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]  - \kappa\bigl).
\efn
Из (\ref{4.6.14}), (\ref{4.6.16}) и (\ref{4.6.20}) вытекает, в свою очередь, следующая импликация
\bfn\label{4.6.21}(\nu\neq 0) \Longrightarrow
\bigl(\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\widehat{\mathfrak{C}}_\la^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]  - \kappa\bigl)
\efn
(учитываем, что (\ref{4.6.16}) и (\ref{4.6.19}) установлены при условии $\nu \neq 0).$
Теперь из (\ref{4.5.52}) и (\ref{4.6.21}) получаем весьма важное общее положение.

\begin{theo}\label{t4.6.1}{\TL} Значение $\kappa, \kappa \geqslant 0,$ характеризует изменение
критерия, реализуемое оптимизирующей вставкой, посредством следующего соотношения
$$
\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\widehat{\mathfrak{C}}_\la^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]  - \kappa \leqslant
\widehat{\mathfrak{C}}_\la^\natural[(\mathbf{h}_i)_{i\in\ov{0,\nn}}].
$$
\end{theo}

Подчеркнем, что данная теорема справедлива при любом выборе $\nu\in \ov{0,\nn-(N+1)}.$
В следующем разделе рассмотрим случай $\nu= \nn-N,$ для которого соответствующая вставка
будет конструироваться особым, хотя и более простым способом.

\section{\protect\raggedright
  Финальная оптимизирующая вставка
}
\label{sect:4.7}
\setcounter{equation}{0}

В настоящем разделе рассматривается построение финальной вставки и устанавливается
оценка ее эффективности. Речь идет о ситуации, когда в отличие от построений предыдущих
разделов реализуется случай
\bfn\label{4.7.1}\nu =\nn - N
\efn
(мы отказываемся от (\ref{4.4.60}), но по-прежнему полагаем фиксированным ДР
$$\bigl(\la,(\mathbf{h}_i)_{i\in\ov{0,\nn}}\bigl)\in \mathrm{SOL}
$$
<<большой>> задачи). Заметим, что случай (\ref{4.7.1}) <<укладывается>> в (\ref{4.4.24}),
а потому здесь по прежней схеме (см. раздел~4.4) конструируются склеенные маршруты: мы
можем использовать определение~\ref{o4.4.1}. При этом остаются в силе
предложения~\ref{p4.4.1} и \ref{p4.4.2}, это и будет использовано в дальнейшем. Кроме
того, при условии (\ref{4.7.1}) справедливы предложения~\ref{p4.4.3} и \ref{p4.4.4}.
В связи с предложениями~\ref{4.4.2} и \ref{p4.4.3} заметим, что (в случае (\ref{4.7.1}))
для множества $\mathbf{K}$ (\ref{4.4.26}) выполняется условие (\ref{3.3.23}) и в полной
мере сохраняется (\ref{4.4.30}).

При построении финальной вставки мы следуем правилу (\ref{4.4.58}) выбора базы локальной
задачи. Сохраняем прежними обозначения (\ref{4.4.59}), а также $x^o,\mathbf{M}_1,\ldots,
\mathbf{M}_N,\mathbf{X}$ и $\mathbb{X}.$

Заметим теперь, что в нашем случае $\nn=\nu+N.$ В этой связи определения функций
$$\mathbf{c},c_1,\ldots,c_N,f
$$
изменяются. Так, в пределах настоящего раздела функция
$$\mathbf{c}\in \car_+[\bbx \times \bbx\times \mathfrak{N}]
$$
определяется следующим условием
\bfn\label{4.7.2}\mathbf{c}(z,K) \df \mathbf{c}^\natural\bigl(z,\La^1(K)\bigl)\ \
\fa z\in \bbx\times \bbx\ \ \fa K\in \mathfrak{N}
\efn
(определение $\La$ соответствует разделу~4.4). Аналогичным образом, при $j\in\ov{1,N}$
полагаем, что $$c_j \in \car_+[\bbx\times \bbx\times \mathfrak{N}]
$$
определяется (в настоящем разделе) условиями
\bfn\label{4.7.3}c_j(z,K) \df c_{\La(j)}^\natural\bigl(z,\La^1(K)\bigl)\ \ \fa z\in
\bbx\times \bbx\ \ \fa K\in \mathfrak{N}.
\efn
Наконец, мы полагаем здесь, что
$$f\in \car_+[\bbx]
$$
есть сужение $f^\natural$ на $\bbx,$ то есть
\bfn\label{4.7.4}f(x) \df f^\natural(x)\ \ \fa x\in \bbx.
\efn
Итак, посредством (\ref{4.7.2}) -- (\ref{4.7.4}) определен новый вариант набора (\ref{4.2.1}).
С учетом этого определен аддитивный критерий (\ref{4.2.4}): каждому ДР
$\bigl(\al,(z_i)_{i\in\ov{0,N}}\bigl)\in \widetilde{\mathbf{D}}$ сопоставлено число
(\ref{4.2.4}). В результате мы получаем (новую) экстремальную задачу (\ref{4.2.5}).
Как и прежде, полагаем, что размерность данной локальной задачи умеренна, а потому
используя, например,  вариант процедуры в заключительной части раздела~4.3, мы можем
определить значение (локального) экстремума $\bbv$ и оптимальное ДР
$\bigl(\al^o,(z_i^o)_{i\in\ov{0,N}}\bigl)\in \widetilde{\mathbf{D}}.$

Итак, будем полагать, что найдены маршрут
\bfn\label{4.7.5}\al^o\in \mathbf{A}
\efn
и трасса (траектория)
\bfn\label{4.7.6}(z_i^o)_{i\in\ov{0,N}}\in \mathbf{Z}_{\al^o},
\efn
для которых справедливо равенство
\bfn\label{4.7.7}\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}]= \bbv.
\efn
Теперь, действуя по правилу (\ref{4.5.1}), мы определяем склеенный маршрут $\eta$
глобальной задачи: $\eta\in\ca$ есть маршрут (\ref{4.5.1}), соответствующий (см.
определение~\ref{o4.4.1}) представлению (\ref{4.5.2}), которое в данном случае
(\ref{4.7.1}) сводится к следующему
\bfn\label{4.7.8}\bigl(\eta(t) = \la(t)\ \ \fa t\in\ov{1,\nn-N}\bigl)\,\&\,\bigl(\eta(t) =
(\La \circ \al^o)(t-\nn+N)\ \ \fa t\in \ov{\nn-N+1,\nn}\bigl).
\efn
Далее, вводим новый вариант кортежа (\ref{4.5.31`}); полагаем, что
$(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}\in \widetilde{\mathfrak{Z}}$ в настоящем разделе
имеет (см. (\ref{4.7.1})) следующий вид:
\bfn\label{4.7.9}\bigl(\hat{\mathbf{h}}_t \df \mathbf{h}_t\ \ \fa t\in\ov{0,\nn-N}\bigl)\,
\&\,\bigl(\hat{\mathbf{h}}_t \df z_{t-\nn+N}^o\ \ \fa t\in\ov{\nn-N+1,\nn}\bigl).
\efn

\begin{pred}\label{p4.7.1}{\TL} Посредством $(\ref{4.7.9})$ определена трасса,
согласованная с маршрутом $\eta:$
\bfn\label{4.7.10}(\hat{\mathbf{h}}_t)_{t\in \ov{0,\mathbf{n}}}\in \mathfrak{Z}_\eta.
\efn
\end{pred}

Д о к а з а т е л ь с т в о. В силу (\ref{4.4.23}) $0\in\ov{0,\nn-N},$ а потому
(см. (\ref{4.7.9}))
\bfn\label{4.7.11}\hat{\mathbf{h}}_o = \mathbf{h}_o = (\mathbf{x}_o,\mathbf{x}_o).
\efn
Здесь мы учли (\ref{4.4.17}). Выберем произвольно $\tau\in\ov{1,\nn}.$ Тогда
\bfn\label{4.7.12}(\tau\leqslant \nn-N)\vee (\tau\in \ov{\nn-N+1,\nn}).
\efn
Два случая, упомянутых в (\ref{4.7.12}), рассмотрим отдельно.

1) Пусть $\tau\leqslant \nn-N.$ Тогда имеем, что
\bfn\label{4.7.13}\tau\in \ov{1,\nn-N}.
\efn
Поэтому (см. (\ref{4.7.9})) $\hat{\mathbf{h}}_\tau = \mathbf{h}_\tau.$ С учетом
(\ref{4.4.17}) получаем, что $\hat{\mathbf{h}}_\tau\in \bbl_{\la(\tau)}.$ Из
(\ref{4.7.8}) и (\ref{4.7.13}) вытекает, что
$$\eta(\tau) = \la(\tau),
$$
а потому $\hat{\mathbf{h}}_\tau\in\bbl_{\eta(\tau)}.$ Итак (см. (\ref{4.7.13})),
истинна импликация
\bfn\label{4.7.14}(\tau\leqslant \nn-N) \Longrightarrow (\hat{\mathbf{h}}_\tau\in \bbl_{\eta(\tau)}).
\efn

2) Пусть $\tau\in\ov{\nn-N+1,\nn}.$ Тогда имеем, что $\tau-\nn+N\in\ov{1,N},$ определена
упорядоченная пара
\bfn\label{4.7.15}z_{\tau-\nn+N}^o\in\bbm_{\al^o(\tau-\nn+N)}
\efn
При этом согласно (\ref{4.4.59}) имеем (в терминах $\al^o(\tau-\nn+N)\in\ov{1,N})$
следующее равенство
\bfn\label{4.7.16}\bbm_{\al^o(\tau-\nn+N)} = \bbl_{\La(\al^o(\tau-\nn+N))},
\efn
где $\La\bigl(\al^o(\tau-\nn+N)\bigl) = \la\bigl(\nu + \al^o(\tau-\nn+N)\bigl) =
\la\bigl(\nn-N +\al^o(\tau-\nn+N)\bigl) \in \Gamma.$  С другой стороны, из (\ref{4.7.8})
вытекает, что в рассматриваемом сейчас случае
$$\eta(\tau) = (\La\circ \al^o)(\tau-\nn+N) = \La\bigl(\al^o(\tau-\nn+N)\bigl).
$$
Из (\ref{4.7.16}) следует теперь, что
$$\bbm_{\al^o(\tau-\nn+N)} = \bbl_{\eta(\tau)},
$$
а тогда из (\ref{4.7.15}) вытекает, что
$$z^o_{\tau-\nn+N} \in \bbl_{\eta(\tau)}.
$$
Отметим, что согласно (\ref{4.7.9})
$$\hat{\mathbf{h}}_\tau = z^o_{\tau-\nn+N}.
$$
Поэтому $\hat{\mathbf{h}}_\tau \in\bbl_{\eta(\tau)}$ и при $\tau\in \ov{\nn-N+1,\nn}.$ Итак,
\bfn\label{4.7.17}(\tau\in\ov{\nn-N+1,\nn}) \Longrightarrow (\hat{\mathbf{h}}_\tau\in \bbl_{\eta(\tau)}).
\efn
Из (\ref{4.7.12}), (\ref{4.7.14}) и (\ref{4.7.17}) получаем, что
$\hat{\mathbf{h}}_\tau\in \bbl_{\eta(\tau)}$ во всех возможных случаях.
Коль скоро выбор $\tau$ был произвольным, установлено, что
\bfn\label{4.7.18}\hat{\mathbf{h}}_t\in \bbl_{\eta(t)} \ \ \fa t\in \ov{1,\nn}.
\efn

Получили что кортеж $(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}$ является (см. (\ref{4.4.8}),
(\ref{4.7.11}), (\ref{4.7.18})) трассой, согласованной с $\eta,$ то есть
верно (\ref{4.7.10}).\hfill$\Box$

Итак, $\eta\in\ca$ и $(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}\in \mathfrak{Z}_\eta.$
Поэтому (см. (\ref{4.4.9}))
$$\bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}\bigl)\in \mathrm{SOL}
$$
(в рассматриваемом сейчас случае (\ref{4.7.1})). Мы получили склеенное ДР <<большой>>
задачи. Напомним, что (см. (\ref{4.4.11}))
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\sum\limits_{t=1}^\nn\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl)+
&\nonumber\\
&+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,
\eta^1(\ov{t,\nn})\bigl)\bigl] +f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nn)\bigl)\in [0,\infty[.
\label{4.7.19}
\end{eqnarray}
В связи с данным представлением напомним (\ref{4.4.19}). Для последующего построения
вставки условимся о том, что (в дальнейшем)
\bfn\label{4.7.20}N < \nn,
\efn
ограничиваясь рассмотрением практически интересного случая, когда размер <<окна>>
меньше $\nn$ (мы усилили требование к выбору $N$ в сравнении с (\ref{4.4.23}), но
сделали это, сохраняя в полной мере смысловую сторону конструкций на основе
оптимизирующих вставок). Заметим, что в силу (\ref{4.7.20}) и (\ref{4.7.1})
\bfn\label{4.7.21}\nu = \nn-N \geqslant 1.
\efn
Теперь в отношении (\ref{4.7.19}) отметим, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\sum\limits_{t=1}^{\nn-N}\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl)+ c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+ \sum\limits_{t=\nn-N+1}^\nn\bigl[
c^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl)+
&\nonumber\\
&+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl]
+f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nn)\bigl)
&\label{4.7.22}
\end{eqnarray}
(учитываем (\ref{4.7.21}) и то, что согласно (\ref{4.7.20})
$$2 \leqslant \nn -N + 1 < \nn,
$$
где используется то, что $N \geqslant 2;$ см. (\ref{4.4.23})). Разумеется, из
(\ref{4.7.1}) и (\ref{4.7.22}) имеем, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] = \sum\limits_{t=1}^\nu\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl)+ c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+\sum\limits_{t=\nu+1}^\nn\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl)+
&\nonumber\\
&+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nn)\bigl).
&\label{4.7.23}
\end{eqnarray}
С другой стороны, из (\ref{4.4.19}) вытекает, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\nn}}] = \sum\limits_{t=1}^{\nn-N}\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+\sum\limits_{t=\nn-N+1}^\nn\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)=
&\nonumber\\
&=\sum\limits_{t=1}^\nu\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
&\nonumber\\
&+\sum\limits_{t=\nu+1}^\nn\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl)+
&\nonumber\\
&+c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl).
&\label{4.7.24}
\end{eqnarray}
Напомним теперь предложение~\ref{p4.5.1}. Правда, оно было установлено в предположении о том, что
$\nu \leqslant \nn-(N+1),$ то есть, в частности, при условии $\nu <\nn - N,$ что не соответствует
(\ref{4.7.1}). Тем не менее, и в нашем случае (\ref{4.7.1})
\bfn\label{4.7.25}\eta^1(\ov{t,\nn}) = \la^1(\ov{t,\nn})\ \ \fa t\in \ov{1,\nn-N}.
\efn

\begin{zam}\label{z4.7.1}{\TL} Проверка $(\ref{4.7.25})$ подобна доказательству
предложения~$\ref{p4.5.1}$, но, учитывая $(\ref{4.7.1})$, рассмотрим все же соответствующее
рассуждение, фиксируя $t\in\ov{1,\nn-N}.$ Иными словами, $t\in\ov{1,\nu}.$ Поскольку $\la$ и
$\eta$ --- суть перестановки $\ov{1,\nn}$, имеем, что
$$\la^1(\ov{1,\nn}) = \{\la(s):\,s\in\ov{1,\nn}\} = \ov{1,\nn} = \{\eta(s):\,s\in\ov{1,\nn}\} = \eta^1(\ov{1,\nn})
$$
(имеем аналог $(\ref{4.5.8})$), а потому $(t=1) \Rightarrow \bigl(\la^1(\ov{t,\nn}) =
\eta^1(\ov{t,\nn})\bigl).$ Осталось рассмотреть случай $t\in\ov{2,\nn-N}.$ Иными словами,
пусть $t\in\ov{2,\nu}.$ Тогда в силу $(\ref{4.7.8})$ имеем (см. $(\ref{4.7.1})$), что
$$\eta^1(\ov{1,t-1}) = \la^1(\ov{1,t-1}),$$
$$\eta^1(\ov{1,\nn}) = \eta^1(\ov{1,t-1} \cup\,\ov{t,\nn}) = \eta^1(\ov{1,t-1}) \cup\,\eta^1(\ov{t,\nn}),$$
$$\la^1(\ov{1,\nn}) = \la^1(\ov{1,t-1} \cup\,\ov{t,\nn}) = \la^1(\ov{1,t-1}) \cup\,\la^1(\ov{t,\nn}),$$
$$\eta^1(\ov{1,t-1}) \cap\,\eta^1(\ov{t,\nn}) = \emp,$$
$$\la^1(\ov{1,t-1}) \cap\,\la^1(\ov{t,\nn}) = \emp$$
(учитываем инъективность $\eta$ и $\la).$ Тогда
$$\eta^1(\ov{t,\nn})= \eta^1(\ov{1,\nn})\setminus \eta^1(\ov{1,t-1}) = \la^1(\ov{1,\nn})\setminus
\la^1(\ov{1,t-1})= \la^1(\ov{t,\nn}),
$$
то есть $\la^1(\ov{t,\nn}) = \eta^1(\ov{t,\nn})$ и при $t\in\ov{2,\nn-N}.$ Получили импликацию
$$(t\in\ov{2,\nn-N}) \Longrightarrow \bigl(\la^1(\ov{t,\nn}) = \eta^1(\ov{t,\nn})\bigl).
$$
Поскольку $(t=1)\,\vee\,(t\in\ov{2,\nn-N}),$ имеем во всех возможных случаях равенство
$\la^1(\ov{t,\nn}) = \eta^1(\ov{t,\nn})$, чем и завершается проверка $(\ref{4.7.23})$ в
случае, когда  $\nu$ определяется посредством $(\ref{4.7.1})$. \hfill $\Box$
\end{zam}

Заметим теперь, что согласно (\ref{4.7.8}), (\ref{4.7.9}) и (\ref{4.7.25})
\begin{eqnarray}
&\sum\limits_{t=1}^{\nn-N}\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_t),
\eta^1(\ov{t,\nn})\bigl)+ c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] =
&\nonumber\\
&= \sum\limits_{t=1}^{\nn-N}\bigl[
\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1(\mathbf{h}_t),
\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl].
&\label{4.7.26}
\end{eqnarray}

Напомним, что (см. предложения~\ref{p4.4.2} и \ref{p4.4.4}) $\mathbf{e}\in \mathbf{A}:\,
(\mathbf{e}-\mathrm{sew})[\la;\nu] = (\mathbf{e}-\mathrm{sew})[\la;\nn-N] = \la.$
Будем также использовать (при условии (\ref{4.7.1})) кортеж $(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\in \bbz;$
в рассматриваемом случае
\begin{eqnarray}
&\Bigl(\tilde{\mathbf{h}}_o = (x^o,x^o) = \bigl(\mathrm{pr}_2(\mathbf{h}_\nu),
\mathrm{pr}_2(\mathbf{h}_\nu)\bigl) = \bigl(\mathrm{pr}_2(\mathbf{h}_{\nn-N}),
\mathrm{pr}_2(\mathbf{h}_{\nn-N})\bigl)\Bigl)\,\&
&\nonumber\\
&\&\,(\tilde{\mathbf{h}}_t = \mathbf{h}_{\nu+t} = \mathbf{h}_{t+\nn-N}\ \ \fa t\in \ov{1,N}).
&\label{4.7.27}
\end{eqnarray}
Из (\ref{4.7.27}) вытекает, что подобно предложению~\ref{4.4.5}
\bfn\label{4.7.28}(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\in \mathbf{Z}_\mathbf{e}.
\efn

\begin{zam}\label{z4.7.1}{\TL} Проверим $(\ref{4.7.28})$, имея в виду рассматриваемый
сейчас случай $(\ref{4.7.1}).$ Пусть $\tau\in \ov{1,N}.$ Тогда
$$\nu+\tau = \tau+\nn-N\in \ov{\nn-N+1,\nn}
$$
и при этом справедливо равенство
\bfn\label{4.7.29}\tilde{\mathbf{h}}_\tau = \mathbf{h}_{\nu+\tau} = \mathbf{h}_{\tau+\nn-N};
\efn
при этом $(\La\circ \mathbf{e})(\tau) = \La(\tau) = \la(\nu+\tau) = \la(\tau+\nn-N).$
Однако из $(\ref{4.7.29})$ вытекает, что (см. $(\ref{4.4.18})$)
$$\tilde{\mathbf{h}}_\tau\in\bbl_{\la(\tau+\nn-N)},
$$
то есть $\tilde{\mathbf{h}}_\tau\in\bbl_{\la(\nu+\tau)},$ В итоге
$\tilde{\mathbf{h}}_\tau\in\bbl_{\La(\tau)}$ и согласно $(\ref{4.4.59})$
$$\tilde{\mathbf{h}}_\tau\in\bbm_\tau,
$$
то есть $\tilde{\mathbf{h}}_\tau\in\bbm_{\mathbf{e}(\tau)}.$ Поскольку выбор $\tau$
был произвольным, установлено, что
$$\tilde{\mathbf{h}}_t\in\bbm_{\mathbf{e}(t)}\ \ \fa t\in\ov{1,\nn}.$$
С учетом $(\ref{3.3.15})$ и $(\ref{4.7.27})$ получаем требуемое свойство $(\ref{4.7.28}).$ \hfill $\Box$
\end{zam}

Итак, $\mathbf{e}\in \mathbf{A}$ и $(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\in
\mathbf{Z}_\mathbf{e}.$ Тогда $\bigl(\mathbf{e},(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\bigl)\in
\widetilde{\mathbf{D}}$ (см.  (\ref{3.3.27})). При этом
$\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]\in [0,\infty[$ и согласно (\ref{4.2.6})
\bfn\label{4.7.30}\bbv\leqslant \mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}].
\efn
С учетом (\ref{4.7.7}) и (\ref{4.4.29}) имеем очевидное неравенство
\bfn\label{4.7.31}\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] \leqslant
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}].
\efn
Используя (\ref{4.7.30}) и (\ref{4.7.31}), введем $\kappa$ (\ref{4.4.70}) в
качестве оценки локального выигрыша за счет замены
$$\bigl(\mathbf{e},(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}\bigl) \longrightarrow \bigl(\al^o,
(z_i^o)_{i\in\ov{0,N}}\bigl).
$$
Итак, у нас снова $\kappa \df \mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]-
\bbv \in [0,\infty[$  и при этом
\bfn\label{4.7.32}\mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}] =
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]- \kappa.
\efn
Из (\ref{4.7.22}), (\ref{4.2.6})
%(26?)
вытекает, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}]=
\sum\limits_{t=1}^{\nn-N}\bigl[\zc^\sharp\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl) +c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl]+
&\nonumber\\
&+\sum\limits_{t=\nn-N+1}^\nn\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),
\mathrm{pr}_1(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl] +
f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nn)\bigl).
&\label{4.7.33}
\end{eqnarray}

Выберем произвольно $\theta\in\ov{\nn-N+1,\nn}.$ Тогда возможен один из двух случаев:
\bfn\label{4.7.38}(\theta =\nn-N+1)\,\vee\,(\nn-N+1< \theta).
\efn
Оба случая рассмотрим отдельно.

$1^*)$ Пусть $\theta =\nn-N+1.$ Тогда имеем согласно (\ref{4.4.58}), что
$$\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}) = \mathrm{pr}_2(\hat{\mathbf{h}}_{\nn-N}) =
\mathrm{pr}_2(\mathbf{h}_{\nn-N})= \mathrm{pr}_2(\mathbf{h}_\nu) =x^o.
$$
С другой стороны, из (\ref{3.3.15}), (\ref{4.7.6}) вытекает, что $z_o^o = (x^o,x^o),$ а потому
$$\mathrm{pr}_2(z_o^o) = x^o.
$$
Таким образом, получаем следующее равенство
\bfn\label{4.7.39}\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}) = \mathrm{pr}_2(z_o^o).
\efn
Далее, из (\ref{4.7.9}) вытекает, что
\bfn\label{4.7.40}\mathrm{pr}_1(\hat{\mathbf{h}}_\theta)= \mathrm{pr}_1(\hat{\mathbf{h}}_{\nn-N+1}) =
\mathrm{pr}_1(z_1^o).
\efn
Кроме того, имеем следующее очевидное представление, вытекающее из (\ref{4.7.8}):
$$
\eta^1(\ov{\theta,\nn}) = \eta^1(\ov{\nn-N+1,\nn}) = \{\eta(j):\,j\in\ov{\nn-N+1,\nn}\} =
\{(\La\circ\, \al^o)(j-\nn+N):
$$
$$
\,j\in \ov{\nn-N+1,\nn}\} = \{(\La\circ\, \al^o)(s):\,s\in\ov{1,N}\} = (\La\circ\, \al^o)^1(\ov{1,N}) =
$$
$$
=\La^1\bigl(\{\al^o(s):\,s\in \ov{1,N}\}\bigl).
$$
Тогда (см. (\ref{4.7.2}), (\ref{4.7.39}), (\ref{4.7.40})) получаем, что в нашем случае
\bfn\label{4.7.41}\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_\theta),\eta^1(\ov{\theta,\nn})\bigl) = \zc^\natural\Bigl(\mathrm{pr}_2(z_o^o),
\mathrm{pr}_1(z_1^o),\La^1\bigl(\{\al^o(s):\,s\in\ov{1,N}\}
\bigl)\Bigl).
\efn
Вместе с тем имеем (в рассматриваемом случае)
$$(\theta-\nn + N = 1)\,\&\,\bigl((\theta-\nn + N) - 1 =0\bigl).
$$
Поэтому из (\ref{4.7.1}) следует, в частности, что
$$\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}),\mathrm{pr}_1(\hat{\mathbf{h}}_\theta),
\eta^1(\ov{\theta,\nn})\bigl) =
$$
$$
=\zc\bigl(\mathrm{pr}_2(z_{(\theta-\nn+N)-1}^o),
\mathrm{pr}_1(z_{\theta-\nn+N}^o),\{\al^o(s):\,s\in \ov{\theta-\nn+N,N}\}\bigl).
$$
Итак, истинна импликация
\begin{eqnarray}
&(\theta = \nn-N+1) \Longrightarrow \Bigl(\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_\theta),\eta^1(\ov{\theta,\nn})\bigl) =
&\nonumber\\
&= \zc\bigl(\mathrm{pr}_2(z_{(\theta-1) -(\nn-N)}^o),\mathrm{pr}_1(z_{\theta-(\nn-N)}^o),
&\nonumber\\
&\{\al^o(s):\,s\in \ov{\theta-(\nn-N),N}\}\bigl)\Bigl).
&\label{4.7.42}
\end{eqnarray}

$2^*)$ Рассмотрим случай $\nn-N+1 <\theta$ (иными словами, $\nu+1 <\theta).$ Тогда $\nu+1
\leqslant \theta -1$ и с учетом (\ref{4.7.9}) получаем, что
\bfn\label{4.7.43}\hat{\mathbf{h}}_{\theta-1}= z_{(\theta-1)-\nu}^o = z_{(\theta-1) -\nn+N}^o,
\efn
$$
\hat{\mathbf{h}}_\theta= z_{\theta-\nu}^o = z_{\theta-\nn+N}^o;
$$
из (\ref{4.7.8}) следует также, что
$$
\eta^1(\ov{\theta,\nn}) = \{\eta(s):\,s\in \ov{\theta,\nn}\}= \{(\La\circ\,\al^o)(s-\nn+N):\,
s\in \ov{\theta,\nn}\}=
$$
$$
=\{\La\bigl(\al^o(s-\nn+N)\bigl):\,s\in \ov{\theta,\nn}\}=
\La^1(\{\al^o(s-\nn+N):\,s\in \ov{\theta,\nn}\})=
$$
$$
=\La^1\bigl(\{\al^o(l):\,l\in\ov{\theta-\nn+N,N}\}\bigl).
$$
Тогда получаем следующую цепочку равенств:
$$\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_\theta),\eta^1(\ov{\theta,\nn})\bigl) =
 \zc^\natural\bigl(\mathrm{pr}_2(z_{(\theta-1) -\nu}^o),\mathrm{pr}_1(z_{\theta-\nu}^o),
\eta^1(\ov{\theta,\nn})\bigl)=$$
 $$ =
 \zc^\natural\bigl(\mathrm{pr}_2(z_{(\theta-1) -\nn+N}^o),\mathrm{pr}_1(z_{\theta-\nn+N}^o),
 \La^1\bigl(\{\al^o(l):\,l\in\ov{\theta-\nn+N,N}\})\bigl) =$$
  $$=\zc\bigl(\mathrm{pr}_2(z_{(\theta-1) -\nn+N}^o),\mathrm{pr}_1(z_{\theta-\nn+N}^o),
\{\al^o(l):\,l\in\ov{\theta-\nn+N,N}\}\bigl).
$$
Итак, установлена импликация
\begin{eqnarray}
&(\nn-N+1 < \theta) \Longrightarrow \Bigl(\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}),
\mathrm{pr}_1
(\hat{\mathbf{h}}_\theta),\eta^1(\ov{\theta,\nn})\bigl) =
&\nonumber\\
&=\zc\bigl(\mathrm{pr}_2(z_{(\theta-1) -\nn+N}^o),\mathrm{pr}_1(z_{\theta-\nn+N}^o),
\{\al^o(s):
&\nonumber\\
&\,s\in\ov{\theta-(\nn-N),N}\}\bigl)\Bigl).
&\label{4.7.44}
\end{eqnarray}
С учетом (\ref{4.7.38}), (\ref{4.7.42}) и (\ref{4.7.44}) получаем, что во всех возможных случаях
$$\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{\theta-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_\theta),\eta^1(\ov{\theta,\nn})\bigl) = $$
$$=
\zc\bigl(\mathrm{pr}_2(z_{(\theta-1) -(\nn-N)}^o),\mathrm{pr}_1(z_{\theta-(\nn-N)}^o),
\{\al^o(s):\,s\in\ov{\theta-(\nn-N),N}\}\bigl).
$$
Поскольку выбор $\theta$ был произвольным, установлено, что
\begin{eqnarray}
&\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\nn})\bigl) = \zc\bigl(\mathrm{pr}_2(z_{(t-1) -(\nn-N)}^o),
\mathrm{pr}_1(z_{t-(\nn-N)}^o),
&\nonumber\\
&\{\al^o(s):\,s\in\ov{t-(\nn-N),N}\}\bigl)\ \ \fa t\in \ov{\nn-N+1,\nn}.
&\label{4.7.46}
\end{eqnarray}
Пусть теперь $\xi \in \ov{\nn-N+1,\nn}.$ Рассмотрим представление значения
$$c_{\eta(\xi)}^\natural\bigl(\hat{\mathbf{h}}_\xi,\eta^1(\ov{\xi,\nn})\bigl)\in [0,\infty[.
$$
Тогда в силу (\ref{4.7.9}) имеем равенство
$$\hat{\mathbf{h}}_\xi = z_{\xi-\nn+N}^o.
$$
Кроме того,  из (\ref{4.7.8}) следует, в частности, что
$$\eta(\xi) = (\La\circ\,\al^o)(\xi-\nn+N);
$$
более того, имеем из (\ref{4.7.8}), что
$$\eta^1(\ov{\xi,\nn}) = \{\eta(s):\,s\in \ov{\xi,\nn}\} = \{(\La\circ\,\al^o)(s-\nn+N):\, s\in \ov{\xi,\nn}\} = $$
$$=\La^1\bigl(\{\al^o(s-\nn+N):\,s\in \ov{\xi,\nn}\}\bigl) = \La^1\bigl(\{\al^o(t):\,t\in\ov{\xi-\nn+N,N}\}\bigl).
$$
С учетом трех последних соотношений
\begin{eqnarray}
&c_{\eta(\xi)}^\natural\bigl(\hat{\mathbf{h}}_\xi,\eta^1(\ov{\xi,\nn})\bigl) =
&\nonumber\\
&=c_{(\La\circ\,\al^o)(\xi-\nn+N)}^\natural\Bigl(z_{\xi-\nn+N}^o,\La^1\bigl(\{\al^o(t):
\,t\in\ov{\xi-\nn+N,N}\}\bigl)\Bigl) =
&\nonumber\\
&= c_{\al^o(\xi-\nn+N)} \bigl(z_{\xi-\nn+N}^o,\{\al^o(t):\,t\in \ov{\xi-\nn+N,N}\}\bigl);
&\label{4.7.47}
\end{eqnarray}
мы учли (\ref{4.7.3}) и то, что
$$\xi-\nn+N \in \ov{1,N}.
$$
Поскольку выбор $\xi$ был произвольным, из (\ref{4.7.47}) следует, что
\begin{eqnarray}
&c_{\eta(j)}^\natural\bigl(\hat{\mathbf{h}}_j,\eta^1(\ov{j,\nn})\bigl) =
c_{\al^o(j-\nn+N)} \bigl(z_{j-\nn+N}^o,\{\al^o(t):\,t\in \ov{j-\nn+N,N}\}\bigl)\ \
&\nonumber\\
&\fa j\in \ov{\nn-N+1,\nn}.
\label{4.7.48}
\end{eqnarray}
Заметим теперь, что согласно (\ref{4.7.46}) и (\ref{4.7.48})
\begin{eqnarray}
&\sum\limits_{t=\nn-N+1}^\nn\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_{t-1}),\mathrm{pr}_1
(\hat{\mathbf{h}}_t),\eta^1(\ov{t,\nn})\bigl) + c_{\eta(t)}^\natural\bigl(\hat{\mathbf{h}}_t,\eta^1(\ov{t,\nn})\bigl)\bigl]=
&\nonumber\\
&=\sum\limits_{t=\nn-N+1}^\nn \bigl[\zc\bigl(\mathrm{pr}_2(z_{(t-1) -(\nn-N)}^o),
\mathrm{pr}_1(z_{t-(\nn-N)}^o),\{\al^o(s):\,s\in \ov{t-(\nn-N),N}\}\bigl) +
&\nonumber\\
&+ c_{\al^o(t-\nn+N)}\bigl(z_{t-\nn+N}^o,\{\al^o(s):\,s\in\ov{t-\nn+N,N}\}\bigl)\bigl]=
&\nonumber\\
&\hspace{-0.4cm}= \sum\limits_{j=1}^N\bigl[\zc\bigl(\mathrm{pr}_2(z_{j-1}^o),
\mathrm{pr}_1(z_j^o),\{\al^o(s):\,s\in \ov{j,N}\}\bigl) +
&\nonumber\\
&+c_{\al^o(j)}\bigl(z_j^o,\{\al^o(s):\,s\in \ov{j,N}\}\bigl)\bigl].
&\label{4.7.49}
\end{eqnarray}
Наконец, отметим, что согласно (\ref{4.7.9})
$$
\hat{\mathbf{h}}_\nn = z_N^o\in \mathbb{M}_{\al^o(N)}.
$$
При этом согласно (\ref{4.7.4}) справедливо следующее равенство
\bfn\label{4.7.50}f^\natural\bigl(\mathrm{pr}_2(\hat{\mathbf{h}}_\nn)\bigl) =
f^\natural\bigl(\mathrm{pr}_2(z_N^o)\bigl) = f\bigl(\mathrm{pr}_2(z_N^o)\bigl).
\efn
Из (\ref{4.7.33}), (\ref{4.7.49}) и (\ref{4.7.50}) вытекает, следовательно, что (см. (\ref{4.2.4}))
$$
\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\sum\limits_{t=1}^{\nn-N}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl) + c_{\la(t)}^\natural\bigl(\mathbf{h}_t,
\la^1(\ov{t,\nn})\bigl)\bigl]+
$$
$$+\sum\limits_{t=1}^N \bigl[\zc\bigl(\mathrm{pr}_2(z_{t-1}^o),
\mathrm{pr}_1(z_t^o),\{\al^o(s):\,s\in \ov{t,N}\}\bigl) +
$$
$$
+c_{\al^o(t)}\bigl(z_t^o,\{\al^o(s):\,
s\in \ov{t,N}\}\bigl)\bigl]+ f\bigl(\mathrm{pr}_2(z_N^o)\bigl) =
$$
$$=\sum\limits_{t=1}^{\nn-N}
\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl)+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})
\bigl)\bigl] + \mathfrak{B}_{\al^o}[(z_i^o)_{i\in\ov{0,N}}].
$$
С учетом (\ref{4.7.32}) получаем теперь, что
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta^\natural[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\sum\limits_{t=1}^{\nn-N}\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+ c_{\la(t)}^\natural\bigl(\mathbf{h}_t,\la^1(\ov{t,\nn})\bigl)\bigl]+
\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}]-\kappa.
&\label{4.7.51}
\end{eqnarray}
 Напомним в этой связи, что
\begin{eqnarray}
&\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] =
\sum\limits_{t=1}^N\bigl[\zc\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_{t-1}),\mathrm{pr}_1
(\tilde{\mathbf{h}}_t),\ov{t,N}) + c_t(\tilde{\mathbf{h}}_t,\ov{t,N})\bigl]+
&\nonumber\\
&+f\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_N)\bigl) =
\zc\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_o),\mathrm{pr}_1
(\tilde{\mathbf{h}}_1),\ov{1,N}) +c_1(\tilde{\mathbf{h}}_1,\ov{1,N}) +
&\nonumber\\
&+ \sum\limits_{t=2}^N\bigl[\zc\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_{t-1}),\mathrm{pr}_1
(\tilde{\mathbf{h}}_t),\ov{t,N}\bigl) +
c_t(\tilde{\mathbf{h}}_t,\ov{t,N})\bigl] + f\bigl(\mathrm{pr}_2(\tilde{\mathbf{h}}_N)\bigl)=
&\nonumber\\
&=\zc\bigl(\mathrm{pr}_2(\mathbf{h}_{\nn-N}),\mathrm{pr}_1(\mathbf{h}_{1+\nn-N}),\ov{1,N}\bigl) +
c_1(\mathbf{h}_{1+\nn-N},\ov{1,N}) +
&\nonumber\\
&+\sum\limits_{t=2}^N\bigl[\zc\bigl(\mathrm{pr}_2(\mathbf{h}_{(t-1)+\nn-N}),\mathrm{pr}_1
(\mathbf{h}_{t+\nn-N}),\ov{t,N})\bigl) + c_t(\mathbf{h}_{t+\nn-N},\ov{t,N})\bigl]+
&\nonumber\\
&+f\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)=
\sum\limits_{t=1}^N\bigl[\zc\bigl(\mathrm{pr}_2(\mathbf{h}_{(t-1)+(\nn-N)}),\mathrm{pr}_1
(\mathbf{h}_{t+\nn-N}),\ov{t,N})\bigl) +
&\nonumber\\
&+c_t(\mathbf{h}_{t+\nn-N},\ov{t,N})\bigl]+
f\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)
&\label{4.7.52}
\end{eqnarray}
(мы учитываем равенство $x^o= \mathrm{pr}_2(\mathbf{h}_{\nn-N}),$ вытекающее из (\ref{4.4.58}) и
(\ref{4.7.1})). Теперь учтем (\ref{4.7.2}) -- (\ref{4.7.4}). Тогда из (\ref{4.7.52}) вытекает, что
$$\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] =
\sum\limits_{t=1}^N\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{(t-1)+(\nn-N)}),\mathrm{pr}_1
(\mathbf{h}_{t+\nn-N}),\La^1(\ov{t,N})\bigl) +$$ $$+ c_{\La(t)}^{\natural}\bigl(\mathbf{h}_{t+\nn-N},
\La^1(\ov{t,N})\bigl)\bigl]+ f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl).
$$
С учетом определения $\La$ (см. раздел~4.4) и (\ref{4.7.1}) получаем, что
\begin{eqnarray}
&\mathfrak{B}_\mathbf{e}[(\tilde{\mathbf{h}}_i)_{i\in\ov{0,N}}] =
\sum\limits_{t=1}^N\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{(t-1)+\nn-N}),\mathrm{pr}_1
(\mathbf{h}_{t+\nn-N}),
&\nonumber\\
&\{\la(s+\nn-N):\,s\in\ov{t,N}\}\bigl) + c_{\la(t+\nn-N)}\bigl(\mathbf{h}_{t+\nn-N},\{\la(s+\nn-N):
&\nonumber\\
&\,s\in\ov{t,N}\}\bigl)\bigl]+
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)=
&\nonumber\\
&= \sum\limits_{t=1}^N\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{(t+\nn-N)-1}),\mathrm{pr}_1
(\mathbf{h}_{t+\nn-N}),\{\la(l):\,l\in\ov{t+\nn-N,\nn}\}\bigl)+
&\nonumber\\
&+c_{\la(t+\nn-N)}\bigl(\mathbf{h}_{t+\nn-N},\{\la(l):\,l\in \ov{t+\nn-N,\nn}\}\bigl)\bigl]+
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)=
&\nonumber\\
&= \sum\limits_{t=1}^N\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{(t+\nn-N)-1}),\mathrm{pr}_1
(\mathbf{h}_{t+\nn-N}),\la^1(\ov{t+\nn-N,\nn})\bigl)+
&\nonumber\\
&+c_{\la(t+\nn-N)}\bigl(\mathbf{h}_{t+\nn-N},\la^1(\ov{t+\nn-N,\nn})\bigl)\bigl]+
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)=
&\nonumber\\
&= \sum\limits_{j=\nn-N+1}^\nn\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{j-1}),\mathrm{pr}_1
\mathbf{h}_j),\la^1(\ov{j,\nn})\bigl) +
&\nonumber\\
&+c_{\la(j)}\bigl(\mathbf{h}_j,\la^1(\ov{j,\nn})\bigl)\bigl]+
f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl).
&\label{4.7.53}
\end{eqnarray}
Теперь из (\ref{4.7.51}) и (\ref{4.7.53}) получаем следующую цепочку равенств
\begin{eqnarray}
&\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] =
\sum\limits_{t=1}^\nn\bigl[\zc^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_{t-1}),\mathrm{pr}_1
(\mathbf{h}_t),\la^1(\ov{t,\nn})\bigl) +
&\nonumber\\
&+c_{\la(t)}^\natural\bigl(\mathbf{h}_t,
\la^1(\ov{t,\nn})\bigl)\bigl]+ f^\natural\bigl(\mathrm{pr}_2(\mathbf{h}_\nn)\bigl)- \kappa =
&\nonumber\\
&=\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]-\kappa
&\label{4.7.54}
\end{eqnarray}
(в (\ref{4.7.54}) учтено (\ref{4.4.19})). Итак,   для финальной вставки, определяемой <<началом>>
(\ref{4.7.1}) получен аналог теоремы~\ref{t4.6.1}.

\section{\protect\raggedright
  Итерационные методы с использованием оптимизирующих вставок (общие соображения)
}
\label{sect:4.8}
\setcounter{equation}{-1}

В предыдущих разделах главы подробно рассматривалась конструкция, реализующая локальное улучшение
(точнее, неухудшение) ДР <<большой>> задачи посредством однократного воздействия в виде вставки,
организованной по рецепту раздела~4.3. В случае, когда $\nn$ достаточно велико (исходная задача
имеет большую размерность), такое воздействие, скорее всего, приведет к незначительному выигрышу
в качестве, поскольку число $N$ --- <<длина>> окна ---   выбиралось небольшим с тем, чтобы
использовать вариант ДП раздела~4.3 для непосредственного проведения вычислений. Поэтому имеет
смысл  осуществлять вставки многократно, то есть использовать итерационные режимы с применением
упомянутых оптимизирующих вставок. В этой связи напомним, что в разделе~4.4 предполагалось заданным ДР
\bfn\label{4.8.0}\delta\df \bigl(\la,(\mathbf{h}_i)_{i\in\ov{0,\nn}}\bigl)\in \mathrm{SOL}
\efn
(см. (\ref{4.4.14}), (\ref{4.4.15})), которое после применения вставки было преобразовано в
$$\hat{\delta}\df \bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}\bigl)\in \mathrm{SOL}.
$$
Теорема~\ref{t4.6.1} и  (\ref{4.7.54}) наглядно демонстрируют выигрыш в качестве при замене
\bfn\label{4.8.1}\delta \longrightarrow \hat{\delta}.
\efn
Теперь мы можем вновь осуществить вставку, считая уже $\hat{\delta}$ фиксированным решением
<<большой>> задачи. Иными словами, считая замену (\ref{4.8.1}) сделанной, предполагается снова
реализовать эффект, определяемый в теореме~\ref{t4.6.1} и в (\ref{4.7.54}). Для этого, конечно,
следует разумным образом выбрать начало вставки (индекс $\nu$ в построениях предыдущих разделов
и, возможно, <<длину>> (или размер) окна $N.$ В конкретных реализациях итерационных процедур были
использованы три варианта (см. \cite{Cha18`}):

1) Итерационный метод с комбинацией вставок разной <<длины>> (вставка малого размера используется
для поиска приемлемого <<начала>> $\nu$ основной вставки большего размера);

2) итерации, осуществляемые  по принципу максимизации в <<окне>> количества адресных пар
 <<большой>> задачи;

3) итерации со случайным выбором <<начала>> вставки.

Сейчас обсудим упомянутые варианты на содержательном уровне.

{\bf Итерационный метод с комбинацией вставок разной <<длины>>.} Ограничимся обсуждением этапа,
связанного с реализацией системы вставок малого размера и одной рабочей вставки. Итак, полагаем,
что ДР $\delta$ (\ref{4.8.0}) так или иначе выбрано, то есть мы, как и в разделе~4.4,
имеем маршрут $\la\in\ca$ и согласованную с ним трассу $(\mathbf{h}_i)_{i\in\ov{0,\nn}}\in \mathfrak{Z}_\la.$

В части использования $N\in \bbn,\,N\geqslant 2,$ будем допускать две возможности: $N=N_1$ и $N=N_2,$ где
$$N_1 < N_2.$$
С целью поиска <<момента>> начала основной (рабочей) вставки будем рассматривать серию
всевозможных вставок <<длины>> $N_1$  или, короче, $N_1$-вставок, отвечающих всевозможным значениям
\bfn\label{4.8.2}\nu\in \ov{0,\nn-N_2}.\efn
Каждая из упомянутых $N_1$-вставок реализуется по схеме разделов~4.4.--4.6 с одной существенной оговоркой:
для любого значения $\nu$ (\ref{4.8.2}) при решении соответствующей локальной задачи с $N=N_1$ мы
ограничиваемся поиском экстремума $\bbv$ (\ref{4.3.10}) упомянутой задачи и не занимаемся построением
оптимального решения в виде пары маршрут-трасса.

При этом, конечно, упомянутый экстремум $\bbv$ зависит от $\nu,$ то есть на самом деле $\bbv = \bbv(\nu),$
где $\nu$ удовлетворяет (\ref{4.8.2}). Как следствие, используемая в теореме~\ref{t4.6.1} и в (\ref{4.7.54})
оценочная константа $\kappa$ также зависит от $\nu,$ то есть $\kappa = \kappa_1(\nu);$ при этом $\kappa_1(\nu)$
однозначно определяется значением $\bbv(\nu)$ соответствующей локальной задачи.

Таким образом, мы в режиме $N_1$-вставок реализуем теперь уже зависимость
$$\tilde{\nu}\longmapsto \kappa_1(\tilde{\nu}):\,\ov{0,\nn-N_2}\longrightarrow [0,\infty[,
$$
которую предлагается максимизировать с целью определения точки $\nu,$ наиболее чувствительной (по нашим
представлениям) к действию рабочей $N_2$-вставки (вставки при $N=N_2).$ Итак, решаем задачу
\bfn\label{4.8.3}\kappa_1(\tilde{\nu}) \longrightarrow \max,\ \ \tilde{\nu}\in\ov{0,\nn-N_2}.
\efn
Выбираем индекс $\nu$ (\ref{4.8.2}) в виде точки максимума задачи (\ref{4.8.3}) и фиксируем в качестве
<<начала>> рабочей $N_2$-вставки, действие которой нам представляется достаточно ощутимым.
Итак, более трудоемкая $N_2$-вставка реализуется в <<точке>>, выбранной в виде точки максимума
задачи (\ref{4.8.3}). Далее реализуется замена (\ref{4.8.1}), осуществляемая по рецептам
разделов~4.4--4.7 при $N=N_2;$ мы получаем новое ДР $\hat{\delta}$ большой задачи, в терминах
которого снова реализуем $N_1$-вставки с целью последующего решения задачи, подобной (\ref{4.8.3}),
и выбора <<начала>> $N_2$-вставки.

{\bf Итерации, осуществляемые по принципу максимизации (в <<окне>>) количества адресных пар
<<большой>> задачи.}  Известно \cite[\S\,4.9]{Cha1`}, что условия предшествования могут использоваться
<<в положительном направлении>> (см. также \cite[гл.~4]{Cha2`}) в смысле снижения вычислительной сложности:
в условиях рациональной организации вычислительного процесса при большем количестве адресных пар
достигается соответствующий положительный эффект. В этой связи А.А. Ченцовым был предложен подход
к организации итерационной процедуры, в рамках которого предлагается выбирать <<окно>> вставки по
принципу максимизации количества адресных пар из $\mathfrak{K},$ полностью <<укладывающихся>> (и в
смысле отправителя, и в смысле получателя) в упомянутое <<окно>>.


Возвращаясь к (\ref{4.8.0}), имеем (см. (\ref{4.4.25})), что множество $Q$ зависит от $\nu,$ то
есть $Q = Q(\nu).$ Поэтому мы можем рассматривать зависимость
\bfn\label{4.8.4}\tilde{\nu}\longmapsto |Q(\tilde{\nu})|:\,\ov{0,\nn-N} \longrightarrow \bbn_o
\efn
(здесь мы учитываем, конечно, что $N_1 = N_2 =N,$ а <<окно>> может быть размещено в любой точке
из $\ov{0,\nn-N}).$ Располагая зависимостью (\ref{4.8.4}), легко воспроизводимой по $\delta$
(\ref{4.8.0}), решаем задачу
\bfn\label{4.8.5}|Q(\tilde{\nu})| \longrightarrow \max,\ \ \tilde{\nu}\in \ov{0,\nn-N}.
\efn
В качестве $\nu$ в (\ref{4.4.23}) выбираем точку максимума задачи (\ref{4.8.5}), полагая, что
большое число условий предшествования позволит (см. раздел~4.3) более эффективно осуществить
локальную оптимизацию в смысле построения $\hat{\delta}$ по рецептам раздела~4.3.

{\bf Итерации со случайным выбором <<начала>> вставки.} Предполагается, что выбор $\nu$ (\ref{4.8.2})
осуществляется случайно; в настоящем варианте использовалось  равномерное распределение.
Итак, располагая ДР $\delta$ (\ref{4.8.0}), осуществляем случайное испытание по выбору $\nu$
(возможный вариант --- использовать не весь <<промежуток>> $\ov{0,\nn-N},$ а какое-то его п/м),
после чего оптимизирующая вставка конструируется по рецептам разделов~4.5--4.7, в результате
чего получаем ДР $\hat{\delta},$ которое принимается за новое эвристическое решение <<большой>>
задачи, после чего следует новое случайное испытание для <<начала>> новой вставки.

















\chapter{
  АЛГОРИТМЫ РЕШЕНИЯ ЗАДАЧ МАРШРУТИЗАЦИИ С~ОГРАНИЧЕНИЯМИ
}
%\setcounter{section}{1}\setcounter{subsection}{1}
\setcounter{chapter}{5}
\setcounter{equation}{0}



\section{
  Введение
}
\label{sect:5.1}

В данной главе рассматриваются точные и эвристические алгоритмы решения задач
маршрутизации с ограничениями, а также различные комбинации таких алгоритмов.

Сначала приводятся точные алгоритмы на основе ДП, позволяющие получать
оптимальный результат. Размерность решаемых задач ограничена несколькими десятками
контуров, что, в принципе, соответствует некоторым типам раскроя. Проблема с
размерностью заключается в том, что данный алгоритм имеет экспоненциальный
рост времени счета и размера требуемой оперативной памяти.
Кроме того, в задачах оптимизации движения режущего инструмента важную роль
играет точное соблюдение всех ограничений;

Важный момент, который следует отметить особо, состоит в том,
что время счета и память сильно зависят от количества вложенных контуров, приводящих
к условиям предшествования. Здесь речь идет о деталях с внутренними отверстиями
и областями, и о других, меньших делалях, размещенных внутри этих областей.
В случае простых деталей, не имеющих врутренних вырезаемых областей или
отверстий, размерность решаемой задачи снижается, как показывает вычислительный
эксперимент, на несколько контуров за счет снижения количества условий
предшествования.

Принципиально иной подход к решению рассматриваемых задач состоит в применении
эвристических алгоритмов. Данные алгоритмы строятся на основе эмпирических
правил и не подтверждаются оценками. Следовательно, говорить об оптимальности
здесь невозможно. Более того, нельзя сказать, насколько тот или иной результат
отличается от оптимального значения. Можно лишь производить сравнение с результатами
для точных алгоритмов на примерах задач, имеющих сравнительно малую размерность.
Конечно, результаты работы эвристических алгоримов на примерах <<малых>>
задач могут сильно отличаться от аналогичных результатов на <<больших>> примерах
(сотни и тысячи контуров). Следовательно, упомянутое сравнение может дать лишь
общее представление о работе того или иного эвристического алгоритма.
Сильной стороной эвристических алгоритмов является их высокая производительность
и, во многих случаях, полиномиальная зависимость времени счета и объема
требуемой памяти от размерности задачи. Кроме того, эвристические алгоритмы
позволяют в полной мере учитывать детально проработанные тепловые и геометрические
ограничения.

Третий подход к решению задач реализации раскроя состоит в использовании
вставок на основе ДП. Сначала производятся вычисления
с использованием эвристического алгоритма, после чего участки маршрута
реорганизуются с использованием ДП (данные вставки охватывают участки маршрута
с размером, приемлемым для ДП). Такой подход уже не может претендовать на
оптимальность, точных оценок здесь также нет, что автоматически причисляет
его к разряду эвристических. Основная идея состоит в том, что мы применяем
к участкам маршрута и трассы гарантированно неухудшающие преобразования.
Здесь опять возникают проблемы, присущие методу ДП, --- малая размерность
вставок и большое время счета.

Для учета тепловых и геометрических ограничений могут быть применены
два подхода (в обоих используется зависимость от списка вырезанных к данному
моменту контуров). В первом реализуется дополнительное жесткое ограничение,
запрещающее перемещение на тот или иной контур, не согласующийся с тепловыми
или геометрическими ограничениями. Во втором подходе такое перемещение разрешено,
но к функции стоимости перемещения добавляется дополнительный штраф (большое
число). В настоящей монографии используется второй подход.
Рассматриваемая в предыдущих главах схема решения на основе ДП
допускает применение функций стоимости такого типа и вполне реализуема для
задач малой размерности. При решении же практических задач, связанных с
листовой резкой и имеющих ощутимую размерность, серьезную проблему
представляет само построение функций стоимости с упомянутой особенностью
(фактическая размерность резко возрастает при учете зависимости от списков
заданий). В настоящей главе приведен эффективный эвристический алгоритм, не
предусматривающий априорного построения упомянутых усложненных функций
стоимости и реализующий построение их фрагментов по мере развития процесса.
Данный алгоритм пригоден для решения маршрутных задач с ограничениями
различных типов, имеющих достаточно большую размерность.

Все вычисления производились на ПЭВМ с процессором Intel i7-2630QM с 8Гб
оперативной памяти, работающей под управлением Windows 7 (64-bit). Для
разработки программы была использована среда Microsoft Visual C++ 2013.

\section{\protect\raggedright
  Задача маршрутизации перемещений (частная постановка)
}
\label{sect:5.2}
\setcounter{equation}{0}

В настоящем разделе мы следуем конструкциям главы~3 и рассматриваем далеко не самый
общий случай постановки, ориентированной на применение  в задаче маршрутизации
движения инструмента при листовой резке на машинах с ЧПУ. Содержательное обсуждение
задачи приведено в главе~3 и в первой части монографии. Сейчас мы остановимся только
на одном моменте, связанном с ограничениями, придерживаясь содержательного способа
изложения.

Мы полагаем (как и в главе~3) заданными мегаполисы $M_1,\ldots,M_N,$ которые в
нашей конкретной задаче являются непустыми конечными множествами на плоскости,
располагающимися на некоторых <<вторичных>> эквидистантах. Имеются  отношения
$\bbm_1,\ldots,\bbm_N;$ при этом $\bbm_j\subset M_j\times M_j.$ Элементами
$\bbm_j,$ где $j\in \ov{1,N},$ являются упорядоченные пары $(x,y),$ где $x$ ---
возможная точка врезки, а $y$ --- точка выключения инструмента; разумеется, $x$
и $y$ --- суть плоские векторы. В этой связи отметим, что в качестве объемлющего
множества $X$ далее используется плоскость:
$$X = \bbr\times \bbr$$
(в качестве $X$ может использоваться также достаточно большой прямоугольник на
плоскости). Сохраняем определения множеств $\mathbf{M}_1,\ldots,\mathbf{M}_N,
\bbx$ и $\mathbf{X},$ которые были введены в главе~3. В настоящем разделе
предполагаем заданными операторы (\ref{3.3.9}); каждый из этих операторов
сопоставляет точке множества $\mathbf{X}$ непустое конечное множество на
плоскости, причем, как уже отмечалось в главе~3 (см. замечание после
(\ref{3.3.11})) в определении $A_1,\ldots,A_N$ допускается определенная
избыточность; существенная <<часть>> данных определений реализована (для
одного из возможных вариантов) в замечании~\ref{z3.3.2}.

В непосредственных расчетах использовался несколько иной вариант определения
$A_1,\ldots,A_N$ (ограничиваемся определением значений, существенных для
рассматриваемой маршрутной задачи).
Пусть
$$\rho:\,X\times X \longrightarrow [0,\infty[$$
есть обычная евклидова метрика на $X;$ при $x_1\in X$ и $x_2\in X$ число
$$\rho(x_1,x_2)\in [0,\infty[$$
определяет, следовательно, евклидово   расстояние между плоскими векторами
$x_1$ и $x_2.$ Рассмотрим нужный вариант, фиксируя $j\in\ov{1,N}$ и полагая
(это достаточно для всех наших целей), что $x\in \mathbf{X}\setminus
\mathbf{M}_j.$ По самому смыслу оператора $A_j$ (\ref{3.3.9}) имеем, что
множество $A_j(x)$ исчерпывает возможности выбора новой точки врезки при
условии перемещения в мегаполис из состояния $x,$ которое не принадлежит
$\mathbf{M}_j:$ мы имеем возможность выбирать только векторы $y\in A_j(x).$
Одно из соображений, определяющих упомянутое ограничение, может состоять в
том, чтобы новая точка врезки выбиралась в отдалении от предыдущей. Здесь,
конечно, надо иметь в виду, что реально у нас либо $x=x^o,$ либо $x$ является
точкой выключения инструмента и может не совпадать с предыдущей точкой врезки.
Однако в рассматриваемой задаче <<парные>> точка врезки и точка выключения
(инструмента) близки, а потому можно считать, что предыдущая точка врезки
находится вблизи $x$ и, удаляясь от $x,$ мы удаляемся и от упомянутой предыдущей
точки врезки.

Будем полагать заданным некоторое число $\mathbf{r}_j(x)\in [0,\infty[$
(пороговый уровень) и весовой коэффициент $\xi_j(x) \in ]0,1];$ введем
значение
$$d_j(x) \df \max\limits_{h\in \bbm_j}\rho\bigl(x,\mathrm{pr}_1(h)\bigl);$$
в нашем случае $d_j(x) > 0.$ Определяем множество $A_j(x)$ следующими тремя
выражениями:
$$\bigl(d_j(x) < \mathbf{r}_j(x)\bigl)\Longrightarrow \Bigl(A_j(x) \df
\bigl\{\mathrm{pr}_1(y):\,y\in \bbm_j,\ \xi_j(x) d_j(x) \leqslant \rho
\bigl(x,\mathrm{pr}_1(y)\bigl)\bigl\}\Bigl),
$$
$$\biggl(\Bigl(\min\limits_{h\in \bbm_j}\rho\bigl(x,\mathrm{pr}_1(h)\bigl)
\leqslant \mathbf{r}_j(x)\Bigl)\,\&\,\bigl(\mathbf{r}_j(x)\leqslant d_j(x)
\bigl)\biggl) \Longrightarrow $$ $$\Longrightarrow\Bigl(A_j(x) \df \bigl
\{\mathrm{pr}_1(z):\,z\in \bbm_j,\ \mathbf{r}_j(x) \leqslant \rho\bigl(x,
\mathrm{pr}_1(z)\bigl)\bigl\}\Bigl),
$$
$$\Bigl(\mathbf{r}_j(x) < \min\limits_{h\in\bbm_j}\rho\bigl(x,
\mathrm{pr}_1(h)\bigl)\Bigl)\Longrightarrow \bigl(A_j(x) \df
\{\mathrm{pr}_1(h):\,h\in \bbm_j\}\bigl).
$$
В первом из соотношений говорится о <<хоть каком-то>> уклонении от предыдущей
точки врезки (число $\xi_j(x)$ логично выбирать близким к 1); речь идет об
обработке <<плохих>>  в упомянутом смысле случаев. Второе соотношение
характеризует пороговое разделение множества новых точек врезки на два
подмножества, одно из которых и трактуется как $A_j(x).$ Наконец, третье
соотношение отвечает <<хорошему>> в смысле упомянутой удаленности случаю,
когда любые точки врезки нового мегаполиса доступны для перемещения.

Заметим, что упомянутое <<тройственное>> определение обеспечивает условие
$A_j(x) \neq \emp,$ хотя при $d_j(x) < \mathbf{r}_j(x)$ за это условие
приходится <<расплачиваться>> качеством реализации порогового уровня
$\mathbf{r}_j(x);$ по сути дела мы действуем в случае упомянутого строгого
неравенства по остаточному принципу. Тем не менее определенные меры в части
осуществления удаленности новой точки врезки от предыдущей удается реализовать
и обеспечить тем самым постановку задачи (\ref{3.3.31}) в ее конкретном варианте.

При построении алгоритма использовались соглашения:
$$\bigl(\mathbf{r}_j(x) = \mathbf{r}\ \ \fa j\in \ov{1,N}\ \ \fa x\in
\mathbf{X}\setminus \mathbf{M}_j\bigl)\,\&\,\bigl(\xi_j(x) = \xi\ \ \fa
j\in \ov{1,N}\ \ \fa x\in \mathbf{X}\setminus \mathbf{M}_j\bigl)
$$
(напомним, что при доопределении вышеупомянутых <<тройственных>> правил до
отображений на всем множестве $\mathbf{X}$ использовались соображения, подобные
изложенным в разделе~3.3 после соотношения (\ref{3.3.11})); здесь $\mathbf{r}>0$
и $1 \geqslant\xi >0.$

Рассматриваемые в книге примеры связаны с машинами резки металла на станках с ЧПУ.
Функции стоимости представляют из себя не расстояния, а времена движения инструмента.
Все перемещения осуществляются либо на скорости холостого хода $V_i,V_i>0$,
либо на скорости реза
$V_c, V_c > 0$.
Скорость холостого хода превышает скорость
реза в десятки и сотни раз. В примерах $V_i=500$ мм/с, а $V_c=10$ мм/с.
Движение предполагается безинерционным.
Точка $x^0$ задается в виде начала координат: $x^0=(0,0)$.
Для $x_1\in \mathbf{X}$ и $x_2\in \mathbb{X}$ полагаем
\begin{equation}\label{ExtPrice}
\mathbf{c}(x_1,x_2)=\frac{\rho (x_1,x_2)}{V_i}.
\end{equation}

Функции стоимости внутренних работ вычисляются с учетом скорости реза.
Именно, для $i\in \overline{1,N}$, $z\in \mathbb{M}_i$
$$
c_i(z)=\frac{\rho(\mbox{pr}_1(z),u(z))+\rho(u(z),\mbox{pr}_2(z))}{V_c},
$$
где вектор $u(z)$ находится на эквидистанте и сопоставляется $z$ однозначно.
Функция $f$ также определяется временем движения в финишную точку.
\begin{equation}\label{TerminalPrice}
f(x)=\frac{\rho (x,x^0)}{V_i}.
\end{equation}
%^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

%*******************************************************************************
В примере рассматривался случай $N=29$ и $|\mathbf{K}| =30$. Использовалось
<<тройственное>> определение операторов $A_1,\ldots,A_N$ при следующей
конкретизации параметров:
$$
\mathbf{r}=100,\ \xi=0,75.
$$
Точное описание мегаполисов не приводится по соображениям объема; отметим
только, что мощности $|M_i|, i\in \overline{1,29}$, имеют значение от 3 до 30.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{route_29_DP_AD.png}
  \caption{Траектория, построенная на основе ДП}
  \label{DP_Result}
  \end{center}
\end{figure}

Результат счета 100,61, время счета 13 мин. 13 сек. Маршрут и трасса показаны
на рис. \ref{DP_Result}.

\section{\protect\raggedright
  Итерационный режим с комбинированием оптимизирующих вставок разной <<длины>>
}
\label{sect:5.3}
\setcounter{equation}{0}

Начиная с настоящего раздела мы рассматриваем конструкции решения задачи
(\ref{4.4.13}) с использованием оптимизирующих вставок. Основное внимание
здесь и далее уделяется итерационным алгоритмам на основе подходов,
сформулированных в заключении предыдущей главы. Будем придерживаться
обозначений раздела~4.4 в части описания элементов <<большой>> задачи
(см. (\ref{4.4.13})), а, в части описания локальных задач, --- обозначений
раздела~4.3. Итак, схема ДП раздела~4.3 используется при построении
оптимизирующих вставок, направленных на обеспечение   локального улучшения
ДР <<большой>> задачи. Последняя рассматривалась на уровне построения
алгоритмов и программ в реализации, ориентированной на применение для
целей маршрутизации движения инструмента при листовой резке на станках
с ЧПУ.

Сначала совсем кратко напомним итерационную процедуру, в рамках которой
предполагалось сочетание оптимизирующих вставок разной <<длины>>. Как и
в разделе~4.4, полагаем, что $\nn\in \bbn$ определяет количество мегаполисов
<<большой>> задачи; значение $\nn$ полагается достаточно большим, а потому
непосредственное применение ДП (см. раздел~4.3) для целей <<глобальной>>
оптимизации практически невозможно. Пусть, однако, задано число
$N\in \bbn,$ определяющее размер или <<длину>> вставки; при этом
в последующих конструкциях полагается, что при данном значении $N$ в
локальной задаче маршрутизации, возникающей при построении вставки,
процедура на основе ДП уже позволяет осуществить вычисления, приводящие
к построению оптимального локального решения (имеется в виду вариант
задачи (\ref{4.3.3})) и нахождению значения (\ref{4.3.5}), то есть
экстремума локальной задачи.

Некоторую проблему составляет выбор начала вставки, которое в разделе~4.4
было обозначено через $\nu$ (см. (\ref{4.4.24})). Конечно, данный параметр
можно выбрать как угодно, соблюдая (\ref{4.4.24}); при этом, как показано в
главе~4, значение критерия <<большой>> задачи не ухудшится. Однако желательно
устраивать вставку там, где она обеспечит реальное улучшение совокупного
критерия; таким образом, <<момент>> начала вставки надо искать, исходя из
соображений, связанных с улучшением критерия. В конце главы~4 были намечены
некоторые подходы к выбору параметра $\nu.$ Все эти подходы связывались с
организацией той или иной итерационной процедуры. Мы начнем сейчас с
рассмотрения того варианта данной процедуры, когда для поиска $\nu$
привлекается система вставок меньшего размера. Последнее существенно, так
как на каждом этапе основной итерационной процедуры  приходится (в рамках
данного подхода) проигрывать реализацию поисковых вставок многократно.
Цель этих построений, как  уже отмечалось в главе~4, состоит в определении
такого значения $\nu,$ для которого исходное эвристическое ДР было бы
наиболее <<податливо>> к улучшению. Последнее же предлагается осуществлять
с помощью вставки большего размера (большей <<длины>>). Итак, мы рассматриваем
вставки разной <<длины>>, придавая значению $N$ одно из двух значений
$$(N = N_1) \vee (N=N_2),
$$
где $2 \leqslant N_1 < N_2 <\nn.$ Соответственно у нас на каждом этапе
возникают (зондирующие) $N_1$-вставки и одна рабочая $N_2$-вставка.

При этом, как уже отмечалось в заключительной части главы~4, значение
$N_1$ подбирается таким, чтобы было возможно <<прорешать>> все локальные
маршрутные задачи в диапазоне $\ov{0,\nn-N_2}.$ Правда при решении упомянутых
локальных задач не требуется находить оптимальные маршрут и трассу; требуется
только <<быстро>> определять экстремумы; в настоящем варианте для этого
использовалось ДП в духе процедуры (\ref{4.3.13}), финалом которой является
определение экстремума локальной маршрутной задачи.

%*******************************************************************************
В примере рассматривался случай $\mathbf{n}=75$ и $|\mathbf{K}|=37$. Размеры вставок
были выбраны следующими: $N_1=12$, $N_2=24$.
Функции стоимости выбраны такими же, как в предыдущем примере (из раздела
5.2). Количество итераций равнялось
15. Начальный вариант посчитан с использованием эвристического итерационного
алгоритма, значение полученного критерия равно 250,79. Результат, достигнутый
после применения вставок ДП равен 249,3. Общее время счета составляет 17
мин. 3 сек. Маршрут и трасса показаны на рис. \ref{DP_Inserts_Result}.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{routing_75_checking_ins.png}
  \caption{
    Траектория, полученная с использованием эвристического алгоритма
    с~улучшающими вставками ДП
    }
  \label{DP_Inserts_Result}
  \end{center}
\end{figure}

\section{\protect\raggedright
  Итерационный режим с элементами оптимизации локальных условий
  прешествования
}
\label{sect:5.4}
\setcounter{equation}{0}

В настоящем разделе обсудим вариант итерационной процедуры раздела~4.8,
предложенный А.А.Ченцовым и связанный с использованием задачи (\ref{4.8.5}).
Мы сохраняем символику главы~4 как в части описания <<большой>> задачи, так
и в части описания локальных задач типа (\ref{4.2.5}). Как уже отмечалось
в разделе~4.8, данный вариант ориентирован на построение оптимизирующих вставок,
в которых количество адресных пар должно быть достаточно большим; это позволяет
в определенной степени снижать сложность вычислений по методу ДП.

Введем в рассмотрение множество
\bfn\label{5.4.1}\bbd \df \bigl\{\bigl(\al,(z_i)_{i\in\ov{0,\nn}})\in \ca
\times \mathfrak{Z}|\,(z_i)_{i\in\ov{0,\nn}}\in \mathfrak{Z}_\al\bigl\}
\efn
всех ДР <<большой>> задачи, после чего на множестве
$$\bbd \times \ov{0,\mathbf{k}},
$$
где $\mathbf{k}\in \bbn,\,\mathbf{k}\leqslant \nn-N,$ фиксировано,
определим многозначное  отображение
\bfn\label{5.4.2}\Phi:\,\bbd\times \ov{0,\mathbf{k}}\longrightarrow
\cp^\prime(\ov{0,\mathbf{k}}).
\efn
Отображение (\ref{5.4.2}) может, в принципе, определяться по разному, но
мы пока зафиксируем какой-либо вариант $\Phi$ с тем, чтобы изложить логику
возникающей итерационной процедуры, после чего конкретизируем $\Phi$
(\ref{5.4.2}).

Итак, пусть сейчас $\Phi$ --- любое многозначное отображение (мультифункция)
(\ref{5.4.2}). Допустим, что тем или иным способом мы смогли определить
некоторое начальное ДР
\bfn\label{5.4.3}
(\la_o,h_o)\in \bbd
\efn
(для построения данного ДР может использоваться тот или иной эвристический
(в частности, жадный) алгоритм); выберем, кроме того, $\nu_o\in \ov{0,\mathbf{k}}.$
В результате реализуется (непустое) множество
$$\Phi(\la_o,h_o,\nu_o) = \Phi\bigl((\la_o,h_o),\nu_o\bigl)\in
\cp^\prime(\ov{0,\mathbf{k}}),
$$
после чего  осуществляется выбор индекса
\bfn\label{5.4.3`}\nu_1\in \Phi(\la_o,h_o,\nu_o),
\efn
определяющего конкретное начало вставки. Заметим, что в (\ref{5.4.3`}) может
использоваться то или иное оговоренное заранее правило выбора. Так, например,
мы можем действовать по правилу: в качестве $\nu_1$ выбираем наименьший (наибольший)
элемент множества $\Phi(\la_o,h_o,\nu_o).$ После того, как выбор (\ref{5.4.3`})
осуществлен, используем процедуру, изложенную в разделах~4.4--4.7, при условиях
\bfn\label{5.4.4}\la = \la_o, (\mathbf{h}_i)_{i\in\ov{0,\nn}}= h_o, \nu = \nu_1
\efn
((\ref{4.4.13}), (\ref{4.4.14}) и (\ref{4.4.24}) применяем в условиях (\ref{5.4.4})).
После реализации процедуры разделов~4.4--4.7 (при условиях (\ref{5.4.4})) получаем
новое ДР
\bfn\label{5.4.5}\bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}\bigl)\in \bbd
\efn
<<большой>> задачи, которое мы принимаем за $(\la_1,h_1);$ итак, полагаем
\bfn\label{5.4.6}\la_1 = \eta,\,h_1 = (\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}},
\efn
что соответствует построениям разделов~4.5-- 4.7. Напомним, что при этом (см.
(\ref{4.7.49}) и теорему~\ref{t4.6.1})
$$
\widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] \leqslant
\widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\nn}}],
$$
что при наших условиях (\ref{5.4.6}) приводит к неравенству
\bfn\label{5.4.7}\widehat{\mathfrak{C}}_{\la_1}[h_1] \leqslant
\widehat{\mathfrak{C}}_{\la_o}[h_o]
\efn
(конкретная степень <<улучшения>> значений критерия указана в (\ref{4.7.49})
и теореме~\ref{t4.6.1}). Теперь мы получаем множество
$$\Phi(\la_1,h_1,\nu_1) \in \cp^\prime(\ov{0,\mathbf{k}}).
$$
Поскольку, в частности, $\Phi(\la_1,h_1,\nu_1)\neq \emp,$ осуществляем выбор
\bfn\label{5.4.8}\nu_2\in \Phi(\la_1,h_1,\nu_1),
\efn
используя то или иное правило (см. обсуждение после (\ref{5.4.3`})). Теперь
применяем процедуру, изложенную в разделах~4.4--4.7 при условиях, что
$$\la =\la_1,(\mathbf{h}_i)_{i\in\ov{0,\nn}}= h_1, \nu= \nu_2,
$$
получая в результате новый вариант ДР (\ref{5.4.5}) <<большой>> задачи,
обозначаемый сейчас через $(\la_2,h_2),$ что соответствует конкретизации
\bfn\label{5.4.9}
\eta = \la_2,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}= h_2.
\efn
Итак, $(\la_2,h_2)$ получается в виде ДР, улучшающего $(\la_1,h_1):$
\bfn\label{5.4.10}
\widehat{\mathfrak{C}}_{\la_2}[h_2] \leqslant
\widehat{\mathfrak{C}}_{\la_1}[h_1].
\efn
Далее процесс повторяется заданное (или  выбираемое по мере реализации
алгоритма) число раз; обозначая данное число через $\mathbf{r},$ мы можем
говорить о кортеже
$$
s \longmapsto (\la_s,h_s):\,\ov{1,\mathbf{r}}\longrightarrow \bbd
$$
ДР <<большой>> задачи, получаемом в результате повторения процедуры
разделов~4.4--4.7 $\mathbf{r}$ раз, где $\mathbf{r}\in \bbn.$ Ясно, что
\bfn\label{5.4.11}
\widehat{\mathfrak{C}}_{\la_\mathbf{r}}[h_\mathbf{r}] \leqslant
\widehat{\mathfrak{C}}_{\la_o}[h_o]
\efn
(действительно, имеем, что $\widehat{\mathfrak{C}}_{\la_j}[h_j]\leqslant
\widehat{\mathfrak{C}}_{\la_{j-1}}[h_{j-1}]\ \ \fa j\in \ov{1,\mathbf{r}}).$
Разумеется, выбирая тот или иной вариант отображения $\Phi,$ мы получаем
(в смысле (\ref{5.4.11})) различные результаты.

Теперь мы рассмотрим конкретный вариант $\Phi,$ имея в виду применение
в алгоритме, предложенном А.А. Ченцовым. Для этого сначала введем при
$(\la,h)\in \bbd$ и $\nu\in \ov{0,\mathbf{k}}$ множество
\bfn\label{5.4.12}
\Psi_\nu[\la;h] \df \bigl\{z\in \mathfrak{K}|\,\exists\,t_1\in
\ov{1,N}\ \ \exists\,t_2\in \ov{1,N}:\,z = \bigl(\la(\nu+t_1),
\la(\nu+t_2)\bigl)\bigl\},
\efn
где $\mathfrak{K}$ --- множество всех адресных пар <<большой>>
задачи, а число $N$ соответствуют разделам~4.4--4.7 (в рассматриваемом
ниже алгоритме число $N\in \bbn$ не изменяется, в отличие от построений
предыдущего раздела). Поскольку (\ref{5.4.12}) --- конечное множество,
определена мощность
$$
|\Psi_\nu[\la;h]|\,\in \bbn_o.
$$
Теперь мы при $\mathbf{k}\geqslant 2$ конкретизируем выбор отображения
$\Phi$ следующим образом: полагаем при $(\la,h)\in \bbd$ и $\nu\in
\ov{0,\mathbf{k}},$ что
\bfn\label{5.4.13}
\Phi(\la,h,\nu) = \bigl\{\nu_o\in \ov{0,\mathbf{k}}\setminus
\{\nu\}\bigl|\,|\Psi_{\bar{\nu}}[\la;h]|\leqslant |\Psi_{\nu_o}[\la;h]|\ \
\fa \bar{\nu}\in \ov{0,\mathbf{k}}\setminus \{\nu\}\bigl\}.
\efn
Правило (\ref{5.4.13}) состоит очевидно в следующем: мы при заданном
ДР $(\la,h)\in \bbd$ назначаем такие изменения
\bfn\label{5.4.14}\nu\longrightarrow \nu_o,
\efn
при которых (см. (\ref{5.4.12})) <<окно>>, определяемое началом $\nu_o,$
содержит наибольшее число адресных пар исходной <<большой>> задачи.
При изменениях (преобразованиях) (\ref{5.4.14}) мы стремимся обеспечить
лучшую <<просчитываемость>> локальной задачи, имея в виду использование
условий предшествования <<в положительном направлении>>.



Пусть $X=\mathbb{R}\times\mathbb{R}$, $\mathbf{n}=60$,
$\mathbf{x}_0=(0,0)$,
$\vert \mathfrak{K} \vert=47$. Функцию $\mathbf{c}^{\natural}$ определяем посредством евклидова расстояния,
а значения функций $c_j^{\natural},\;j \in \overline{1,\mathbf{n}}$, --- в виде суммы евклидова расстояния
от пункта прибытия до заданного (и зависящего от $j$) плоского вектора и аналогичного расстояния от данного
вектора до пункта отправления. Алгоритмические конструкции были реализованы
А.А.Ченцовым в виде программы для ЭВМ, написанной на языке программирования C++
и работающей под управлением 64-х разрядной операционной
системы семейства Windows; вычислительная часть программы реализована в отдельном от интерфейса пользователя потоке.
По соображениям объема ограничимся изложением результатов вычислений на ПЭВМ
(в ходе вычислительного эксперимента применялся ноутбук с центральным процессором Core i7, объемом ОЗУ 6 гБ
с установленной операционной системой Windows 7 Максимальная Sp1), опуская описание мегаполисов и адресных пар;
начальное решение (пара маршрут--трасса) определялось жадным алгоритмом, соблюдающим условия предшествования
и реализующим значения критерия 4858.68 в <<незамкнутой>> задаче (функция $f^{\natural}$ тождественно равна нулю)
и 4988.18 в <<замкнутой>> задаче (значения $f^{\natural}$ определялись евкидовым расстоянием до <<нуля>>).

Итак, исходному решению и ранее используемому <<моменту>> начала
вставки сопоставляется отличное от данного <<момента>> начало вставки, максимизирующее
число адресных пар, занумерованных в соответствии с прежним маршрутом и попадающих в
окно предполагаемой вставки. В процессе счета для <<незамкнутой>> задачи
реализовались следующие показатели:

при $N=20$ результативных итераций 4, стабилизация наступила при значении критерия 4500.71;

при $N=25$ результативная итерация одна, стабилизация наступила при достижении результата 4456.51;

при $N=27$ результативная итерация одна, а достигнутое значение критерия $4446.77$;

при $N=30$ имеем одну результативную итерацию и значение критерия 4446.77.

Среднее время счета последовательно нарастало (при $N=20$ время одной итерации 36--45 сек, при $N=25$ ---
чуть более 10 минут, при $N=27$ --- уже 46 мин. 11 сек., а при $N=30$ время счета составило 5 час. 4 мин. 16 сек.).


В <<замкнутой>> задаче аналогичные показатели были следующими:

при $N=20$ результативных итераций 4, стабилизация наступила по достижении результата $4630.21$;

при $N=25$ результативная итерация одна, результат 4586.01;

при $N=27$ результативных итераций две, а достигнутый при этом результат 4576.26;

при $N=30$ имеем одну результативную итерацию и значение критерия 4576.26.

Среднее время счета сохраняло тенденцию <<незамкнутой>>, задачи (27-45 сек, 10-11 минут,
46 мин. 22 сек., 38 мин. 34 сек. в третьем случае, т.е. при $N=27$, и 5 час. 3 мин. 2 сек при $N=30$).

Таким образом, увеличивая $N$ (длина вставки), мы последовательно улучшаем
результат, затрачивая, однако, все большее время. Еще одно обстоятельство,
проявившееся в ходе вычислительного эксперимента, состоит в том, что при
$N=30$ (сравнительно большая длина вставки) получается всего одна результативная
итерация, после чего итерационная процедура стабилизируется. Это обстоятельство
можно рассматривать как некоторый косвенный <<индикатор>> приближения к
оптимальности.

\section{\protect\raggedright
  Итерационный режим со случайным расположением вставок фиксированной <<длины>>
}
\label{sect:5.5}
\setcounter{equation}{0}

Один из возможных подходов к решению проблемы выбора расположения оптимизирующей
вставки связан с организацией случайных испытаний. Точнее, имеется в виду
случайный выбор начала вставки. На этой основе был построен вариант итерационного
алгоритма, краткое изложение которого приведено в настоящем разделе.

Итак, фиксируем $\mathbf{k}\in \overline{0,\mathbf{n}-N}$ и допускаем возможность
случайного выбора начала вставки из <<интервала>> $\overline{0,\mathbf{k}}$. Такой
выбор осуществляется многократно, что приводит к реализации итерационной
процедуры. Количество итераций может задаваться заранее или определяться
по мере достижения заданного качества.

Рассмотрим несколько этапов процедуры, полагая, что на каждом из них выбор
начала вставки осуществляется на основе испытаний при использовании равномерного
распределения; значение $N$ фиксировано. Итак, пусть число $\nu_1\in \overline{0,\mathbf{k}}$
получено как результат случайного испытания. Далее используем процедуру,
изложенную в разделах 4.4-4.7 при условиях (\ref{5.4.4}), где $(\lambda_0,h_0)$
соответствует (\ref{5.4.3}) и является ДР, определенным с помощью какого-либо
эвристического алгоритма. Мы используем (\ref{4.4.13}), (\ref{4.4.14}) и
(\ref{4.4.24}) в условиях (\ref{5.4.4}); получаем ДР (\ref{5.4.5}) исходной
<<большой>> задачи, которое принимается за $(\lambda_1,h_1)$ (см. (\ref{5.4.6})),
причем реализуется неравенство (\ref{5.4.7}).

Теперь осуществляется случайное испытание, результатом которого является
$\nu_2\in \overline{0,\mathbf{k}}$. Вновь применяется процедура, изложенная
в разделах 4.4-4.7 при условиях $\lambda=\lambda_1$,
$(\mathbf{h}_i)_{i\in \overline{0,\mathbf{n}}}=h_1$ и $\nu=\nu_2$ и доставляющая
новое ДР $(\lambda_2,h_2)$ <<большой>> задачи. При этом реализуется неравенство
(\ref{5.4.10}).

Далее процедура повторяется, доставляя в конце концов неравенство (\ref{5.4.11}),
где $\mathbf{r}\in \mathbb{N}$ определяет количество итераций.

В примере рассматривался случай $\mathbf{n}=75$ и $|\mathbf{K}|=42$. Размер вставок
был выбран следующим: $N=23$. Функции стоимости предполагались такими же, как в разделе
5.2. Количество итераций равнялось 15. Начальный вариант был посчитан с использованием
эвристического итерационного алгоритма, значение полученного критерия равно 259,51.
Результат, достигнутый после применения вставок на основе ДП равен 257,16. Общее время
счета составляет 16 мин. 11 сек. Маршрут и трасса показаны на рис.
\ref{DP_Random_Inserts_Result}.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{route_random_dp_insertions.png}
  \caption{
    Траектория, полученная с использованием эвристического алгоритма
    с~улучшающими вставками на основе ДП (случайное расположение вставок)}
  \label{DP_Random_Inserts_Result}
  \end{center}
\end{figure}

\section{\protect\raggedright
  Один вариант жадного эвристического алгоритма
}
\label{sect:5.6}
\setcounter{equation}{0}

В задачах раскроя количество контуров нередко превышает несколько сотен.
Для решения таких задач предлагается использовать эвристические методы.
Кроме того, в задачах раскроя важную роль играют тепловые и
геометрические ограничения. Несоблюдение этих ограничений делает бессмысленной
оптимизацию длины пути.

Рассмотрим один из подходов к построению эвристического алгоритма для решения
задач большой размерности при наличии упомянутых ограничений. В данном подходе
оптимизирующие вставки не используются.

В качестве $X$ предполагается заданным достаточно большой прямоугольник
на плоскости, соответствующий листу металла. Процедура раскроя полагается
выполненной. В результате в пределах $X$ размещены контура деталей,
подлежащие резке по некоторым эквидистантам в виде замкнутых кривых.
С внешней по отношению к деталям стороны вблизи каждой эквидистанты
размещены конечные множества --- мегаполисы. Точки мегаполисов группируются
в упорядоченный пары. Элементами каждой такой упорядоченной пары являются точка
врезки и точка выключения инструмента. Каждой такой упорядоченной паре
сопоставляется также точка на эквидистанте, определяющая начало и завершение
реза соответствующего контура.

Как и в предыдущих разделах, фиксируются скорости холостого хода
и реза $V_i>0$ и $V_c>0$ соответственно. Значения функции $\mathbf{c}$
определяются соответствующим временем внешних перемещений. При этом точка
$x^0$ задается в виде начала координат: $x^0=(0,0)$. Функция $\mathbf{c}$
та же, что и в (\ref{ExtPrice}). Функция $f$ та же, что и в
(\ref{TerminalPrice}).

Перейдем к рассмотрению функций стоимости внутренних работ $c_1,...,c_N$,
в которых используется зависимость от списка заданий.

Пусть $j\in \overline{1,N}$, $z=(x,y)\in \mathbb{M}_j$ и
$u=u(z)$ --- отвечающая паре $z$ точка на $j$-й эквидистанте.
Кроме того, через $\tilde{D}$, $\tilde{D}\stackrel{\triangle}{=}\{0;1\}$,
обозначим множество, соответствующее возможным направлениям реза, причем $1$
определяет направление реза по часовой стрелке, $0$ --- против
часовой стрелки. Скорость реза здесь также совпадает с $V_c, V_c>0$.

Важным ограничением при резке металла является требование достаточного
количества металла возле завершающего участка реза --- рассеивание тепла
особенно важно на финишном участке.
В свете этого ограничения большую значимость приобретает направление реза.
Дело в том, что при резе в разных направлениях участок завершения реза
также оказывается с разных сторон от точки начала реза; при этом ситуация
с количеством металла с этих разных сторон может сильно различаться.

Условимся относительно следующих обозначений, применяемых ниже в целях формализации
содержательных понятий <<много металла>> и <<мало металла>>. Итак, если
$j\in \overline{1,N}$, $z\in \mathbb{M}_j$, $d\in \tilde{D}$ и
$\mathbb{K}\in \mathcal{P}(\overline{1,N}\setminus \{j\})$, то через
$S_1(j,z,d,\mathbb{K})$ обозначаем площадь пересечения заданной
области вокруг участка завершения реза и области имеющегося металла, а через
$S_2(j,z,d,\mathbb{K})$ --- площадь пересечения упомянутой области
и пустот, образовавшихся после вырезания контуров с номерами из $\mathbb{K}$,
а также внешнего пространства, выходящего за края листа. Под областью возле
участка завершения реза подразумевается геометрическая фигура, лежащая вне
детали, и такая, что расстояние от любой ее точки до ближайшей точки участка
завершения реза не превышает заданной величины (см. рис. \ref{FinishCutArea}).

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{CutFinishArea.png}
  \caption{Область металла возле участка завершения реза; резка против часовой
стрелки здесь более предпочтительна}
  \label{FinishCutArea}
  \end{center}
\end{figure}

Пусть $\tilde{K}, \tilde{K}\subset \overline{1,N}\setminus \{j\},$
--- множество номеров вырезанных к текущему моменту контуров,
и $k\in \tilde{K}$. На рисунке 1 изображены
два варианта реза --- по часовой стрелке и против часовой стрелки.
На рисунке область завершения реза пересекается только с вырезанным
контуром с номером $k$.

Стоимость внутренних работ по вырезанию контура с номером $j,j\in \overline{1,N},$
при использовании пары $z$ точек врезки и выключения инструмента,
$z\in \mathbb{M}_j$, в направлении $d,d\in \tilde{D},$ при условии,
что к настоящему моменту уже вырезаны контура с номерами из
$\tilde{K},\tilde{K}\subset \overline{1,N}\setminus \{j\}$, будет
вычисляться следующим образом: при $K=\overline{1,N}\setminus \tilde{K}$

\begin{equation}\label{IntPrice}
\begin{array}{c}
c_j(z,d,K)=\frac{\rho(\mbox{pr}_1(z),u(z))}{V_c}+
\frac{\rho(u(z),\mbox{pr}_2(z))}{V_c}+\\
+\frac{S_2(j,z,d,\overline{1,N}\setminus K)}{S_1(j,z,d,\overline{1,N}\setminus K)+
S_2(j,z,d,\overline{1,N}\setminus K)}\cdot\tilde{P}.
\end{array}
\end{equation}

Коэффициент $\tilde{P}$ определяет влияние штрафа
в зависимости от расположения финишной области реза. Если
$\tilde{P}=0$, то расположение финишной области никак не
сказывается на стоимости маршрута. Если $\tilde{P}$ есть
большая величина, то основная часть стоимости внутренних
работ в основном определяется вышеупомянутым штрафом, а
не временем реза на подходе к контуру.

Эвристический алгоритм показан в виде ряда шагов.
Изначально считается, что маршрут пуст. Далее к нему на
каждом шаге добавляется номер одного мегаполиса.

1. Находим мегаполис с номером $i,i\in \overline{1,N},$ для которого
$i\neq \mbox{pr}_2(z)$ $\forall z\in \mathbf{K}$, и упорядоченную пару
$(x,y)\in \mathbb{M}_i$, а также $d\in \tilde{D}$,
обеспечивающие минимум значения
$\mathbf{c}(x^0,x)+c_i((x,y),d,\overline{1,N})$.
Добавляем мегаполис $M_i$ в маршрут, а пару точек $(x,y)$ --- на трассу.
Отмечаем мегаполис $M_i$ как посещенный с направлением обхода $d$.

2. Через $V,V\subset \overline{1,N},$ обозначим множество номеров уже
посещенных мегаполисов. Пусть $j,j\in V,$ является номером
последнего мегаполиса частичного маршрута,
а $(x,y)\in \mathbb{M}_j$ его пара точек входа и выхода.
Далее находим такой номер мегаполиса $k,k\in I(\overline{1,N}\setminus V)$,
а также $(\tilde{x},\tilde{y})\in \mathbb{M}_k$ и $d\in \tilde{D}$,
которые обеспечивают минимальное значение выражения
$\mathbf{c}(y,\tilde{x})+c_k((\tilde{x};\tilde{y}),d,\overline{1,N}\setminus V)$.
Добавляем мегаполис $M_k$ в маршрут, а пару точек $(\tilde{x},\tilde{y})$
--- на трассу. Отмечаем мегаполис с номером $k$ как посещенный с направлением
обхода $d$.

3. Выполняем шаг 2 до тех пор, пока весь маршрут не будет построен.

Данный алгоритм позволяет получить некоторое допустимое решение. Так как алгоритм
жадный, то при его реализации значительный поиск глобального экстремума не производится.
Алгоритм может выдать некоторый локальный экстремум. В целях улучшения результата в
данной работе предлагается вариант многократного выполнения алгоритма с запретами
определенных перемещений, обеспечивающими возможность получения всякий раз новых
маршрута и трассы. Данные запреты осуществляются посредством изменения функций
стоимости $c_1,...,c_N$. Именно, для заданного мегаполиса значение этой функции
принимает очень большую величину, если он попадает в заранее оговоренную позицию
маршрута. Следовательно, алгоритм будет избегать посещения упомянутого мегаполиса
в данной выбранной позиции.

Для реализации этого подхода вводится специальная матрица $D$ коррекции стоимостей
внутренних работ: $D_{i,j}\in \{0;1\}$, $i\in \overline{1,N}$, $j\in \overline{1,N}$.
Если $D_{i,j}=1$, то
$$
c_i(h,d,K)=1000000\;\; \forall h\in \mathbb{M}_i,\;\;
\forall d\in \tilde{D},\;\;\forall K\in \mathcal{P}(\overline{1,N}\setminus \{i\})
$$
при условии, что мегаполис с номером $i$ помещен на маршруте в позицию $j$.
Если же $D_{i,j}=0$, то оценка внутренних
работ вычисляется обычным способом (см. (\ref{IntPrice})). Данный способ вычисления
внутренних стоимостей используется только во время построения маршрута и
трассы, для их оценки он не используется.

Работа итерационного алгоритма определяется двумя параметрами: $N_1$ и $N_2$.
$N_1$ определяет общее количество итераций, $N_2$ определяет количество
итераций в одном цикле. Смысл цикла итераций заключается в постепенном добавлении
новых коррекций (единиц в матрице $D$) к уже существующим. После завершения
цикла все значения матрицы $D$ сбрасываются в ноль. Далее итерационный метод
использования алгоритма приводится в виде ряда шагов.

1. Выполнение алгоритма без каких-либо коррекций.

2. Выбираем случайным образом позицию $i,i\in \overline{1,N}$, на маршруте.
Пусть в данной позиции располагается мегаполис с номером $j,j\in \overline{1,N}$.
Принимаем $D_{j,i}=1$.

3. Выполняем описанный ранее алгоритм. Вычисляем оценку маршрута и трассы
без коррекций. Если значение оценки улучшилось, то запоминаем данное значение,
а также полученные маршрут, трассу и направления обхода мегаполисов.

4. Выполняем шаги 2 и 3 $N_2-1$ раз ($N_2-2$ раз для первого цикла итераций,
так как в самом начале был произведен счет без коррекций).

5. Обнуляем матрицу $D$.

6. Выполняем шаги 2-5, пока общее количество итераций не достигнет $N_1$.

7. Выбираем лучший результат, а также соответствующие ему маршрут, трассу
и направления обхода мегаполисов.



{\bf Пример 1.} Скорость холостого хода $V_i=500$ мм/с, скорость реза $V_c=10$ мм/с.
Длина финишного участка реза равна 150 мм, ширина области завершения реза 50 мм.
Параметры итерационного метода в обоих примерах $N_1=100$, $N_2=10$,
коэффициент штрафа для внутренних работ $\tilde{P}=1000000$.
Количество контуров $N=170$, количество адресных пар $|\mathbf{K}|=80$.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{route_170_approximate_CA.png}
  \caption{Маршрут и трасса обхода множеств. Пример 1. Эвристический алгоритм}
  \label{Sample1Heuristic}
  \end{center}
\end{figure}

Результат счета 532,99, результат на первой итерации 556,15.
Время счета 8 мин. 23 сек.
Маршрут и трасса показаны на рис. \ref{Sample1Heuristic}.

{\bf Пример 2.} Скорость холостого хода $V_i=500$ мм/с, скорость реза $V_c=10$ мм/с.
Длина финишного участка реза равна 150 мм, ширина области завершения реза 50 мм.
Параметры итерационного метода в обоих примерах $N_1=100$, $N_2=10$,
коэффициент штрафа для внутренних работ $\tilde{P}=1000000$.
Количество контуров $N=201$, количество адресных пар $|\mathbf{K}|=56$.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{Sample_201_sets_approximate.png}
  \caption{Маршрут и трасса обхода множеств. Пример 2. Эвристический алгоритм}
  \label{Sample2Heuristic}
  \end{center}
\end{figure}

Результат счета 2255679,293, результат без учета штрафов 531,631 (совпадает
со значением на первой итерации). Время счета 1 мин. 40 сек.
Маршрут и трасса показаны на рис. \ref{Sample2Heuristic}.
В данном случае максимальный штраф составил 387001. Учитывая тот факт, что
максимально возможный штраф имеет значение 1000000 (если вся область завершения
реза приходится на пустоты в металле), то можно сделать вывод, что 38\% области
завершения реза пришлось на пустоты в металле для данного контура. Такой
результат может быть естественным следствием очень плотной компановки деталей
и, в принципе, вряд ли является критичным.

{\bf Пример 3.} Скорость холостого хода $V_i=500$ мм/с, скорость реза $V_c=10$ мм/с.
Длина финишного участка реза равна 150 мм, ширина области завершения реза 50 мм.
Решение получено с использованием метода динамического программирования
и эвристического итерационного алгоритма. Коэффициент штрафа для внутренних
работ $\tilde{P}=1000000$. В случае эвристического алгоритма параметры итерационного
метода имели стедующие значения $N_1=10000$, $N_2=10$.
Количество контуров $N=27$, количество адресных пар $|\mathbf{K}|=12$.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{Sample_27_sets_DP.png}
  \caption{Маршрут и трасса обхода множеств. Пример 3. Динамическое программирование}
  \label{Sample3DP}
  \end{center}
\end{figure}

Результат счета методом ДП 62,815, результат без учета штрафов 62,815.
Время счета 7 мин. 25 сек.
Маршрут и трасса показаны на рис. \ref{Sample3DP}.

\begin{figure}
  \begin{center}
  \includegraphics[width=0.9\textwidth]{Sample_27_sets_approximate.png}
  \caption{Маршрут и трасса обхода множеств. Пример 3. Эвристический алгоритм}
  \label{Sample3Heuristic}
  \end{center}
\end{figure}

Результат счета эвристическим итерационным методом 243112,454, результат
без учета штрафов 68,495 (для первой итерации 243113,235 и 69,276
соответственно).
Маршрут и трасса показаны на рис. \ref{Sample3Heuristic}.
Максимальный из штрафов составил 176823,72. Можно
сделать вывод, что 17\% области завершения реза пришлось на пустоты для
данного контура, что достаточно неплохо. Время счета 25 сек.

Особенность метода ДП состоит в том, что размерность решаемых с его
использованием примеров ограничена приблизительно четырьмя десятками контуров.
В принципе, такие задачи уже представляют практический интерес (возможны
раскрои такой размерности). Кроме того, метод ДП может использоваться для
грубой оценки приведенного эвристического алгоритма. Именно, предлагается
выполнить вычисления на нескольких десятках примеров эвристическим методом
и методом ДП, после чего сравнить результаты. Ниже приведены результаты
данного сравнения.

Количество примеров равно 25. Высота области, занимаемой контурами, приблизительно
равна одному метру. Ширина колеблется в пределах от одного до двух метров.
Матрицы, используемая для построения значений функций стоимости,
имеет 1500 столбцов и 700 строк.

Скорость холостого хода $V_i=500$ мм/с, скорость реза $V_c=10$ мм/с.
Длина финишного участка реза равна 100 мм, ширина области завершения реза 25 мм.
Параметры итерационного метода во всех примерах $N_1=100$, $N_2=10$,
коэффициент штрафа для внутренних работ $\tilde{P}=1000$.
Количество контуров в каждом из примеров $N=20$.
Количество адресных пар $|\mathbf{K}|$ принимало значение от 2 до 22.
Далее через $T_h$ будем обозначать значение критерия для эвристического
алгоритма, а через $T_{DP}$ - для метода ДП.
В ходе вычислительного эксперимента получены следующие значения критерия.\newline
Пример 4, $T_h=71.41, T_{DP}=66.42$.\newline
Пример 5, $T_h=372.35, T_{DP}=136.89$.\newline
Пример 6, $T_h=67.40, T_{DP}=66.30$.\newline
Пример 7, $T_h=263.41, T_{DP}=66.68$.\newline
Пример 8, $T_h=64.29, T_{DP}=63.18$.\newline
Пример 9, $T_h=70.26, T_{DP}=67.60$.\newline
Пример 10, $T_h=64.41, T_{DP}=62.87$.\newline
Пример 11, $T_h=68.16, T_{DP}=67.07$.\newline
Пример 12, $T_h=139.32, T_{DP}=136.64$.\newline
Пример 13, $T_h=68.30, T_{DP}=66.58$.\newline
Пример 14, $T_h=114.10, T_{DP}=65.53$.\newline
Пример 15, $T_h=70.10, T_{DP}=67.85$.\newline
Пример 16, $T_h=69.00, T_{DP}=66.61$.\newline
Пример 17, $T_h=68.06, T_{DP}=66.83$.\newline
Пример 18, $T_h=66.39, T_{DP}=64.94$.\newline
Пример 19, $T_h=69.83, T_{DP}=68.35$.\newline
Пример 20, $T_h=69.69, T_{DP}=66.46$.\newline
Пример 21, $T_h=68.28, T_{DP}=66.38$.\newline
Пример 22, $T_h=171.85, T_{DP}=65.25$.\newline
Пример 23, $T_h=68.11, T_{DP}=66.39$.\newline
Пример 24, $T_h=308.90, T_{DP}=135.72$.\newline
Пример 25, $T_h=69.05, T_{DP}=67.29$.\newline
Пример 26, $T_h=68.27, T_{DP}=66.16$.\newline
Пример 27, $T_h=221.97, T_{DP}=66.86$.\newline
Пример 28, $T_h=68.78, T_{DP}=66.92$.\newline

{\bf Выводы.} Сравнивая результаты работы эвристического алгоритма и
алгоритма на основе ДП можно отметить следующие моменты. В трех примерах
из 24 найти точное решение без штрафов не удалось. Напомним, штрафы возникают,
если область вокруг участка завершения реза пересекается с отверстиями в металле
или выходит за края листа. Причем в одном случае эвристический алгоритм дал
близкий к оптимальному результат, а в двух других случаях штраф был заметно
больше, чем в случае с ДП. Еще в четырех примерах эвристический алгоритм дал
результат со штрафами.

Максимальное значение критерия для одного из примеров для эвристического алгоритма
равно 372,35. Оптимальный результат для этого примера 136,89 (есть штрафы, величина
которых составляет 68,95). Для ДП стоимость маршрута без учета штрафов 68.09, для
эвристического алгоритма --- 68.95. Таким образом, без учета штрафов результаты счета
очень близки. В случае с эвристическим алгоритмом величина штрафа равна 303,4. Напомним,
что коэффициент штрафа для внутренних работ $\tilde{P}=1000$. Если вся область вокруг
участка завершения реза попадает на пустоты, то штраф для данного контура будет равен
1000. Даже в том случае, если вся величина штрафа 303,4 попала на один контур, менее
трети области вокруг участка завершения реза пересекается с пустотами в металле.
Такой результат представляется вполне приемлемым с практической точки зрения.

Таким образом, данный эвристический алгоритм представляется весьма эффективным.
Что касается алгоритма на основе ДП --- он дает оптимальный результат, что
исключительно важно, но размерость решаемых этим методом примеров лежит в пределах
четырех десятков контуров. Данное обстоятельство накладывает значительные
ограничения на практическое его использование.




%\section{Заключительные замечания}
%\setcounter{equation}{0}

%\section*{Заключительные замечания}
%\addcontentsline{toc}{section}{Заключительные замечания}

\noindent{\Large {\bf Заключительные замечания к разделу II}}

Задача управления инструментом при листовой резке на машинах с ЧПУ является весьма
трудной с точки зрения вычислительной реализации методов, развиваемых на основе
математической теории. При решении конкретных практических задач неизбежным
представляется применение эвристических алгоритмов. Эти алгоритмы могут быть
построены (см. предыдущий раздел) так, что при этом учитываются весьма различные
и плохо формализуемые ограничения. Последнее является, наряду с достаточно высоким
быстродействием и возможностью решать <<большие>> задачи, ценным обстоятельством.
Вместе с тем при их применении могут возникать явные коллизии. Для оперативного
вмешательства с целью <<исправления>> фрагментов ДР и было предложено применять
оптимизирующие вставки.

Данные вставки конструировались так, что оказывалось возможным (на локальном уровне)
использовать методы построения точных решений. Это было достигнуто за счет применения
вставок, приводящих к маршрутным задачам умеренной размерности. Таким образом, в
задачах маршрутизации, имеющих достаточно большую размерность, удалось
<<задействовать>> аппарат ДП, применяемый в режиме итераций, причем сами итерации
могут организовываться, как показано в настоящей главе, по-разному. В частности, в
качестве правила, определяющего конкретное расположение оптимизирующей вставки на
<<эвристическом>> решении, может быть выбран принцип своеобразной максимизации условий
предшествования, <<захватываемых>> данной вставкой, т.е. вовлечение в локальную задачу
как можно большего числа ограничений упомянутого типа. Данный подход, реализованный
в \S 5.4, показывает, что учет некоторых ограничений может играть положительную роль
в вопросах снижения сложности вычислений. Конечно, такой эффект достигается при должной
теоретической проработке, что и было сделано в рамках ДП.

\input{txt/conclude.tex}

\newpage
\printbibliography[heading=bibintoc,title=Список используемых источников]

\input{txt/tail.tex}

\end{document}
