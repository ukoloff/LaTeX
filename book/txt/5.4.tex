% !TeX root = ..

\section{
  Итерационный режим
  с элементами оптимизации
  локальных условий прешествования
}
\label{sect:5.4}
\setcounter{equation}{0}

В настоящем разделе обсудим вариант итерационной процедуры \ref{sect:4.8},
предложенный А.~А.~Ченцовым и связанный с использованием задачи (\ref{4.8.5}).
Мы сохраняем символику главы~4 как в части описания <<большой>> задачи,
так и в части описания локальных задач типа (\ref{4.2.5}).
Как уже отмечалось в \ref{sect:4.8},
данный вариант ориентирован на построение оптимизирующих вставок,
в которых количество адресных пар должно быть достаточно большим.
Это позволяет в определенной степени снижать сложность вычислений по методу ДП.

Введем в рассмотрение множество
\bfn
  \label{5.4.1}
  \bbd \df \bigl\{\bigl(\al,(z_i)_{i\in\ov{0,\nn}})\in \ca
  \times \mathfrak{Z}|\,(z_i)_{i\in\ov{0,\nn}}\in \mathfrak{Z}_\al\bigl\}
\efn
всех ДР <<большой>> задачи,
после чего на множестве
$$
  \bbd \times \ov{0,\mathbf{k}}
  ,
$$
где
$\mathbf{k}\in \bbn,\,\mathbf{k}\leqslant \nn-N,$
фиксировано,
определим многозначное отображение
\bfn
  \label{5.4.2}
  \Phi:\,\bbd\times \ov{0,\mathbf{k}}\longrightarrow
  \cp^\prime(\ov{0,\mathbf{k}})
  .
\efn

Отображение (\ref{5.4.2}) может, в принципе, определяться по разному,
но мы пока зафиксируем какой-либо вариант $\Phi$ с тем,
чтобы изложить логику возникающей итерационной процедуры,
после чего конкретизируем $\Phi$
(\ref{5.4.2}).

Итак, пусть сейчас
$\Phi$ --- любое многозначное отображение (мультифункция)
(\ref{5.4.2}).
Допустим, что тем или иным способом мы смогли определить
некоторое начальное ДР
\bfn
  \label{5.4.3}
  (\la_o,h_o)\in \bbd
\efn
(для построения данного ДР может использоваться тот или иной эвристический
(в частности, жадный) алгоритм).
Кроме того, выберем
$\nu_o\in \ov{0,\mathbf{k}}.$
В результате реализуется (непустое) множество
$$
  \Phi(\la_o,h_o,\nu_o) = \Phi\bigl((\la_o,h_o),\nu_o\bigl)\in
  \cp^\prime(\ov{0,\mathbf{k}})
  ,
$$
после чего осуществляется выбор индекса
\bfn
  \label{5.4.3`}
  \nu_1\in \Phi(\la_o,h_o,\nu_o)
  ,
\efn
определяющего конкретное начало вставки.
Заметим, что в (\ref{5.4.3`})
может использоваться то или иное оговоренное заранее правило выбора.
Так, например, мы можем действовать по правилу:
в качестве $\nu_1$ выбираем наименьший (наибольший)
элемент множества
$\Phi(\la_o,h_o,\nu_o).$
После того, как выбор (\ref{5.4.3`})
осуществлен, используем процедуру, изложенную в \ref{sect:4.4} -- \ref{sect:4.7},
при условиях
\bfn
  \label{5.4.4}
  \la = \la_o,
  (\mathbf{h}_i)_{i\in\ov{0,\nn}}= h_o,
  \nu = \nu_1
\efn
((\ref{4.4.13}), (\ref{4.4.14}) и (\ref{4.4.24}) применяем в условиях (\ref{5.4.4})).
После реализации процедуры \ref{sect:4.4} -- \ref{sect:4.7}
при условиях (\ref{5.4.4})
получаем новое ДР
\bfn
  \label{5.4.5}
  \bigl(\eta,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}\bigl)\in \bbd
\efn
<<большой>> задачи, которое мы принимаем за
$(\la_1,h_1)$.
Итак, полагаем
\bfn
  \label{5.4.6}
  \la_1 = \eta,\,h_1 = (\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}
  ,
\efn
что соответствует построениям \ref{sect:4.5} -- \ref{sect:4.7}.
Напомним, что при этом
(см. (\ref{4.7.49}) и теорему~\ref{t4.6.1})
$$
  \widehat{\mathfrak{C}}_\eta[(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}] \leqslant
  \widehat{\mathfrak{C}}_\la[(\mathbf{h}_i)_{i\in\ov{0,\nn}}]
  ,
$$
что при наших условиях (\ref{5.4.6})
приводит к неравенству
\bfn
  \label{5.4.7}
  \widehat{\mathfrak{C}}_{\la_1}[h_1] \leqslant
  \widehat{\mathfrak{C}}_{\la_o}[h_o]
\efn
(конкретная степень <<улучшения>> значений критерия указана в (\ref{4.7.49})
и теореме~\ref{t4.6.1}).
Получим множество
$$
  \Phi(\la_1,h_1,\nu_1) \in \cp^\prime(\ov{0,\mathbf{k}})
  .
$$

Поскольку в частности
$\Phi(\la_1,h_1,\nu_1)\neq \emp$
осуществляем выбор
\bfn
  \label{5.4.8}
  \nu_2\in \Phi(\la_1,h_1,\nu_1)
  ,
\efn
используя то или иное правило
(см. обсуждение после (\ref{5.4.3`})).
Теперь применяем процедуру,
изложенную в \ref{sect:4.4} -- \ref{sect:4.7}
при условиях, что
$$
  \la =\la_1,(\mathbf{h}_i)_{i\in\ov{0,\nn}}= h_1, \nu= \nu_2
  ,
$$
получая в результате новый вариант ДР (\ref{5.4.5})
<<большой>> задачи,
обозначаемый сейчас через $(\la_2,h_2),$
что соответствует конкретизации
\bfn
  \label{5.4.9}
  \eta = \la_2,(\hat{\mathbf{h}}_t)_{t\in\ov{0,\nn}}= h_2
  .
\efn

Итак, $(\la_2,h_2)$ получается в виде ДР, улучшающего
$(\la_1,h_1):$
\bfn
  \label{5.4.10}
  \widehat{\mathfrak{C}}_{\la_2}[h_2] \leqslant
  \widehat{\mathfrak{C}}_{\la_1}[h_1]
  .
\efn

Далее процесс повторяется заданное
(или  выбираемое по мере реализации алгоритма)
число раз.
Обозначая данное число через $\mathbf{r},$
мы можем говорить о кортеже
$$
  s \longmapsto (\la_s,h_s):\,\ov{1,\mathbf{r}}\longrightarrow \bbd
$$
ДР <<большой>> задачи,
получаемом в результате повторения процедуры
\ref{sect:4.4} -- \ref{sect:4.7}
$\mathbf{r}$ раз, где
$\mathbf{r}\in \bbn.$
Ясно, что
\bfn
  \label{5.4.11}
  \widehat{\mathfrak{C}}_{\la_\mathbf{r}}[h_\mathbf{r}] \leqslant
  \widehat{\mathfrak{C}}_{\la_o}[h_o]
  .
\efn

Действительно, имеем, что
$\widehat{\mathfrak{C}}_{\la_j}[h_j]\leqslant
\widehat{\mathfrak{C}}_{\la_{j-1}}[h_{j-1}]\ \ \fa j\in \ov{1,\mathbf{r}}$.
Разумеется, выбирая тот или иной вариант отображения $\Phi,$ мы получаем
(в смысле (\ref{5.4.11}))
различные результаты.

Теперь мы рассмотрим конкретный вариант $\Phi,$
имея в виду применение в алгоритме, предложенном А. А. Ченцовым.
Для этого сначала введем при
$(\la,h)\in \bbd$ и
$\nu\in \ov{0,\mathbf{k}}$
множество
\bfn
  \label{5.4.12}
  \Psi_\nu[\la;h] \df \bigl\{z\in \mathfrak{K}|\,\exists\,t_1\in
  \ov{1,N}\ \ \exists\,t_2\in \ov{1,N}:\,z = \bigl(\la(\nu+t_1),
  \la(\nu+t_2)\bigl)\bigl\}
  ,
\efn
где
$\mathfrak{K}$ --- множество всех адресных пар <<большой>> задачи,
а число $N$ соответствуют \ref{sect:4.4} -- \ref{sect:4.7}
(в рассматриваемом ниже алгоритме число $N\in \bbn$ не изменяется,
в отличие от построений предыдущего раздела).
Поскольку (\ref{5.4.12}) --- конечное множество,
определена мощность
$$
  |\Psi_\nu[\la;h]|\,\in \bbn_o
  .
$$

Теперь мы при
$\mathbf{k}\geqslant 2$
конкретизируем выбор отображения
$\Phi$:
полагаем при
$(\la,h)\in \bbd$ и
$\nu\in \ov{0,\mathbf{k}},$ что
\bfn
  \label{5.4.13}
  \Phi(\la,h,\nu) = \bigl\{\nu_o\in \ov{0,\mathbf{k}}\setminus
  \{\nu\}\bigl|\,|\Psi_{\bar{\nu}}[\la;h]|\leqslant |\Psi_{\nu_o}[\la;h]|\ \
  \fa \bar{\nu}\in \ov{0,\mathbf{k}}\setminus \{\nu\}\bigl\}
  .
\efn

Правило (\ref{5.4.13})
состоит в следующем:
мы при заданном ДР
$(\la,h)\in \bbd$
назначаем такие изменения
\bfn
  \label{5.4.14}
  \nu\longrightarrow \nu_o
  ,
\efn
при которых
(см. (\ref{5.4.12}))
<<окно>>, определяемое началом $\nu_o,$
содержит наибольшее число адресных пар исходной <<большой>> задачи.
При изменениях (преобразованиях) (\ref{5.4.14})
мы стремимся обеспечить лучшую <<просчитываемость>> локальной задачи,
имея в виду использование условий предшествования <<в положительном направлении>>.

Пусть
$X=\mathbb{R}\times\mathbb{R}$, $\mathbf{n}=60$,
$\mathbf{x}_0=(0,0)$,
$\vert \mathfrak{K} \vert=47$.
Функцию $\mathbf{c}^{\natural}$
определяем посредством евклидова расстояния,
а значения функций
$c_j^{\natural},\;j \in \overline{1,\mathbf{n}}$, ---
в виде суммы евклидова расстояния от пункта прибытия до заданного
(и зависящего от $j$)
плоского вектора и аналогичного расстояния от данного
вектора до пункта отправления.
Алгоритмические конструкции были реализованы
А. А.Ченцовым в виде программы для ЭВМ,
написанной на языке программирования {\it C++}
и работающей под управлением 64-х разрядной операционной
системы семейства {\it Windows}.
Вычислительная часть программы реализована в отдельном от интерфейса пользователя потоке.
По соображениям объема ограничимся изложением результатов вычислений на ПЭВМ
(в ходе вычислительного эксперимента применялся ноутбук с центральным процессором
{\it Core i7}, объемом ОЗУ 6 ГБ
с установленной операционной системой
{\it Windows 7} Максимальная {\it SP1}),
опуская описание мегаполисов и адресных пар.
Отметим, что
начальное решение (пара маршрут--трасса)
определялось жадным алгоритмом, соблюдающим условия предшествования
и реализующим значения критерия 4858.68 в <<незамкнутой>> задаче
(функция $f^{\natural}$ тождественно равна нулю)
и 4988.18 в <<замкнутой>> задаче
(значения $f^{\natural}$ определялись евклидовым расстоянием до <<нуля>>).

Итак, исходному решению и ранее используемому <<моменту>> начала
вставки сопоставляется отличное от данного <<момента>> начало вставки,
максимизирующее число адресных пар,
занумерованных в соответствии с прежним маршрутом и попадающих в
окно предполагаемой вставки.
В процессе счета для <<незамкнутой>> задачи
реализовались следующие показатели
при разных значениях $N$:

\begin{itemize}
  \item
  $N=20$, результативных итераций 4, стабилизация наступила при значении критерия 4500.71;
  \item
  $N=25$, результативная итерация одна, стабилизация наступила при достижении результата 4456.51;
  \item
  $N=27$, результативная итерация одна, а достигнутое значение критерия $4446.77$;
  \item
  $N=30$, имеем одну результативную итерацию и значение критерия 4446.77.
\end{itemize}

Среднее время счета последовательно нарастало:
при $N=20$ время одной итерации 36--45 с,
при $N=25$ --- чуть более 10 мин,
при $N=27$ --- уже 46 мин 11 с,
а при $N=30$ время счета составило 5 ч 4 мин 16 с.

В <<замкнутой>> задаче аналогичные показатели были следующими:

\begin{itemize}
  \item
  $N=20$, результативных итераций 4, стабилизация наступила по достижении результата $4630.21$;
  \item
  $N=25$, результативная итерация одна, результат 4586.01;
  \item
  $N=27$, результативных итераций две, а достигнутый при этом результат 4576.26;
  \item
  $N=30$, имеем одну результативную итерацию и значение критерия 4576.26.
\end{itemize}

Среднее время счета сохраняло тенденцию <<незамкнутой>>, задачи
(27--45 с, 10--11 мин,
46 мин 22 с, 38 мин 34 с. в третьем случае,
т. е. при $N=27$,
и 5 ч 3 мин 2 с при $N=30$).

Таким образом, увеличивая $N$
(длина вставки),
мы последовательно улучшаем результат,
затрачивая, однако, все большее время.
Еще одно обстоятельство,
проявившееся в ходе вычислительного эксперимента,
состоит в том, что при
$N=30$
(сравнительно большая длина вставки)
получается всего одна результативная итерация,
после чего итерационная процедура стабилизируется.
Это обстоятельство можно рассматривать как некоторый
косвенный <<индикатор>> приближения к оптимальности.
