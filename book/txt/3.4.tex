% !TeX root = ..


\section{
  Расширение основной маршрутной задачи
}
\label{sect:3.4}
\setcounter{equation}{0}

Отметим, что сама по себе задача (\ref{3.3.31})
является <<неудобной>> с точки
зрения непосредственного использования аппарата ДП,
поскольку условия предшествования
являются ограничениями на маршрут <<в целом>>.
По этой причине, следуя \cite{Cha1`,Cha2`,Cha3`}
будем предварительно осуществлять подходящую редукцию условий предшествования,
что приведет к изменению самого понятия допустимости маршрутов:
допустимость по предшествованию будет
заменена более <<удобной>> допустимостью по вычеркиванию
заданий из списка.
Этот прием будет широко использоваться в дальнейшем
и мы воспроизведем его достаточно подробно.

Через $\mathfrak{N}$ обозначаем семейство всех непустых п/м
$\ov{1,N};\,\mathfrak{N}\df \cp^\prime(\ov{1,N}).$
Множества --- элементы семейства $\mathfrak{N}$ --- называем далее
списками (заданий).
При этом,  конечно,
$\ov{1,N}\in \mathfrak{N}$ и $\{k\}\in \mathfrak{N}\ \ \fa k\in \ov{1,N}.$
В частности, $\mathfrak{N}\neq \emp.$
Следуя
\cite[ч.~2]{Cha11`},
введем отображение
\bfn
  \label{3.4.1}
  \mathbf{I}:\, \mathfrak{N}\longrightarrow\mathfrak{N}
\efn
посредством следующего правила:
если $K\in \mathfrak{N},$ то
\bfn
  \label{3.4.2}
  \mathbf{I}(K) \df K\sm\{\mathrm{pr}_2(z):\,z\in \Xi[K]\}
  ,
\efn
где
$\Xi[K] \df \{z\in \mathbf{K}|\,\bigl(\mathrm{pr}_1(z)\in K\bigl)\,\&\,
\bigl(\mathrm{pr}_2(z)\in K\bigl)\}$.
Корректность определений (\ref{3.4.1}),
(\ref{3.4.2}) обоснована в \cite[ч.~2]{Cha1`}.
Заметим, в частности, что
$\Xi[\ov{1,N}] = \mathbf{K}$ и
\bfn
  \label{3.4.3}
  \mathbf{I}(\ov{1,N}) = \ov{1,N}\sm \{\mathrm{pr}_2(z):\,z\in \mathbf{K}\}
  .
\efn

Далее, отметим, что при
$t\in \ov{1,N}$
имеем $\{t\}\in \mathfrak{N}$ и определено (см. (\ref{3.4.2}))
множество
$\mathbf{I}(\{t\})\in \cp^\prime(\{t\});$
поскольку
$\cp^\prime(\{t\}) = \bigl\{\{t\}\bigl\},$
то $\mathbf{I}(\{t\}) = \{t\}$.
В этой связи полезно отметить, что при
$z\in \mathbf{K}$ в силу (\ref{3.3.21})
$\mathrm{pr}_1(z) \neq \mathrm{pr}_2(z),$
а тогда имеем для $t\in \ov{1,N},$ что
$\Xi[\{t\}] = \emp$.
Итак, одноэлементные списки --- суть неподвижные точки
$\mathbf{I}$ (\ref{3.4.1}), (\ref{3.4.2}):
\bfn
  \label{3.4.4}
  \mathbf{I}(\{s\}) = \{s\}\ \ \fa s\in \ov{1,N}
  .
\efn
В (\ref{3.4.3}), (\ref{3.4.4})
указаны простейшие варианты действия
$\mathbf{I}.$
В терминах отображения $\mathbf{I}$ мы определяем
(см. \cite[ч.~2]{Cha1`})
новое понятие допустимости маршрутов,
причем делаем это сразу для маршрутов частичных
(разумеется, полные маршруты рассматриваются при этом как варианты частичных):
если
$K\in \mathfrak{N},$
то среди элементов множества $(\mathrm{bi})[K]$ выделяем
маршруты, допустимые по вычеркиванию
заданий из списка.
Итак, при
$K\in \mathfrak{N}$
полагаем, что
\bfn
  \label{3.4.5}
  (\mathbf{I}- \mathrm{bi})[K] \df \bigl\{\al\in (\mathrm{bi})[K]
  \bigl|\,\al(m) \in \mathbf{I}\bigl(\{\al(i):\,i\in \ov{m,|K|}\}\bigl)\ \ \fa m\in
  \ov{1,|K|}\bigl\}
  .
\efn

Элементы множества (\ref{3.4.5})
называем (частичными) маршрутами посещения
мегаполисов
$M_k,\ k\in K,$
допустимыми по вычеркиванию.
В \cite[ч.~2]{Cha1`}
установлено, что множества (\ref{3.4.5}) непусты.
Итак,
\bfn
  \label{3.4.6}
  (\mathbf{I}- \mathrm{bi})[K] \in \cp^\prime\bigl((\mathrm{bi})
  [K]\bigl)\ \ \fa K\in  \mathfrak{N}
  .
\efn

В связи с (\ref{3.4.6})
см. \cite[предложения~2.2.2, 2.2.3]{Cha1`}.
Заметим теперь, что \cite[теорема~2.2.1]{Cha1`}
\bfn
  \label{3.4.7}
  \mathbf{A}= (\mathbf{I}-\mathrm{bi})[\ov{1,N}]
  .
\efn

Итак, в случае $K = \ov{1,N}$ допустимость маршрутов по предшествованию и
допустимость по вычеркиванию  тождественны,
так как реализуется один и тот
же <<запас>> допустимых маршрутов.
Из (\ref{3.4.5}) и (\ref{3.4.7})  следует, что
\begin{eqnarray}
  &\mathbf{A}= \bigl\{\al\in \bbp\bigl|\,\al(m) \in \mathbf{I}\bigl(\{\al(t):\,
  t\in \ov{m,N}\}\bigl)\ \ \fa m\in \ov{1,N}\bigl\} =
  &\nonumber\\
  &=\Bigl\{\al\in \bbp\bigl|\,
  \bigl(\al(1) \in \mathbf{I}(\ov{1,N})\bigl)\,\&
  &\nonumber\\
  &\&\, \Bigl(\al(s)\in \mathbf{I}\bigl(\ov{1,N}\sm \{\al(t):\,t\in \ov{1,s-1}\}
  \bigl)\ \ \fa s\in \ov{2,N}\Bigl)\Bigl\}\in \cp^\prime(\bbp)
  .
  \label{3.4.8}
\end{eqnarray}

В итоге,
мы получили представление всех допустимых по предшествованию маршрутов
исходной задачи в терминах оператора вычеркивания,
то есть в терминах допустимости по вычеркиванию.

Рассмотрим теперь построение частичных трасс,
имея в виду выполнение не всех
заданий.
В этой связи при $K\in\mathfrak{N}$
условимся через $\bbz_K$
обозначать множество всех кортежей
\bfn
  \label{3.4.8`}
  (z_i)_{i\in \ov{0,|K|}}:\,\ov{0,|K|} \longrightarrow \bbx \times \mathbf{X}
  .
\efn

Если $x\in \mathbf{X}, K\in \mathfrak{N}$ и
$\al\in (\mathrm{bi})[K],$
то полагаем
\bfn
  \label{3.4.9}
  \mathbf{Z}(x,K,\al) \df \{(z_i)_{i\in \ov{0,|K|}}\in \bbz_K\,|\,\bigl(z_o=
  (x,x)\bigl)\,\&\,(z_t\in \bbm_{\al(t)}\ \ \fa t\in \ov{1,|K|})\}
  .
\efn

Ясно, что
$\mathbf{Z}(x,K,\al) \in \mathrm{Fin}(\bbz_K)\  \fa x\in \mathbf{X}\  \fa K\in \mathfrak{N}\  \fa
\al\in (\mathrm{bi})[K]$,
см. (\ref{3.3.1}), (\ref{3.3.2}), (\ref{3.4.9}).
В (\ref{3.4.9}) мы имеем <<укороченный>> вариант
(\ref{3.3.15}).
Теперь попытаемся учесть действие мультифункций (\ref{3.3.9}).
Здесь мы будем действовать подобно (\ref{3.3.16}):
если
$x\in \mathbf{X},\, K\in \mathfrak{N}$ и $\al\in (\mathrm{bi})[K],$
то
\bfn
  \label{3.4.10}
  \cz(x,K,\al) \df \bigl\{(z_i)_{i\in\ov{0,|K|}}\in \mathbf{Z}
  (x,K,\al) \bigl|\,\mathrm{pr}_1(z_s)\in A_{\al(s)}\bigl(\mathrm{pr}_2(z_{s-1})
  \bigl)\ \ \fa s\in \ov{1,|K|}\bigl\}
  .
\efn

Из (\ref{3.4.10}) и \cite[(3.21)]{Cha3`}
легко следует, что
\bfn
  \label{3.4.11}
  \cz(x,K,\al) \in \mathrm{Fin}(\bbz_K)\ \ \fa x\in
  \mathbf{X}\ \ \fa K\in \mathfrak{N}\ \ \fa \al\in (\mathrm{bi})[K]
  .
\efn

В связи с (\ref{3.4.9})--(\ref{3.4.11})
отметим очевидный частный случай,
соответствующий ситуации
$x = x^o, K = \ov{1,N}$ и $\al\in \bbp.$
Для этого
прежде всего отметим, что (см. (\ref{3.3.14}), (\ref{3.4.8`}))
\bfn
  \label{3.4.12}
  \bbz = \bbz_{\ov{1,N}}\,
  .
\efn

Далее, из (\ref{3.3.15}), (\ref{3.4.9}) и (\ref{3.4.12}) вытекает следующая
система равенств:
\bfn
  \label{3.4.13}
  \mathbf{Z}_\al = \mathbf{Z}(x^o,\ov{1,N},\al) \ \ \fa \al\in \bbp
  .
\efn

Наконец,
из (\ref{3.3.16}), (\ref{3.4.10}) и (\ref{3.4.13})
получаем, что
\bfn
  \label{3.4.14}
  \cz_\al = \cz(x^o,\ov{1,N},\al) \ \ \fa \al\in \bbp
  .
\efn

Разумеется, из (\ref{3.4.8}) и (\ref{3.4.13}) следует, в частности, что
\bfn
  \label{3.4.15}
  \mathbf{Z}_\al = \mathbf{Z}(x^o,\ov{1,N},\al) \ \ \fa \al\in \mathbf{A}
  .
\efn

Аналогичным образом из (\ref{3.4.8}) и (\ref{3.4.14})
вытекает следующее свойство:
\bfn
  \label{3.4.16}
  \cz_\al = \cz(x^o,\ov{1,N},\al) \ \ \fa \al\in \mathbf{A}
  .
\efn

Возвращаясь к (\ref{3.4.9}),
заметим также, что из (\ref{3.4.6}) и (\ref{3.4.9})
следует, что
\begin{eqnarray}
  &\mathbf{Z}(x,K,\al) = \bigl\{(z_i)_{i\in \ov{0,|K|}} \in \bbz_K\bigl|\,\bigl(z_o =
  (x,x)\bigl)\,\&\,
  &\nonumber\\
  &\&\,(z_t\in \bbm_{\al(t)}\ \ \fa t\in \ov{1,|K|})\bigl\}\in \mathrm{Fin}
  (\bbz_K)
  &\nonumber\\
  &\ \ \fa x\in \mathbf{X}\ \ \fa K\in \mathfrak{N}\ \ \fa \al\in (\mathbf{I}-\mathrm{bi})[K].
  &
  \label{3.4.17}
\end{eqnarray}

Наконец, из (\ref{3.4.6}) и (\ref{3.4.11})
извлекается следующее (основное) свойство:
\begin{eqnarray}
  &\cz(x,K,\al) = \bigl\{(z_i)_{i\in \ov{0,|K|}} \in \mathbf{Z}(x,K,\al)\bigl|\,\mathrm{pr}_1(z_s)
  \in A_{\al(s)}\bigl(\mathrm{pr}_2(z_{s-1})\bigl)\ \
  &\nonumber\\
  &\fa s\in \ov{1,|K|}\bigl\}\in \mathrm{Fin}(\bbz_K)\ \ \fa x\in \mathbf{X}\ \ \fa K\in
  \mathfrak{N}\ \ \fa \al\in (\mathbf{I}-\mathrm{bi})[K].
  &
  \label{3.4.18}
\end{eqnarray}

Для наших целей существенны при
$x\in \mathbf{X}$ и $K\in \mathfrak{N}$
упорядоченные пары
\bfn
  \label{3.4.19}
  \bigl(\al,(z_i)_{i\in\ov{0,|K|}}\bigl),\ \ \al\in
  (\mathbf{I}-\mathrm{bi})[K], \ \ (z_i)_{i\in\ov{0,|K|}}\in \cz(x,K,\al)
  ,
\efn
рассматриваемые как ДР частичной задачи,
соответствующей позиции
(в дальнейшем будем употреблять  этот термин)
$(x,K) \in \mathbf{X}\times \mathfrak{N}.$
Такое толкование упорядоченных пар
(см. (\ref{3.4.19})) будет соответствовать расширению основной задачи
(\ref{3.3.31}).

В связи с задачей (\ref{3.3.34})
логично отождествлять <<частичные>> упорядоченные пары
$$
  \bigl(\al,(z_i)_{i\in\ov{0,|K|}}\bigl),\ \ \al\in (\mathbf{I}-\mathrm{bi})[K], \ \
  (z_i)_{i\in\ov{0,|K|}}\in \mathbf{Z}(x,K,\al)
$$
с соответствующими ДР
(здесь, конечно,
$x\in \mathbf{X}$  и $K\in \mathfrak{N})$.

Условимся о следующем соглашении:
если $K\in \mathfrak{N}, \al\in (\mathrm{bi})[K]$ и
$(z_i)_{i\in\ov{0,|K|}}\in \bbz_K,$
то полагаем, что
\bfn
  \label{3.4.20}
  \widehat{\mathfrak{C}}_\al[(z_i)_{i\in\ov{0,|K|}}\,|\,K] \df
  \sum\limits_{t=1}^{|K|}[\mathbf{c}\bigl(\mathrm{pr}_2(z_{t-1}),\mathrm{pr}_1(z_t)\bigl)+
  c_{\al(t)}(z_t)] + f\bigl(\mathrm{pr}_2(z_{|K|})\bigl)
  .
\efn

Разумеется, определение (\ref{3.4.20})
наиболее существенно для нас в случае, когда
$\al\in (\mathbf{I}-\mathrm{bi})[K]$
и
$(z_i)_{i\in\ov{0,|K|}}\in \cz(x,K,\al),$
где
$x\in \mathbf{X}$
(обратим внимание также на вариант
$(z_i)_{i\in\ov{0,|K|}}\in \mathbf{Z}(x,K,\al)).$
Отметим, что (\ref{3.4.20})
подобно определению (\ref{3.3.30}).
В этой связи подчеркнем, что согласно (\ref{3.4.12})
определены значения
$$
  \widehat{\mathfrak{C}}_\al[(z_i)_{i\in\ov{0,N}}\,|\,\ov{1,N}],\ \al\in \bbp,\
  (z_i)_{i\in\ov{0,N}}\in \bbz
  .
$$

Более того, из (\ref{3.3.30}) и (\ref{3.4.20})
легко следует, что
\bfn
  \label{3.4.21}
  \widehat{\mathfrak{C}}_\al[(z_i)_{i\in\ov{0,N}}\,|\,\ov{1,N}] =
  \mathfrak{C}_\al[(z_i)_{i\in\ov{0,N}}]\ \ \fa \al\in \bbp\ \ \fa (z_i)_{i\in\ov{0,N}}
  \in \bbz
  .
\efn

В свою очередь, из (\ref{3.4.21})
получаем полезное следствие в виде системы равенств
\bfn
  \label{3.4.22}
  \widehat{\mathfrak{C}}_\al[(z_i)_{i\in\ov{0,N}}\,|\,\ov{1,N}] =
  \mathfrak{C}_\al[(z_i)_{i\in\ov{0,N}}]\ \ \fa \al\in \mathbf{A}\ \ \fa (z_i)_{i\in\ov{0,N}}
  \in \cz_\al
  .
\efn

Введем теперь в рассмотрение частичные
(укороченные) задачи.
При $x\in \mathbf{X}$ и
$K\in \mathfrak{N}$
рассматриваем задачу
\bfn
  \label{3.4.23}
  \widehat{\mathfrak{C}}_\al[(z_i)_{i\in\ov{0,|K|}}\,\bigl|\,K] \longrightarrow \min,\
  \al\in (\mathbf{I} - \mathrm{bi})[K],\  (z_i)_{i\in\ov{0,|K|}}\in\cz(x,K,\al)
  .
\efn

С учетом уже упоминавшегося свойства непустоты и конечности множества всех ДР вида
(\ref{3.4.19})
(см. (\ref{3.4.6}), (\ref{3.4.18}))
имеем, что ограничения каждой задачи
(\ref{3.4.23}) совместны,
а оптимальные ДР непременно существуют.
С учетом этого полагаем, что
\begin{eqnarray}
  &v(x,K) \df \min\limits_{\al\in (\mathbf{I} - \mathrm{bi})[K]}\
  \min\limits_{(z_i)_{i\in\ov{0,|K|}}\in\cz(x,K,\al)}
  \widehat{\mathfrak{C}}_\al[(z_i)_{i\in\ov{0,|K|}}\,|\,K]\in
  [0,\infty[\ \
  &\nonumber\\
  &\fa x\in \mathbf{X}\ \
  \fa K\in \mathfrak{N}.
  \label{3.4.24}
\end{eqnarray}

Мы дополняем (\ref{3.4.24}) естественными соотношениями
\bfn
  \label{3.4.25}
  v(x,\emp) \df f(x)\ \ \fa x\in \mathbf{X}
  .
\efn

Исходя из
(\ref{3.4.24}), (\ref{3.4.25})
определена функция
\bfn
  \label{3.4.26}
  v\in \car_+[\mathbf{X}\times \cp(\ov{1,N})]
\efn
(при $x\in \mathbf{X}$ значение $v(x,K)$ функции $v$ (\ref{3.4.26})
определяется
посредством (\ref{3.4.24}),
если $K\in \mathfrak{N},$
а при $K= \emp$ ---
посредством (\ref{3.4.25}).
Напомним, что
$\cp(\ov{1,N}) = \mathfrak{N}\,\cup\,\{\emp\}).$
Значение $v(x,K)$ для каждой позиции $(x,K)\in \mathbf{X}\times \mathfrak{N}$
определяет
стоимость данной позиции в смысле возможностей оптимизации в соответствующей частичной
задаче типа (\ref{3.4.23}).
По самому смыслу упомянутых задач (\ref{3.4.23}) логично
рассматривать (\ref{3.4.26}) как функцию Беллмана
$$
  v:\,\mathbf{X}\times \cp(\ov{1,N}) \longrightarrow [0,\infty[
  .
$$

С учетом
(\ref{3.3.32}), (\ref{3.4.7}), (\ref{3.4.14}) и (\ref{3.4.22})
получаем важное равенство
\bfn
  \label{3.4.27}
  V = v(x^o,\ov{1,N})
  ,
\efn
дополняющее сделанное ранее заключение:
система частичных задач (\ref{3.4.23}) является
расширением основной задачи (\ref{3.3.31}).
В \cite{Cha3`} установлена следующая теорема,
использующая представление (\ref{3.3.13}).

\begin{theo}
  \label{t3.4.1}{\TL}
  Функция $v$ удовлетворяет уравнению

  \bfn
    \label{3.4.28}
      v(x,K) = \min\limits_{j\in \mathbf{I}(K)}\, \min\limits_{z\in \bba_j(x)}
      [\mathbf{c}\bigl(x,\mathrm{pr}_1(z)\bigl) + c_j(z) + v\bigl(\mathrm{pr}_2(z),
      K\sm\{j\}\bigl)]\ \ \fa x\in \mathbf{X}\ \ \fa K\in \mathfrak{N}.
    \efn
\end{theo}

В связи с (\ref{3.4.28}) отметим,
что операция минимизации в правой части данного
соотношения определена корректно:
при $x\in \mathbf{X}$ и $K\in \mathfrak{N}$ имеем,
с одной стороны (см. (\ref{3.4.1})),
в виде $\mathbf{I}(K)$ непустое п/м $\ov{1,N},$
а с другой, --- согласно  (\ref{3.3.12}),
множество $\bba_j(x)$ непустое и конечное при каждом
$j\in \mathbf{I}(K).$
Каждая отдельно взятая задача минимизации в (\ref{3.4.28})
является
достаточно простой
(напомним, что доказательство теоремы~\ref{t3.4.1}
приведено в \cite[теорема~5.1]{Cha3`},
где следует рассматривать
тот частный случай, когда функции в \cite[(4.1)]{Cha3`}
не зависят от списка заданий).

Из (\ref{3.4.27}) и теоремы~{\ref{t3.4.1}
вытекает, в частности, что
\bfn
  \label
  {3.4.29}V = \min\limits_{j\in \mathbf{I}(\ov{1,N})}\ \min\limits_{z\in
  \bba_j(x^o)}[\mathbf{c}\bigl(x^o,\mathrm{pr}_1(z)\bigl) + c_j(z) +
  v\bigl(\mathrm{pr}_2(z),\ov{1,N}\sm\{j\}\bigl)]
  .
\efn

Для непосредственного использования (\ref{3.4.29})
и теоремы~\ref{t3.4.1} нам
надлежит каким-то образом построить функцию (\ref{3.4.26}),
что составляет
исключительно трудную в вычислительном отношении задачу.
В этой связи, следуя
\cite[\S\,4.9]{Cha1`} и \cite{Cha3`},
мы будем
(при наличии условий предшествования)
использовать не весь массив значений функции $v,$
а только систему слоев данной функции,
что приводит к определенной экономии вычислений.
Эти построения приведены в следующем разделе.
